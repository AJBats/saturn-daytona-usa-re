/* per_frame_render.c -- Per-frame rendering dispatch
 *
 * Functions:
 *   FUN_0600C286 (0x0600C286) -- Per-frame render dispatch: obj update + conditional draw
 *
 * This function is called via function pointer table at 0x06063574
 * (stored in batch_game_logic_b.c). It runs the object system update,
 * game logic update, then dispatches to one of two rendering paths
 * based on a mode flag at 0x06082A26. Finally writes 0xFFFF to
 * the cartridge hardware register at 0x21800000.
 *
 * Original addresses: 0x0600C286
 */

/* Object system update (defined in batch_obj_system_3c.c) */
extern void FUN_0603c000(void);

/* Game logic per-frame update (defined in batch_game_logic_a.c) */
extern void FUN_0600afb2(void);

/* Rendering path A -- mode 0 (defined in batch_game_core.c) */
extern int FUN_06006cdc(void);

/* Rendering path B -- mode 1 (defined in batch_game_core.c) */
extern int FUN_06006a9c(void);


/* ================================================================
 * FUN_0600C286 -- Per-Frame Render Dispatch (0x0600C286)
 *
 * CONFIDENCE: DEFINITE (binary verified at 0x0600C286-0x0600C300)
 * Pool verified:
 *   0x0600C2DC = 0x0603C000 (obj system update)
 *   0x0600C2E0 = 0x0600AFB2 (game logic update)
 *   0x0600C2E4 = 0x06082A26 (render mode flag)
 *   0x0600C2E8 = 0x06006CDC (render path A)
 *   0x0600C378 = 0x06006A9C (render path B)
 *   0x0600C37C = 0x0000FFFF (cart reset value)
 *   0x0600C380 = 0x21800000 (cart hardware register)
 *
 * Calls obj system + game logic updates, checks render mode flag:
 *   0 -> render path A (FUN_06006CDC)
 *   1 -> render path B (FUN_06006A9C)
 * Writes 0xFFFF to cart register on exit.
 *
 * 22 instructions (incl. delay slots + pool). Saves PR.
 * ================================================================ */
#if 0 /* FUN_0600C286 -- replaced by ASM import */
void FUN_0600C286(void)
{
    FUN_0603c000();
    FUN_0600afb2();

    unsigned char flag = *(volatile unsigned char *)0x06082A26;
    if (flag == 0) {
        FUN_06006cdc();
    } else if (flag == 1) {
        FUN_06006a9c();
    }

    *(volatile short *)0x21800000 = (short)0xFFFF;
}
#endif

/* FUN_0600C286 -- original binary (626 bytes) */
__asm__(
    ".section .text.FUN_0600C286, \"ax\"\n"
    ".balign 2\n"
    ".global _FUN_0600C286\n"
    ".global _FUN_0600c286\n"
    ".type _FUN_0600C286, @function\n"
    "_FUN_0600C286:\n"
    "_FUN_0600c286:\n"
    ".byte 0x4F, 0x22, 0xD3, 0x14, 0x43, 0x0B, 0x00, 0x09, 0xD3, 0x14, 0x43, 0x0B, 0x00, 0x09, 0xD4, 0x13\n"  /* 0x0600C286 */
    ".byte 0x62, 0x40, 0x22, 0x28, 0x8B, 0x27, 0xD3, 0x12, 0x43, 0x0B, 0x00, 0x09, 0xA0, 0x29, 0x00, 0x09\n"  /* 0x0600C296 */
    ".byte 0xFE, 0x11, 0x00, 0x80, 0xFF, 0xFF, 0x06, 0x08, 0xA5, 0x2C, 0x06, 0x08, 0x9E, 0xDC, 0x06, 0x02\n"  /* 0x0600C2A6 */
    ".byte 0x76, 0x30, 0x06, 0x00, 0xD3, 0x1C, 0x06, 0x00, 0xC2, 0x86, 0x06, 0x06, 0x35, 0x74, 0x00, 0x00\n"  /* 0x0600C2B6 */
    ".byte 0xFF, 0xFF, 0x21, 0x00, 0x00, 0x00, 0x06, 0x00, 0x58, 0xFA, 0x06, 0x00, 0x68, 0x68, 0x06, 0x01\n"  /* 0x0600C2C6 */
    ".byte 0xBD, 0xEC, 0x06, 0x05, 0x9F, 0xF8, 0x06, 0x03, 0xC0, 0x00, 0x06, 0x00, 0xAF, 0xB2, 0x06, 0x08\n"  /* 0x0600C2D6 */
    ".byte 0x2A, 0x26, 0x06, 0x00, 0x6C, 0xDC, 0x60, 0x40, 0x88, 0x01, 0x8B, 0x02, 0xD3, 0x21, 0x43, 0x0B\n"  /* 0x0600C2E6 */
    ".byte 0x00, 0x09, 0xD2, 0x20, 0xD3, 0x21, 0x4F, 0x26, 0x00, 0x0B, 0x23, 0x21, 0xE0, 0x68, 0xD4, 0x1F\n"  /* 0x0600C2F6 */
    ".byte 0x64, 0x42, 0x03, 0x4E, 0x70, 0x7C, 0x43, 0x08, 0x43, 0x08, 0x43, 0x00, 0x04, 0x36, 0x70, 0xFC\n"  /* 0x0600C306 */
    ".byte 0x04, 0x36, 0x90, 0x27, 0x03, 0x4D, 0x43, 0x15, 0x8B, 0x03, 0x90, 0x23, 0x02, 0x4D, 0x72, 0xFF\n"  /* 0x0600C316 */
    ".byte 0x04, 0x25, 0x90, 0x20, 0x03, 0x4D, 0x43, 0x15, 0x8B, 0x03, 0x90, 0x1C, 0x02, 0x4D, 0x72, 0xFF\n"  /* 0x0600C326 */
    ".byte 0x04, 0x25, 0x90, 0x19, 0x00, 0x4D, 0x20, 0x08, 0x89, 0x01, 0x00, 0x0B, 0x00, 0x09, 0xE7, 0x12\n"  /* 0x0600C336 */
    ".byte 0xE0, 0x68, 0x92, 0x12, 0x03, 0x4E, 0x33, 0x23, 0x8F, 0x05, 0xE6, 0x00, 0x90, 0x0A, 0x04, 0x75\n"  /* 0x0600C346 */
    ".byte 0x70, 0x02, 0x00, 0x0B, 0x04, 0x65, 0x90, 0x09, 0x92, 0x09, 0x03, 0x4E, 0x33, 0x23, 0x89, 0x10\n"  /* 0x0600C356 */
    ".byte 0x00, 0x0B, 0x00, 0x09, 0x01, 0x72, 0x01, 0x74, 0x00, 0xDC, 0x00, 0xE6, 0x00, 0x84, 0x00, 0x8C\n"  /* 0x0600C366 */
    ".byte 0xFF, 0xFF, 0x06, 0x00, 0x6A, 0x9C, 0x00, 0x00, 0xFF, 0xFF, 0x21, 0x80, 0x00, 0x00, 0x06, 0x07\n"  /* 0x0600C376 */
    ".byte 0xE9, 0x44, 0xE0, 0x68, 0x93, 0x44, 0x05, 0x4E, 0x35, 0x37, 0x8B, 0x08, 0x93, 0x41, 0x35, 0x33\n"  /* 0x0600C386 */
    ".byte 0x89, 0x05, 0x66, 0x6F, 0x90, 0x3E, 0x04, 0x65, 0x67, 0x7F, 0x70, 0x02, 0x04, 0x75, 0x00, 0x0B\n"  /* 0x0600C396 */
    ".byte 0x00, 0x09, 0xD5, 0x1C, 0xD6, 0x1D, 0xD3, 0x1D, 0xD2, 0x1E, 0x63, 0x31, 0x63, 0x3D, 0x33, 0x20\n"  /* 0x0600C3A6 */
    ".byte 0x8F, 0x41, 0xE7, 0x03, 0x62, 0x4D, 0xD3, 0x1B, 0x63, 0x31, 0x63, 0x3D, 0x22, 0x39, 0x22, 0x28\n"  /* 0x0600C3B6 */
    ".byte 0x89, 0x03, 0xE3, 0x00, 0x25, 0x32, 0xA0, 0x6C, 0x00, 0x09, 0x62, 0x4D, 0xD3, 0x17, 0x63, 0x31\n"  /* 0x0600C3C6 */
    ".byte 0x63, 0x3D, 0x22, 0x39, 0x22, 0x28, 0x89, 0x06, 0x60, 0x60, 0x20, 0x08, 0x8B, 0x16, 0xE3, 0x01\n"  /* 0x0600C3D6 */
    ".byte 0x25, 0x32, 0xA0, 0x13, 0x00, 0x09, 0x62, 0x4D, 0xD3, 0x11, 0x63, 0x31, 0x63, 0x3D, 0x22, 0x39\n"  /* 0x0600C3E6 */
    ".byte 0x22, 0x28, 0x89, 0x03, 0xE3, 0x02, 0x25, 0x32, 0xA0, 0x08, 0x00, 0x09, 0x64, 0x4D, 0xD2, 0x0C\n"  /* 0x0600C3F6 */
    ".byte 0x62, 0x21, 0x62, 0x2D, 0x24, 0x29, 0x24, 0x48, 0x89, 0x00, 0x25, 0x72, 0xA0, 0x49, 0x00, 0x09\n"  /* 0x0600C406 */
    ".byte 0x00, 0x9B, 0x00, 0xE6, 0x01, 0x72, 0x06, 0x06, 0x3E, 0x20, 0x06, 0x08, 0x32, 0x55, 0x06, 0x07\n"  /* 0x0600C416 */
    ".byte 0x86, 0x5E, 0x00, 0x00, 0x80, 0x00, 0x06, 0x07, 0x86, 0x56, 0x06, 0x07, 0x86, 0x58, 0x06, 0x07\n"  /* 0x0600C426 */
    ".byte 0x86, 0x5A, 0x06, 0x07, 0x86, 0x5C, 0x62, 0x4D, 0xD3, 0x26, 0x63, 0x31, 0x63, 0x3D, 0x22, 0x39\n"  /* 0x0600C436 */
    ".byte 0x22, 0x28, 0x89, 0x12, 0xD3, 0x24, 0xE2, 0x00, 0x63, 0x32, 0x33, 0x26, 0x8B, 0x0D, 0x60, 0x60\n"  /* 0x0600C446 */
    ".byte 0x20, 0x08, 0x89, 0x03, 0xD0, 0x20, 0x60, 0x02, 0x88, 0x02, 0x89, 0x02, 0x62, 0x52, 0xA0, 0x02\n"  /* 0x0600C456 */
    ".byte 0x72, 0xFF, 0x62, 0x52, 0x72, 0xFE, 0xA0, 0x1C, 0x25, 0x22, 0x64, 0x4D, 0xD2, 0x1B, 0x62, 0x21\n"  /* 0x0600C466 */
    ".byte 0x62, 0x2D, 0x24, 0x29, 0x24, 0x48, 0x89, 0x14, 0xD3, 0x19, 0xD2, 0x16, 0x63, 0x30, 0x62, 0x22\n"  /* 0x0600C476 */
    ".byte 0x32, 0x32, 0x89, 0x0E, 0x60, 0x60, 0x20, 0x08, 0x89, 0x03, 0xD0, 0x12, 0x60, 0x02, 0x20, 0x08\n"  /* 0x0600C486 */
    ".byte 0x89, 0x04, 0x63, 0x52, 0x73, 0x01, 0x25, 0x32, 0xA0, 0x03, 0x00, 0x09, 0x62, 0x52, 0x72, 0x02\n"  /* 0x0600C496 */
    ".byte 0x25, 0x22, 0xD0, 0x0F, 0x60, 0x00, 0x60, 0x0C, 0x20, 0x08, 0x8B, 0x10, 0xD0, 0x0E, 0x60, 0x01\n"  /* 0x0600C4A6 */
    ".byte 0x60, 0x0D, 0x20, 0x08, 0x89, 0x0B, 0xD4, 0x0C, 0xE1, 0x06, 0xD3, 0x0C, 0x62, 0x52, 0x63, 0x32\n"  /* 0x0600C4B6 */
    ".byte 0x33, 0x2C, 0x33, 0x16, 0x8B, 0x01, 0xA0, 0x01, 0x62, 0x7F, 0xE2, 0x04, 0x24, 0x21, 0x00, 0x0B\n"  /* 0x0600C4C6 */
    ".byte 0x00, 0x09, 0x06, 0x07, 0x86, 0x5E, 0x06, 0x06, 0x3E, 0x20, 0x06, 0x07, 0x86, 0x60, 0x06, 0x07\n"  /* 0x0600C4D6 */
    ".byte 0x86, 0x62, 0x06, 0x07, 0x86, 0x35, 0x06, 0x07, 0xED, 0x8C, 0x06, 0x05, 0xA0, 0x16, 0x06, 0x06\n"  /* 0x0600C4E6 */
    ".byte 0x3E, 0x1C\n"  /* 0x0600C4F6 */
);

