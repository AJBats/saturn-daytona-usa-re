#include "saturn.h"
#include "game.h"

/*
 * system_init -- FUN_060030FC
 *
 * Called once at boot. Initializes all Saturn hardware and game subsystems.
 *
 * Sequence from production ASM (0x060030FC-0x060031E0):
 *   1. BIOS call with param 1 (via indirect ptr at 0x06000320)
 *   2. SMPC CKCHG320 -- clock change to 320-pixel mode
 *   3. Memory clear -- zero work RAM regions
 *   4. course_system_init(0) -- hardware subsystem init
 *   5. menu_system_init()  -- graphics/rendering init
 *   6. BIOS call via 0x06000344 with params (-1, 0x0083)
 *   7. game_subsystem_init()  -- object/physics setup
 *   8. vdp_init_dispatcher()  -- VDP init dispatcher
 *   9. global_engine_init()  -- engine init
 *  10. game_subsystem_init2()  -- state machine setup
 *  11. sound_timer_init()  -- sound/timer init
 *  12. cd_system_init()  -- camera/viewport init
 *  13. BIOS call via 0x06000344 with params (0xFF7C, 0)
 *  14. object_system_init()  -- animation/sprite init
 *  15. render_system_init()  -- sound system init
 *  16. vdp_system_init_a()  -- game state init
 *  17. vdp_system_init_b()  -- physics parameters init
 *  18. Set GAME_STATE = 2
 */
#if 0 /* system_init -- redirected to ASM import via linker PROVIDE */
void system_init(void)
{
    int *ptr;

    /* Phase 1: BIOS init call (param 1) */
    BIOS_FUNC_0320(1);

    /* Phase 2: SMPC CKCHG320 (clock change to 320-pixel mode) */
    while (SMPC_SF & 0x01)
        ;
    SMPC_SF = 0x01;
    SMPC_COMREG = 25;
    while (SMPC_SF & 0x01)
        ;

    /* Phase 3: Clear work RAM regions */
    for (ptr = MEM_REGION1_START; ptr < MEM_REGION1_END; ptr++)
        *ptr = 0;
    for (ptr = MEM_REGION2_START; ptr < MEM_REGION2_END; ptr++)
        *ptr = 0;

    /* Phase 4-5: Hardware and graphics init */
    course_system_init(0);
    menu_system_init();

    /* Phase 6: BIOS call (params -1, 0x0083) */
    BIOS_FUNC_0344(-1, 0x0083);

    /* Phase 7: Object/physics setup */
    game_subsystem_init();

    /* Phase 8: VDP initialization */
    vdp_init_dispatcher();

    /* Phase 9: Engine init */
    global_engine_init();

    /* Phase 10: State machine setup */
    game_subsystem_init2();

    /* Phase 11: Sound/timer init */
    sound_timer_init();

    /* Phase 12: Camera/viewport init */
    cd_system_init();

    /* Phase 13: BIOS call (params 0xFF7C, 0) */
    BIOS_FUNC_0344(0xFF7C, 0);

    /* Phase 14-17: Animation, sound, game state, physics */
    object_system_init();
    render_system_init();
    vdp_system_init_a();
    vdp_system_init_b();

    /* Phase 18: Mark system ready */
    GAME_STATE = 2;
}
#endif /* system_init */
/* REMOVED: conflicting alias */ // void FUN_060030FC(void) __attribute__((alias("system_init")));

/* FUN_060030FC -- original binary (284 bytes) */
__asm__(
    ".section .text.FUN_060030FC, \"ax\"\n"
    ".balign 2\n"
    ".global _FUN_060030FC\n"
    ".global _FUN_060030fc\n"
    ".type _FUN_060030FC, @function\n"
    "_FUN_060030FC:\n"
    "_FUN_060030fc:\n"
    ".byte 0x2F, 0xE6, 0xEE, 0x01, 0x2F, 0xD6, 0x2F, 0xC6, 0x2F, 0xB6, 0xEC, 0x00, 0x2F, 0xA6, 0x4F, 0x22\n"  /* 0x060030FC */
    ".byte 0xDA, 0x10, 0xDB, 0x11, 0xDD, 0x11, 0xD3, 0x12, 0x63, 0x32, 0x43, 0x0B, 0x64, 0xE3, 0x62, 0xD0\n"  /* 0x0600310C */
    ".byte 0x62, 0x2C, 0x22, 0xE9, 0x32, 0xE0, 0x89, 0xFA, 0x62, 0xEC, 0x2D, 0x20, 0xE3, 0x19, 0xD2, 0x0D\n"  /* 0x0600311C */
    ".byte 0x22, 0x30, 0x62, 0xD0, 0x62, 0x2C, 0x22, 0xE9, 0x22, 0x28, 0x8B, 0xFA, 0xD4, 0x0A, 0xA0, 0x02\n"  /* 0x0600312C */
    ".byte 0x64, 0x42, 0x24, 0xC2, 0x74, 0x04, 0x62, 0xB2, 0x34, 0x22, 0x8B, 0xFA, 0xD4, 0x07, 0xA0, 0x11\n"  /* 0x0600313C */
    ".byte 0x64, 0x42, 0xFF, 0xFF, 0x06, 0x05, 0x9C, 0x58, 0x06, 0x05, 0x9C, 0x50, 0x20, 0x10, 0x00, 0x63\n"  /* 0x0600314C */
    ".byte 0x06, 0x00, 0x03, 0x20, 0x20, 0x10, 0x00, 0x1F, 0x06, 0x05, 0x9C, 0x4C, 0x06, 0x05, 0x9C, 0x54\n"  /* 0x0600315C */
    ".byte 0x24, 0xC2, 0x74, 0x04, 0x62, 0xA2, 0x34, 0x22, 0x8B, 0xFA, 0xD3, 0x1C, 0x43, 0x0B, 0xE4, 0x00\n"  /* 0x0600316C */
    ".byte 0xD3, 0x1B, 0x43, 0x0B, 0x00, 0x09, 0xD2, 0x1B, 0x95, 0x2D, 0x62, 0x22, 0x42, 0x0B, 0xE4, 0xFF\n"  /* 0x0600317C */
    ".byte 0xD3, 0x19, 0x43, 0x0B, 0x00, 0x09, 0xB0, 0x6F, 0x00, 0x09, 0xD3, 0x18, 0x43, 0x0B, 0x00, 0x09\n"  /* 0x0600318C */
    ".byte 0xD3, 0x17, 0x43, 0x0B, 0x00, 0x09, 0xB0, 0x39, 0x00, 0x09, 0xD3, 0x16, 0x43, 0x0B, 0x00, 0x09\n"  /* 0x0600319C */
    ".byte 0xD2, 0x10, 0x94, 0x19, 0x62, 0x22, 0x42, 0x0B, 0xE5, 0x00, 0xD3, 0x13, 0x43, 0x0B, 0x00, 0x09\n"  /* 0x060031AC */
    ".byte 0xD3, 0x12, 0x43, 0x0B, 0x00, 0x09, 0xD3, 0x12, 0x43, 0x0B, 0x00, 0x09, 0xD3, 0x11, 0x43, 0x0B\n"  /* 0x060031BC */
    ".byte 0x00, 0x09, 0xE2, 0x02, 0xD3, 0x10, 0x23, 0x22, 0x4F, 0x26, 0x6A, 0xF6, 0x6B, 0xF6, 0x6C, 0xF6\n"  /* 0x060031CC */
    ".byte 0x6D, 0xF6, 0x00, 0x0B, 0x6E, 0xF6, 0x00, 0x83, 0xFF, 0x7C, 0xFF, 0xFF, 0x06, 0x03, 0xBF, 0x7C\n"  /* 0x060031DC */
    ".byte 0x06, 0x03, 0x4E, 0x58, 0x06, 0x00, 0x03, 0x44, 0x06, 0x01, 0x2C, 0xF4, 0x06, 0x00, 0x4A, 0x98\n"  /* 0x060031EC */
    ".byte 0x06, 0x01, 0x2E, 0x6A, 0x06, 0x01, 0x8E, 0xE4, 0x06, 0x00, 0x51, 0x74, 0x06, 0x01, 0xF9, 0x36\n"  /* 0x060031FC */
    ".byte 0x06, 0x01, 0x49, 0x2C, 0x06, 0x01, 0x49, 0xE0, 0x06, 0x05, 0xAD, 0x10\n"  /* 0x0600320C */
);

