/* start_light_render -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0601A2BC - 0x0601A344
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Race start light rendering — sets up display layers and uploads
 * tile pattern data to VDP2 VRAM for the traffic light sprite.
 *
 * Steps:
 *   1. Set sign bit (0x80000000) in render mode flags to trigger
 *      display state change.
 *   2. Call camera state finalization twice (once with flags update,
 *      once standalone).
 *   3. Configure three display channels (indices 4, 8, 0xC) via
 *      the display channel configure function.
 *   4. Commit render state to finalize display setup.
 *   5. Upload two tile pattern blocks (0x17700 bytes each) to
 *      VDP2 VRAM:
 *      - Block 8 → VDP2 VRAM 0x76EFC (traffic light tiles A)
 *      - Block 9 → VDP2 VRAM 0x77B18 (traffic light tiles B)
 *   6. Increment animation frame counter.
 */

    .section .text.FUN_0601A2BC


    .global start_light_render
    .type start_light_render, @function
start_light_render:
    mov.l r14, @-r15                        ! save r14 on stack
    sts.l pr, @-r15                         ! save return address on stack
    mov.l   .L_render_mode_flags, r4        ! r4 = &render_mode_flags
    mov.l   .L_sign_bit, r3                 ! r3 = 0x80000000 (sign bit)
    mov.l @r4, r2                           ! r2 = current render mode flags
    or r3, r2                               ! set sign bit → trigger state change
    mov.l   .L_fn_camera_finalize, r3       ! r3 = &camera_finalize
    jsr @r3                                 ! call camera_finalize (with flags update in delay)
    mov.l r2, @r4                           ! store updated render mode flags (delay slot)
    mov.l   .L_fn_camera_finalize, r3       ! r3 = &camera_finalize (reload)
    jsr @r3                                 ! call camera_finalize again (standalone)
    nop                                     ! delay slot (no-op)
    mov.l   .L_fn_display_channel_cfg, r14  ! r14 = &display_channel_configure
    jsr @r14                                ! configure display channel 4
    mov #0x4, r4                            ! r4 = channel index 4 (delay slot)
    jsr @r14                                ! configure display channel 8
    mov #0x8, r4                            ! r4 = channel index 8 (delay slot)
    jsr @r14                                ! configure display channel 0xC
    mov #0xC, r4                            ! r4 = channel index 0xC (delay slot)
    mov.l   .L_fn_render_state_commit, r3   ! r3 = &render_state_commit
    jsr @r3                                 ! commit render state
    nop                                     ! delay slot (no-op)
    mov #0x8, r7                            ! r7 = 8 (tile block index A)
    mov.l   .L_tile_data_size, r5           ! r5 = 0x17700 (tile data size, 96000 bytes)
    mov.l   .L_vdp2_vram_tile_a, r4        ! r4 = VDP2 VRAM 0x76EFC (destination A)
    mov.l   .L_fn_vram_tile_copy, r3        ! r3 = &vram_tile_copy
    jsr @r3                                 ! upload tile block A to VRAM
    mov #0x0, r6                            ! r6 = 0 (source offset, delay slot)
    mov #0x9, r7                            ! r7 = 9 (tile block index B)
    mov.l   .L_tile_data_size, r5           ! r5 = 0x17700 (tile data size, 96000 bytes)
    mov.l   .L_vdp2_vram_tile_b, r4        ! r4 = VDP2 VRAM 0x77B18 (destination B)
    mov.l   .L_fn_vram_tile_copy, r3        ! r3 = &vram_tile_copy
    jsr @r3                                 ! upload tile block B to VRAM
    mov #0x0, r6                            ! r6 = 0 (source offset, delay slot)
    mov.l   .L_frame_counter, r4            ! r4 = &frame_counter (byte)
    mov.b @r4, r2                           ! r2 = current frame counter value
    add #0x1, r2                            ! increment frame counter
    mov.b r2, @r4                           ! store updated frame counter
    lds.l @r15+, pr                         ! restore return address
    rts                                     ! return to caller
    mov.l @r15+, r14                        ! restore r14 (delay slot)
    .2byte  0x0090
    .4byte  sym_0605D4F0
    .4byte  sym_06049AFC
    .4byte  sym_060284AE
.L_render_mode_flags:
    .4byte  sym_0605B6D8                    /* render mode flags (32-bit) */
.L_sign_bit:
    .4byte  0x80000000                      /* sign bit — triggers display state change */
.L_fn_camera_finalize:
    .4byte  sym_06026CE0                    /* camera state finalization */
.L_fn_display_channel_cfg:
    .4byte  sym_0602853E                    /* display channel configure */
.L_fn_render_state_commit:
    .4byte  sym_06028560                    /* render state commit / flush */
.L_tile_data_size:
    .4byte  0x00017700                      /* tile pattern data size (96000 bytes) */
.L_vdp2_vram_tile_a:
    .4byte  0x25E76EFC                      /* VDP2 VRAM +0x76EFC (tile block A dest) */
.L_fn_vram_tile_copy:
    .4byte  sym_0600511E                    /* VRAM tile/pattern upload function */
.L_vdp2_vram_tile_b:
    .4byte  0x25E77B18                      /* VDP2 VRAM +0x77B18 (tile block B dest) */
.L_frame_counter:
    .4byte  sym_06085FF2                    /* animation frame counter (byte) */
