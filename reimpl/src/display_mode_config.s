/* display_mode_config -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06038AC8 - 0x06038BD4
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Display mode configuration — dispatches up to 6 display channels based
 * on a config byte bitmask. Each enabled bit loads channel data from a
 * source/destination pair and commits it with a channel ID.
 *
 * Config byte (sym_060A4D58) bit dispatch:
 *   bit 7 (0x80) → channel 0: src=sym_060A4D18, dst=*sym_0606360C, size=0x10, id=0x0001
 *   bit 6 (0x40) → channel 1: src=sym_060A4D28, dst=*sym_06063610, size=0x08, id=0x0101
 *   bit 5 (0x20) → channel 2: src=sym_060A4D30, dst=*sym_06063614, size=0x06, id=0x0201
 *   bit 4 (0x10) → channel 3: src=sym_060A4D36, dst=*sym_06063618, size=0x08, id=0x0301
 *   bit 3 (0x08) → channel 4: src=sym_060A4D3E, dst=*sym_0606361C, size=0x08, id=0x0401
 *   bit 2 (0x04) → channel 5: src=sym_060A4D46, dst=*sym_06063620, size=0x10, id=0x0501
 *
 * For each enabled channel:
 *   1. BSR data_loader(dst, src, size) at 0x06038A48
 *   2. channel_commit(config_ptr, 0, channel_id)
 *
 * Channel ID format: high byte = channel number, low byte = 0x01 (enable).
 *
 * Persistent registers:
 *   r14 = config byte pointer (sym_060A4D58)
 *   r13 = 0 (constant zero for channel_commit arg)
 */

    .section .text.FUN_06038AC8


    .global display_mode_config
    .type display_mode_config, @function
display_mode_config:
    mov.l r14, @-r15
    mov.l r13, @-r15
    sts.l pr, @-r15
    mov.l   .L_config_byte, r14          /* r14 → config byte */
    mov.l   .L_fn_hud_display, r3
    jsr @r3                              /* hud_display_ext() — pre-display setup */
    mov #0x0, r13                        /* r13 = 0 (persistent zero) */
    mov r14, r0                          /* === Channel 0: bit 7 (0x80) === */
    mov.b @r0, r0
    tst #0x80, r0
    bt      .L_06038AF2                  /* bit 7 clear → skip channel 0 */
    mov #0x10, r6                        /* size = 16 bytes */
    mov.l   .L_ch0_src, r5
    mov.l   .L_ch0_dst_ptr, r4
    .byte   0xBF, 0xB0    /* bsr 0x06038A48 (data_loader) */
    mov.l @r4, r4                        /* dst = *ch0_dst_ptr */
    mov r13, r0                          /* r0 = 0 */
    mov r14, r2                          /* r2 = config_ptr */
    mov.l   .L_fn_channel_commit, r3
    jsr @r3                              /* channel_commit(config, 0, 0x0001) */
    mov #0x1, r1                         /* channel ID = 0x0001 */
.L_06038AF2:                              /* === Channel 1: bit 6 (0x40) === */
    mov r14, r0
    mov.b @r0, r0
    tst #0x40, r0
    bt      .L_06038B0E                  /* bit 6 clear → skip channel 1 */
    mov #0x8, r6                         /* size = 8 bytes */
    mov.l   .L_ch1_src, r5
    mov.l   .L_ch1_dst_ptr, r4
    .byte   0xBF, 0xA2    /* bsr 0x06038A48 (data_loader) */
    mov.l @r4, r4                        /* dst = *ch1_dst_ptr */
    mov r13, r0
    mov.w   .L_ch1_id, r1               /* channel ID = 0x0101 */
    mov.l   .L_fn_channel_commit, r3
    jsr @r3                              /* channel_commit(config, 0, 0x0101) */
    mov r14, r2
.L_06038B0E:                              /* === Channel 2: bit 5 (0x20) === */
    mov r14, r0
    mov.b @r0, r0
    tst #0x20, r0
    bt      .L_06038B2A                  /* bit 5 clear → skip channel 2 */
    mov #0x6, r6                         /* size = 6 bytes */
    mov.l   .L_ch2_src, r5
    mov.l   .L_ch2_dst_ptr, r4
    .byte   0xBF, 0x94    /* bsr 0x06038A48 (data_loader) */
    mov.l @r4, r4                        /* dst = *ch2_dst_ptr */
    mov r13, r0
    mov.w   .L_ch2_id, r1               /* channel ID = 0x0201 */
    mov.l   .L_fn_channel_commit, r3
    jsr @r3                              /* channel_commit(config, 0, 0x0201) */
    mov r14, r2
.L_06038B2A:                              /* === Channel 3: bit 4 (0x10) === */
    mov r14, r0
    mov.b @r0, r0
    tst #0x10, r0
    bt      .L_06038B46                  /* bit 4 clear → skip channel 3 */
    mov #0x8, r6                         /* size = 8 bytes */
    mov.l   .L_ch3_src, r5
    mov.l   .L_ch3_dst_ptr, r4
    .byte   0xBF, 0x86    /* bsr 0x06038A48 (data_loader) */
    mov.l @r4, r4                        /* dst = *ch3_dst_ptr */
    mov r13, r0
    mov.w   .L_ch3_id, r1               /* channel ID = 0x0301 */
    mov.l   .L_fn_channel_commit, r3
    jsr @r3                              /* channel_commit(config, 0, 0x0301) */
    mov r14, r2
.L_06038B46:                              /* === Channel 4: bit 3 (0x08) === */
    mov r14, r0
    mov.b @r0, r0
    tst #0x8, r0
    bt      .L_06038B62                  /* bit 3 clear → skip channel 4 */
    mov #0x8, r6                         /* size = 8 bytes */
    mov.l   .L_ch4_src, r5
    mov.l   .L_ch4_dst_ptr, r4
    .byte   0xBF, 0x78    /* bsr 0x06038A48 (data_loader) */
    mov.l @r4, r4                        /* dst = *ch4_dst_ptr */
    mov r13, r0
    mov.w   .L_ch4_id, r1               /* channel ID = 0x0401 */
    mov.l   .L_fn_channel_commit, r3
    jsr @r3                              /* channel_commit(config, 0, 0x0401) */
    mov r14, r2
.L_06038B62:                              /* === Channel 5: bit 2 (0x04) === */
    mov r14, r0
    mov.b @r0, r0
    tst #0x4, r0
    bt      .L_06038BC6                  /* bit 2 clear → skip channel 5 */
    mov #0x10, r6                        /* size = 16 bytes */
    mov.l   .L_ch5_src, r5
    mov.l   .L_ch5_dst_ptr, r4
    bra     .L_06038BB8
    mov.l @r4, r4                        /* dst = *ch5_dst_ptr (delay slot) */
.L_ch1_id:
    .2byte  0x0101                        /* channel 1 ID */
.L_ch2_id:
    .2byte  0x0201                        /* channel 2 ID */
.L_ch3_id:
    .2byte  0x0301                        /* channel 3 ID */
.L_ch4_id:
    .2byte  0x0401                        /* channel 4 ID */
.L_config_byte:
    .4byte  sym_060A4D58               /* display config byte (bitmask) */
.L_fn_hud_display:
    .4byte  hud_display_ext            /* HUD extended display setup */
.L_ch0_src:
    .4byte  sym_060A4D18               /* channel 0 source data */
.L_ch0_dst_ptr:
    .4byte  sym_0606360C               /* channel 0 dest pointer */
.L_fn_channel_commit:
    .4byte  sym_06034F78               /* channel data commit */
.L_ch1_src:
    .4byte  sym_060A4D28               /* channel 1 source data */
.L_ch1_dst_ptr:
    .4byte  sym_06063610               /* channel 1 dest pointer */
.L_ch2_src:
    .4byte  sym_060A4D30               /* channel 2 source data */
.L_ch2_dst_ptr:
    .4byte  sym_06063614               /* channel 2 dest pointer */
.L_ch3_src:
    .4byte  sym_060A4D36               /* channel 3 source data */
.L_ch3_dst_ptr:
    .4byte  sym_06063618               /* channel 3 dest pointer */
.L_ch4_src:
    .4byte  sym_060A4D3E               /* channel 4 source data */
.L_ch4_dst_ptr:
    .4byte  sym_0606361C               /* channel 4 dest pointer */
.L_ch5_src:
    .4byte  sym_060A4D46               /* channel 5 source data */
.L_ch5_dst_ptr:
    .4byte  sym_06063620               /* channel 5 dest pointer */
.L_06038BB8:
    .byte   0xBF, 0x46    /* bsr 0x06038A48 (data_loader) */
    nop
    mov r13, r0
    mov.w   .L_ch5_id, r1               /* channel ID = 0x0501 */
    mov.l   .L_fn_channel_commit_b, r3
    jsr @r3                              /* channel_commit(config, 0, 0x0501) */
    mov r14, r2
.L_06038BC6:                              /* === Return === */
    lds.l @r15+, pr
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14
.L_ch5_id:
    .2byte  0x0501                        /* channel 5 ID */
.L_fn_channel_commit_b:
    .4byte  sym_06034F78               /* channel data commit (same fn) */
