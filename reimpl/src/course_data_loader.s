/* course_data_loader -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0601B584 - 0x0601B644
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Course-specific data loader — copies course palettes to VDP2 CRAM,
 * performs a DMA transfer of course character patterns, sets up display
 * channels, and configures course-specific scroll/render parameters.
 *
 * Steps:
 *   1. Copy 3 course palette banks to CRAM 0x6C0/0x720/0x740
 *   2. DMA transfer (0x180 bytes) of full CRAM init data
 *   3. Configure VDP2 display channel (channel 0xC)
 *   4. Setup two display layers (channels 0x10, 0x20) with zero alpha
 *   5. Load display list from course descriptor (with 0xC000 offset)
 *   6. Configure course-specific scroll parameters via BSR
 *   7. Reset course state flags
 */

    .section .text.FUN_0601B584


    .global course_data_loader
    .type course_data_loader, @function
course_data_loader:
    mov.l r14, @-r15
    sts.l pr, @-r15
    add #-0x4, r15
    mov.l   .L_fn_memcpy_word, r14
    mov.l   .L_pal_course_main, r5    /* copy 1: course main palette → CRAM 0x6C0 (96 bytes) */
    mov.l   .L_vdp2_cram_0x6C0, r4
    jsr @r14
    mov #0x60, r6
    mov.l   .L_pal_course_ext_a, r5   /* copy 2: course ext A → CRAM 0x720 (32 bytes) */
    mov.l   .L_vdp2_cram_0x720, r4
    jsr @r14
    mov #0x20, r6
    mov.l   .L_pal_course_ext_b, r5   /* copy 3: course ext B → CRAM 0x740 (32 bytes) */
    mov.l   .L_vdp2_cram_0x740, r4
    jsr @r14
    mov #0x20, r6
    mov.w   .L_cram_full_size, r6     /* DMA: full CRAM init (0x180 = 384 bytes) */
    mov.l   .L_pal_full_init, r5
    mov.l   .L_vdp2_cram_0x000, r4
    mov.l   .L_fn_dma_transfer, r3
    jsr @r3
    nop
    mov.l   .L_fn_disp_chan_cfg, r3   /* configure display channel 0xC */
    jsr @r3
    mov #0xC, r4
    mov.l   .L_fn_disp_chan_init, r3  /* initialize display layers */
    jsr @r3
    nop
    mov.l   .L_course_descriptor, r2  /* load display list from course descriptor */
    mov #0x16, r6
    mov.l r2, @r15
    mov r2, r7
    mov r2, r5
    mov.l   .L_mask_0xC000, r3
    mov.l @(4, r7), r7
    mov.l @r5, r5
    add r3, r7
    mov.l   .L_fn_disp_loader, r3     /* load display list (r5=base, r7=base+0xC000) */
    jsr @r3
    mov #0x8, r4
    mov #0x0, r6                      /* configure course scroll parameters */
    mov.l   .L_scroll_param_b, r5
    mov.l   .L_scroll_param_a, r4
    mov.b @r5, r5
    .byte   0xB2, 0x38    /* bsr 0x0601BA50 (external) */
    mov.b @r4, r4
    mov #0x0, r2                      /* reset course state flags */
    mov.l   .L_course_state_a, r3
    mov.b r2, @r3                     /* state A = 0 (cleared) */
    mov #0x4, r2
    mov.l   .L_course_state_b, r3
    mov.b r2, @r3                     /* state B = 4 (initial phase) */
    add #0x4, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14
.L_cram_full_size:
    .2byte  0x0180                      /* 384 bytes = full CRAM init block size */
    .2byte  0xFFFF
.L_fn_memcpy_word:
    .4byte  memcpy_word_idx            /* word-indexed memcpy */
.L_pal_course_main:
    .4byte  sym_0604866C               /* source: course main palette (48 colors) */
.L_vdp2_cram_0x6C0:
    .4byte  0x25F006C0                  /* VDP2 color RAM +0x6C0 — course palette bank */
.L_pal_course_ext_a:
    .4byte  sym_0604862C               /* source: course extended palette A */
.L_vdp2_cram_0x720:
    .4byte  0x25F00720                  /* VDP2 color RAM +0x720 — course ext A */
.L_pal_course_ext_b:
    .4byte  sym_060485EC               /* source: course extended palette B */
.L_vdp2_cram_0x740:
    .4byte  0x25F00740                  /* VDP2 color RAM +0x740 — course ext B */
.L_pal_full_init:
    .4byte  sym_0604996C               /* source: full CRAM init palette data */
.L_vdp2_cram_0x000:
    .4byte  0x25F00000                  /* VDP2 color RAM +0x000 — base */
.L_fn_dma_transfer:
    .4byte  dma_transfer               /* DMA memory transfer */
.L_fn_disp_chan_cfg:
    .4byte  sym_0602853E               /* display channel configure */
.L_fn_disp_chan_init:
    .4byte  sym_06028560               /* display channel init */
.L_course_descriptor:
    .4byte  sym_060638C8               /* course display list descriptor */
.L_mask_0xC000:
    .4byte  0x0000C000                  /* offset into display list (0xC000) */
.L_fn_disp_loader:
    .4byte  sym_06028400               /* display list loader */
.L_scroll_param_b:
    .4byte  sym_0605D4F5               /* course scroll parameter B (byte) */
.L_scroll_param_a:
    .4byte  sym_0605D4F4               /* course scroll parameter A (byte) */
.L_course_state_a:
    .4byte  sym_0605D4FA               /* course state flag A */
.L_course_state_b:
    .4byte  sym_0608600D               /* course state flag B (init = 4) */
