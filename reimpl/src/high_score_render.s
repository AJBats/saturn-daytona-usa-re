/* high_score_render -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0603D2D0 - 0x0603D3A8
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Display channel nibble-pack configurator.
 * Writes a value into packed 4-bit nibble fields across 4 config words
 * at sym_060A4D28 (offsets 0, 2, 4, 6). For each word, two nibble fields
 * are updated: the low nibble (bits 0-3, mask 0xFFF0) and the mid nibble
 * (bits 8-11, mask 0xF0FF). Each update calls the bitfield RMW utility
 * at sym_06034F78 with r1=0x0101 (nibble position/count parameter).
 *
 * Entry via render_credits_stub (FUN_0603D2CC) which pushes r14 and
 * sets r6=1 before falling through here.
 *
 * Args (from fall-through wrapper):
 *   r6 = value to pack into nibble fields (set by caller, e.g. 1)
 * Uses:
 *   r4 = pointer to config word array (sym_060A4D28)
 *   r5 = pointer to source parameter table (sym_060A4D58)
 *   r7 = low nibble clear mask (0xFFF0)
 *   r14 = mid nibble clear mask (0xF0FF)
 *   r3 = bitfield RMW utility (sym_06034F78)
 *   r1 = 0x0101 (nibble bit position/count for RMW utility)
 * Returns: void (config words updated in place)
 */

    .section .text.FUN_0603D2D0


    .global high_score_render
    .type high_score_render, @function
high_score_render:
    sts.l pr, @-r15                         ! save return address (r14 already pushed by wrapper)
    mov r6, r0                              ! r0 = value to write (passed through to bitfield RMW)
    mov.l   .L_mask_low_nibble, r7          ! r7 = 0x0000FFF0 (mask to clear low nibble)
    mov.l   .L_src_table_ptr, r5            ! r5 = sym_060A4D58 (source parameter table)
    mov.l   .L_cfg_word_array, r4           ! r4 = sym_060A4D28 (config word array base)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101 (nibble position/count param)
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = sym_06034F78 (bitfield RMW utility)
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    ! --- Config word[0] (offset 0): clear low nibble ---
    mov r6, r0                              ! r0 = value (reload for next call)
    mov.w @r4, r2                           ! r2 = config word[0]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r7, r2                              ! r2 &= 0xFFF0 (clear low nibble, bits 0-3)
    mov.w r2, @r4                           ! write masked word[0] back
    mov.l   .L_mask_mid_nibble, r14         ! r14 = 0x0000F0FF (mask to clear mid nibble, bits 8-11)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101 (nibble position/count)
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    ! --- Config word[0] (offset 0): clear mid nibble ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w @r4, r2                           ! r2 = config word[0]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r14, r2                             ! r2 &= 0xF0FF (clear mid nibble, bits 8-11)
    mov.w r2, @r4                           ! write masked word[0] back
    ! --- Config word[1] (offset 2): low nibble ---
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    mov.w @(2, r4), r0                      ! r0 = config word[1]
    mov r0, r2                              ! r2 = word[1]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r7, r2                              ! r2 &= 0xFFF0 (clear low nibble)
    extu.w r2, r0                           ! zero-extend result for write
    mov.w r0, @(2, r4)                      ! write masked word[1] back
    ! --- Config word[1] (offset 2): mid nibble ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    mov.w @(2, r4), r0                      ! r0 = config word[1]
    mov r0, r2                              ! r2 = word[1]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r14, r2                             ! r2 &= 0xF0FF (clear mid nibble)
    extu.w r2, r0                           ! zero-extend result for write
    mov.w r0, @(2, r4)                      ! write masked word[1] back
    ! --- Config word[2] (offset 4): low nibble ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    mov.w @(4, r4), r0                      ! r0 = config word[2]
    mov r0, r2                              ! r2 = word[2]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r7, r2                              ! r2 &= 0xFFF0 (clear low nibble)
    extu.w r2, r0                           ! zero-extend result for write
    mov.w r0, @(4, r4)                      ! write masked word[2] back
    ! --- Config word[2] (offset 4): mid nibble ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    mov.w @(4, r4), r0                      ! r0 = config word[2]
    mov r0, r2                              ! r2 = word[2]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r14, r2                             ! r2 &= 0xF0FF (clear mid nibble)
    extu.w r2, r0                           ! zero-extend result for write
    mov.w r0, @(4, r4)                      ! write masked word[2] back
    ! --- Config word[3] (offset 6): low nibble ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    mov.w @(6, r4), r0                      ! r0 = config word[3]
    mov r0, r2                              ! r2 = word[3]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r7, r2                              ! r2 &= 0xFFF0 (clear low nibble)
    extu.w r2, r0                           ! zero-extend result for write
    mov.w r0, @(6, r4)                      ! write masked word[3] back
    ! --- Config word[3] (offset 6): mid nibble ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    mov.w @(6, r4), r0                      ! r0 = config word[3]
    mov r0, r2                              ! r2 = word[3]
    extu.w r2, r2                           ! zero-extend to 32-bit
    and r14, r2                             ! r2 &= 0xF0FF (clear mid nibble)
    extu.w r2, r0                           ! zero-extend result for write
    mov.w r0, @(6, r4)                      ! write masked word[3] back
    ! --- Final bitfield RMW call (no mask-and-write after) ---
    mov r6, r0                              ! r0 = value (reload)
    mov.w   .L_wpool_0603D392, r1           ! r1 = 0x0101
    mov.l   .L_bitfield_rmw_fn, r3          ! r3 = bitfield RMW utility
    jsr @r3                                 ! call bitfield_rmw(r0=value, r1=0x0101, r2=src_table)
    mov r5, r2                              ! r2 = source table ptr (delay slot)
    lds.l @r15+, pr                         ! restore return address
    rts                                     ! return to caller
    mov.l @r15+, r14                        ! restore r14 (pushed by wrapper, delay slot)
.L_wpool_0603D392:
    .2byte  0x0101                          /* nibble position/count param for bitfield RMW */
.L_mask_low_nibble:
    .4byte  0x0000FFF0                      /* mask to clear low nibble (bits 0-3) */
.L_src_table_ptr:
    .4byte  sym_060A4D58                    /* source parameter table */
.L_cfg_word_array:
    .4byte  sym_060A4D28                    /* config word array (4 words at offsets 0/2/4/6) */
.L_bitfield_rmw_fn:
    .4byte  sym_06034F78                    /* bitfield read-modify-write utility */
.L_mask_mid_nibble:
    .4byte  0x0000F0FF                      /* mask to clear mid nibble (bits 8-11) */
