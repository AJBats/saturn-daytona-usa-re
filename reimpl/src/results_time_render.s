/* results_time_render -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06033338 - 0x0603338E
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Results screen time display renderer.
 *
 * results_time_render (thunk): delegates to the function pointer in r0,
 *   used by the display element dispatch table.
 *
 * sym_06033354 (body): formats and renders a 6-digit time string
 *   (e.g. "M:SS.TT") on the results screen.
 *   1. Selects default or alternate digit character table based on
 *      display state sign (cmp/pl).
 *   2. Copies 6 tile-index pairs from the character table into a
 *      work buffer with stride-4 layout (2 bytes data, 2 bytes gap).
 *   3. Iterates over a position table (6 entries) to blit each digit
 *      element via memcpy_word_idx.
 *
 * Pool (in results_sub_elem TU at 0x060333B4-0x060333D3):
 *   pool_060333B4 = sym_060338DC  (default digit char table, 12 bytes)
 *   pool_060333B8 = sym_06033868  (display state ptr indirection)
 *   pool_060333BC = sym_060338E8  (alternate digit char table, 12 bytes)
 *   pool_060333C0 = sym_06062D95  (display element work buffer)
 *   pool_060333C4 = sym_060338F4  (element XY position table, 6 word pairs)
 *   pool_060333C8 = sym_060430CE  (palette/render helper function)
 *   pool_060333CC = sym_060629AC  (element source data buffer)
 *   pool_060333D0 = memcpy_word_idx (word-indexed memcpy routine)
 */

    .section .text.FUN_06033338


    .global results_time_render
    .type results_time_render, @function
results_time_render:
    sts.l pr, @-r15                          ! save return address
    jsr @r0                                  ! call display element handler (ptr in r0)
    nop                                      ! (delay slot)
    lds.l @r15+, pr                          ! restore return address
    rts                                      ! return to caller
    nop                                      ! (delay slot)
    .4byte  0x07E00000                       /* VDP1 VRAM base address */
    .4byte  sym_060430CE                     /* palette/render helper */
    .4byte  sym_060629AC                     /* element source data buffer */
    .4byte  memcpy_word_idx                  /* word-indexed memcpy routine */

    .global sym_06033354
sym_06033354:
    .byte   0xD5, 0x17    /* mov.l .L_pool_default_char_tbl, r5 — r5 = default digit char table (sym_060338DC) */
    .byte   0xD0, 0x18    /* mov.l .L_pool_display_state_ptr, r0 — r0 = &display state ptr (sym_06033868) */
    mov.l @r0, r0                            ! r0 = *display_state_ptr (first deref)
    mov.l @r0, r0                            ! r0 = **display_state_ptr (second deref — get value)
    cmp/pl r0                                ! is display state > 0?
    bf      .L_use_default_chars             ! if not, keep default char table in r5
    .byte   0xD5, 0x16    /* mov.l .L_pool_alt_char_tbl, r5 — r5 = alternate digit char table (sym_060338E8) */
.L_use_default_chars:
    .byte   0xD4, 0x17    /* mov.l .L_pool_work_buffer, r4 — r4 = display element work buffer (sym_06062D95) */
    mov #0x6, r1                             ! r1 = 6 digit pairs to copy
.L_copy_char_loop:
    mov.b @r5+, r0                           ! r0 = char table byte (high tile index)
    mov.b r0, @r4                            ! write to work buffer [offset+0]
    add #0x1, r4                             ! advance dest by 1
    mov.b @r5+, r0                           ! r0 = char table byte (low tile index)
    mov.b r0, @r4                            ! write to work buffer [offset+1]
    add #0x3, r4                             ! skip 3 bytes (stride-4 layout: 2 data + 2 gap)
    add #-0x1, r1                            ! decrement loop counter
    mov #0x0, r0                             ! r0 = 0 (comparison value)
    cmp/eq r0, r1                            ! all 6 pairs copied?
    bf      .L_copy_char_loop                ! loop if not done
    mov #0x6, r7                             ! r7 = 6 elements to render
    .byte   0xD8, 0x11    /* mov.l .L_pool_pos_table, r8 — r8 = element XY position table (sym_060338F4) */
    .byte   0xD9, 0x12    /* mov.l .L_pool_render_fn, r9 — r9 = palette/render helper (sym_060430CE) */
    .byte   0xDA, 0x12    /* mov.l .L_pool_src_buffer, r10 — r10 = element source data (sym_060629AC) */
    mov.w @r8+, r4                           ! r4 = X position from table
    mov r4, r5                               ! r5 = copy of X position
    add r10, r4                              ! r4 = src_buffer + X (source address)
    add r9, r5                               ! r5 = render_fn + X (dest address)
    mov.w @r8+, r6                           ! r6 = element width (word count for memcpy)
    .byte   0xD0, 0x10    /* mov.l .L_pool_memcpy_fn, r0 — r0 = memcpy_word_idx */
