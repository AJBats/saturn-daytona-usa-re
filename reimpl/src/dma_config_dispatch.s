/* dma_config_dispatch -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x060039C8 - 0x06003A3C
 * Auto-generated by tools/generate_l3_tu.py
 */

    .section .text.FUN_060039C8


    .global dma_config_dispatch
    .type dma_config_dispatch, @function
dma_config_dispatch:
    mov.l   .L_pool_render_mode_flag, r0    ! r0 = &sym_06083255 (rendering mode / secondary SH-2 active flag)
    mov.b @r0, r0                           ! r0 = *sym_06083255 (byte: non-zero = secondary SH-2 path active)
    tst r0, r0                              ! test if rendering mode flag is zero
    bt      .L_secondary_path               ! if zero, branch to secondary path
    mov.l   .L_pool_dma_chan_idx_primary, r5 ! r5 = &sym_0607EAB8 (primary DMA channel index pointer)
    mov.l @r5, r5                           ! r5 = *sym_0607EAB8 (current primary channel index)
    shll2 r5                                ! r5 *= 4 (scale index to longword offset)
    mov.l   .L_pool_dma_desc_table_primary, r3 ! r3 = sym_0605CA4C (primary DMA descriptor table base)
    add r3, r5                              ! r5 = &primary_desc_table[index] (entry address)
    bra     .L_common_dispatch              ! jump to common dispatch
    mov #0x20, r6                           ! (delay slot) r6 = 0x20 (DMA transfer size for primary path)
.L_secondary_path:
    mov #0x60, r6                           ! r6 = 0x60 (DMA transfer size for secondary path)
    mov.l   .L_pool_dma_chan_idx_secondary, r5 ! r5 = &sym_06078868 (secondary DMA channel index pointer)
    mov.l @r5, r5                           ! r5 = *sym_06078868 (current secondary channel index)
    shll2 r5                                ! r5 *= 4 (scale index to longword offset)
    mov.l   .L_pool_dma_desc_table_secondary, r3 ! r3 = sym_0605C97C (secondary DMA descriptor table base)
    add r3, r5                              ! r5 = &secondary_desc_table[index] (entry address)
.L_common_dispatch:
    mov.l   .L_vdp2_cram_0x400, r4         ! r4 = 0x25F00400 (VDP2 color RAM destination +0x400)
    mov.l   .L_pool_dma_transfer, r2        ! r2 = &dma_transfer (SCU DMA transfer function)
    jmp @r2                                 ! tail-call dma_transfer(dst=r4, src_ptr=r5, size=r6)
    mov.l @r5, r5                           ! (delay slot) r5 = *r5 (dereference descriptor entry to get source address)

    .global sym_060039F2
sym_060039F2:
    mov.l   .L_pool_render_mode_flag, r0    ! r0 = &sym_06083255 (rendering mode / secondary SH-2 active flag)
    mov.b @r0, r0                           ! r0 = *sym_06083255 (byte: non-zero = secondary SH-2 path active)
    tst r0, r0                              ! test if rendering mode flag is zero
    bt      .L_secondary_path_b             ! if zero, branch to secondary path
    mov.l   .L_pool_dma_chan_idx_primary, r5 ! r5 = &sym_0607EAB8 (primary DMA channel index pointer)
    mov.l @r5, r5                           ! r5 = *sym_0607EAB8 (current primary channel index)
    add #0x2, r5                            ! r5 += 2 (offset by 2 entries for this variant)
    shll2 r5                                ! r5 *= 4 (scale index to longword offset)
    mov.l   .L_pool_dma_desc_table_primary, r3 ! r3 = sym_0605CA4C (primary DMA descriptor table base)
    add r3, r5                              ! r5 = &primary_desc_table[index+2] (entry address)
    bra     .L_common_dispatch_b            ! jump to common dispatch
    mov #0x20, r6                           ! (delay slot) r6 = 0x20 (DMA transfer size for primary path)
.L_secondary_path_b:
    mov #0x60, r6                           ! r6 = 0x60 (DMA transfer size for secondary path)
    mov.l   .L_pool_dma_chan_idx_secondary, r5 ! r5 = &sym_06078868 (secondary DMA channel index pointer)
    mov.l @r5, r5                           ! r5 = *sym_06078868 (current secondary channel index)
    add #0xA, r5                            ! r5 += 10 (offset by 10 entries for this variant)
    shll2 r5                                ! r5 *= 4 (scale index to longword offset)
    mov.l   .L_pool_dma_desc_table_secondary, r3 ! r3 = sym_0605C97C (secondary DMA descriptor table base)
    add r3, r5                              ! r5 = &secondary_desc_table[index+10] (entry address)
.L_common_dispatch_b:
    mov.l   .L_vdp2_cram_0x400, r4         ! r4 = 0x25F00400 (VDP2 color RAM destination +0x400)
    mov.l   .L_pool_dma_transfer, r2        ! r2 = &dma_transfer (SCU DMA transfer function)
    jmp @r2                                 ! tail-call dma_transfer(dst=r4, src_ptr=r5, size=r6)
    mov.l @r5, r5                           ! (delay slot) r5 = *r5 (dereference descriptor entry to get source address)
.L_pool_render_mode_flag:
    .4byte  sym_06083255                    ! rendering mode flag (byte): non-zero = secondary SH-2 active
.L_pool_dma_chan_idx_primary:
    .4byte  sym_0607EAB8                    ! pointer to primary DMA channel index word
.L_pool_dma_desc_table_primary:
    .4byte  sym_0605CA4C                    ! base of primary DMA descriptor pointer table
.L_pool_dma_chan_idx_secondary:
    .4byte  sym_06078868                    ! pointer to secondary DMA channel index word
.L_pool_dma_desc_table_secondary:
    .4byte  sym_0605C97C                    ! base of secondary DMA descriptor pointer table
.L_vdp2_cram_0x400:
    .4byte  0x25F00400                  /* VDP2 color RAM +0x400 */
.L_pool_dma_transfer:
    .4byte  dma_transfer                    ! SCU DMA transfer function
