/* vblank_display_write -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06038F78 - 0x0603931C
 * Auto-generated by tools/generate_l3_tu.py
 */

    .section .text.FUN_06038F78


    .global vblank_display_write
    .type vblank_display_write, @function
/* vblank_display_write() — VBlank display commit handler.
 * Called during VBlank to program VDP1 registers (TVMR, FBCR, PTMR, EWDR,
 * EWLR, EWRR) and swap framebuffers. Checks VDP2 TVSTAT for sync.
 * Uses scene_data_dispatch for display list submission.
 */
vblank_display_write:
    sts.l pr, @-r15
    mov.l   .L_scene_data_dispatch, r11
    mov.l   .L_sym_060A4C84, r12
    mov.l   .L_sym_060635C4, r13
    mov.l   .L_sym_060635C0, r14
    mov.l r10, @r12
    mov.l   .L_sym_060635B4, r4
    mov.w @r4, r0
    extu.w r0, r0
    cmp/eq #0x2, r0
    bf      .L_06038FA0
    mov.l @r13, r0
    tst r0, r0
    bt      .L_06039042
    jsr @r11
    nop
    mov #0x2, r3
    mov.l r3, @r12
    bra     .L_06039042
    nop
.L_06038FA0:
    mov.l   .L_sym_060A4C92, r6
    mov.l   .L_vdp1_fbcr, r5
    mov.w @r4, r0
    extu.w r0, r0
    cmp/eq #0x3, r0
    bf      .L_06038FD0
    mov.l @r13, r0
    tst r0, r0
    bt      .L_06039042
    mov.l   .L_sym_060A4C90, r0
    mov.l   .L_vdp1_tvmr, r3
    mov.w @r0, r0
    extu.w r0, r0
    or #0x8, r0
    mov.w r0, @r3
    mov.w @r6, r0
    extu.w r0, r0
    or #0x3, r0
    jsr @r11
    mov.w r0, @r5
    mov #0x3, r3
    mov.l r3, @r12
    bra     .L_06039042
    nop
.L_06038FD0:
    mov.w @r4, r2
    extu.w r2, r2
    tst r2, r2
    bf      .L_06039004
    jsr @r11
    nop
    bra     .L_06039042
    mov.l r10, @r13
.L_scene_data_dispatch:
    .4byte  scene_data_dispatch
.L_sym_060A4C84:
    .4byte  sym_060A4C84
.L_sym_060635C4:
    .4byte  sym_060635C4
.L_sym_060635C0:
    .4byte  sym_060635C0
.L_sym_060635B4:
    .4byte  sym_060635B4
.L_sym_060A4C92:
    .4byte  sym_060A4C92
.L_vdp1_fbcr:
    .4byte  0x25D00002          /* VDP1 FBCR — framebuffer change register */
.L_sym_060A4C90:
    .4byte  sym_060A4C90
.L_vdp1_tvmr:
    .4byte  0x25D00000          /* VDP1 TVMR — TV mode register */
.L_06039004:
    mov.l @r14, r2
    add #0x1, r2
    mov.l r2, @r14
    mov.l   .L_sym_060635B8, r0
    mov.l @r0, r0
    cmp/eq #0x1, r0
    bf      .L_06039028
    mov.l   .L_sym_060635BC, r2
    mov.l @r14, r3
    mov.l @r2, r2
    add #-0x1, r2
    cmp/gt r3, r2
    bt      .L_06039028
    mov.w @r6, r0
    extu.w r0, r0
    or #0x2, r0
    extu.w r0, r0
    mov.w r0, @r5
.L_06039028:
    mov.l   .L_sym_060635BC, r3
    mov.l @r14, r2
    mov.l @r3, r3
    cmp/gt r2, r3
    bt      .L_06039042
    mov.l @r13, r0
    tst r0, r0
    bt      .L_06039040
    jsr @r11
    nop
    mov #0x1, r3
    mov.l r3, @r12
.L_06039040:
    mov.l r10, @r14
.L_06039042:
    lds.l @r15+, pr
    mov.l @r15+, r10
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global vblank_cmd_dispatch
    .type vblank_cmd_dispatch, @function
vblank_cmd_dispatch:
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov.l r12, @-r15
    sts.l pr, @-r15
    mov.l   .L_vdp1_fbcr_2, r12
    mov.l   .L_sym_060A4C92_2, r13
    mov.l   .L_sym_060A4C84_2, r14
    mov.l   .L_sym_060A4C94, r0
    mov.w @r0, r0
    extu.w r0, r0
    tst r0, r0
    bt      .L_060390A4
    mov.l   .L_vdp2_tvstat, r4
    mov.w @r4, r4
    extu.w r4, r0
    tst #0x2, r0
    bt      .L_0603907A
    mov.w @r13, r0
    extu.w r0, r0
    bra     .L_06039080
    or #0xC, r0
.L_0603907A:
    mov.w @r13, r0
    extu.w r0, r0
    or #0x8, r0
.L_06039080:
    extu.w r0, r0
    bra     .L_060390E2
    mov.w r0, @r12
    .2byte  0xFFFF
.L_sym_060635B8:
    .4byte  sym_060635B8
.L_sym_060635BC:
    .4byte  sym_060635BC
.L_vdp1_fbcr_2:
    .4byte  0x25D00002          /* VDP1 FBCR — framebuffer change register */
.L_sym_060A4C92_2:
    .4byte  sym_060A4C92
.L_sym_060A4C84_2:
    .4byte  sym_060A4C84
.L_sym_060A4C94:
    .4byte  sym_060A4C94
.L_vdp2_tvstat:
    .4byte  0x25F80004          /* VDP2 TVSTAT — TV status (VBLANK, HBLANK, ODD) */
.L_060390A4:
    mov.l @r14, r0
    tst r0, r0
    bt      .L_060390E2
    mov.l @r14, r0
    cmp/eq #0x2, r0
    bf      .L_060390BE
    mov.l   .L_sym_060635CC, r0
    mov.l @r0, r0
    tst r0, r0
    bt      .L_060390BE
    mov.l   .L_sym_060394C2, r3
    jsr @r3
    nop
.L_060390BE:
    mov.l @r14, r0
    cmp/eq #0x3, r0
    bf      .L_060390D0
    mov.l   .L_sym_060A4C90_2, r3
    mov.w @r3, r3
    mov.l   .L_vdp1_tvmr_2, r2
    mov.w r3, @r2
    bra     .L_060390DA
    nop
.L_060390D0:
    mov.w @r13, r0
    extu.w r0, r0
    or #0x3, r0
    extu.w r0, r0
    mov.w r0, @r12
.L_060390DA:
    mov #0x0, r4
    mov.l   .L_sym_060635C4_2, r3
    mov.l r4, @r3
    mov.l r4, @r14
.L_060390E2:
    lds.l @r15+, pr
    mov.l @r15+, r12
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14
.L_sym_060635CC:
    .4byte  sym_060635CC
.L_sym_060394C2:
    .4byte  sym_060394C2
.L_sym_060A4C90_2:
    .4byte  sym_060A4C90
.L_vdp1_tvmr_2:
    .4byte  0x25D00000          /* VDP1 TVMR — TV mode register */
.L_sym_060635C4_2:
    .4byte  sym_060635C4
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000
    .4byte  0x00000000

    .global vdp2_scroll_update
    .type vdp2_scroll_update, @function
vdp2_scroll_update:
    mov.l r14, @-r15
    mov.l r13, @-r15
    sts.l pr, @-r15
    mov r4, r14
    stc sr, r0
    shlr2 r0
    shlr2 r0
    and #0xF, r0
    mov r0, r13
    stc sr, r0
    mov.w   DAT_060392e6, r3
    and r3, r0
    or #0xF0, r0
    ldc r0, sr
    .byte   0xB1, 0x40    /* bsr 0x060394F0 (external) */
    mov #0x0, r4
    mov #0x0, r6
    mov #0x0, r5
    .byte   0xB0, 0x52    /* bsr 0x0603931C (external) */
    mov #0x0, r4
    mov.l   .L_sym_060A4C92_3, r2
    mov #0x0, r6
    mov.l   .L_vdp1_fbcr_3, r3
    mov.w @r2, r2
    mov.w r2, @r3
    mov #0x2, r2
    mov.l   .L_vdp1_ptmr, r3
    mov.w r2, @r3
    mov.l   .L_fp_half, r2
    mov.l   .L_vdp1_ewdr, r3
    mov.w r2, @r3
    mov #0x0, r2
    mov.l   .L_vdp1_ewlr, r3
    mov.w r2, @r3
    mov.l   .L_mask_16bit, r2
    mov.l   .L_vdp1_ewrr, r3
    mov.w r2, @r3
    mov.l   .L_sym_060A4C8C, r2
    mov.l @r2, r2
    add #-0x1, r2
    extu.w r2, r2
    mov.l r2, @-r15
    mov.l   .L_sym_060A4C88, r7
    mov.l   .L_fp_half, r4
    mov.l @r7, r7
    add #-0x1, r7
    extu.w r7, r7
    .byte   0xB0, 0xA5    /* bsr 0x060393FC (external) */
    mov #0x0, r5
    add #0x4, r15
    mov.l   .L_vdp1_vram_00000, r2
    mov.l r2, @r14
    mov r2, r3
    mov.w   .L_bit_7_w, r2
    mov.b r2, @r3
    mov.l @r14, r3
    add #0x1, r3
    mov #0x0, r2
    mov.b r2, @r3
    mov r13, r0
    and #0xF, r0
    shll2 r0
    shll2 r0
    stc sr, r3
    mov.w   DAT_060392e6, r2
    and r2, r3
    or r3, r0
    ldc r0, sr
    mov #0x1, r3
    mov.l   .L_sym_060635CC_2, r2
    mov.l r3, @r2
    lds.l @r15+, pr
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global DAT_060392e6
DAT_060392e6:
    .2byte  0xFF0F
.L_bit_7_w:
    .2byte  0x0080
    .2byte  0xFFFF
.L_sym_060A4C92_3:
    .4byte  sym_060A4C92
.L_vdp1_fbcr_3:
    .4byte  0x25D00002          /* VDP1 FBCR — framebuffer change */
.L_vdp1_ptmr:
    .4byte  0x25D00004          /* VDP1 PTMR — plot trigger */
.L_fp_half:
    .4byte  0x00008000          /* bit15 mask (MSB test) */
.L_vdp1_ewdr:
    .4byte  0x25D00006          /* VDP1 EWDR — erase fill color */
.L_vdp1_ewlr:
    .4byte  0x25D00008          /* VDP1 EWLR — erase upper-left coords */
.L_mask_16bit:
    .4byte  0x0000FFFF          /* 16-bit mask */
.L_vdp1_ewrr:
    .4byte  0x25D0000A          /* VDP1 EWRR — erase lower-right coords */
.L_sym_060A4C8C:
    .4byte  sym_060A4C8C
.L_sym_060A4C88:
    .4byte  sym_060A4C88
.L_vdp1_vram_00000:
    .4byte  0x25C00000          /* VDP1 VRAM base (cache-through) */
.L_sym_060635CC_2:
    .4byte  sym_060635CC
