/* cdb_read_status -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06018EAC - 0x06018EE4
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Functions:
 *   cdb_read_status()       — read CD block status byte, masked to 5 bits
 *   scsp_set_master_volume() — set SCSP master output volume (slots 16+17)
 */

    .section .text.FUN_06018EAC


    .global cdb_read_status
    .type cdb_read_status, @function
/* cdb_read_status() -> r0 = CD tray status (5-bit, 0x00-0x1F)
 * Calls ai_section_transition to fill a 12-byte buffer on stack,
 * reads first byte, masks to 5 bits. Caller uses bottom 4 bits
 * as CD tray status.
 */
cdb_read_status:
    sts.l pr, @-r15             /* save return address */
    add #-0xC, r15              /* allocate 12-byte stack buffer */
    mov.l   .L_ai_section_transition, r3
    jsr @r3                     /* ai_section_transition(buffer) */
    mov r15, r4                 /* delay: r4 = stack buffer ptr */
    mov r15, r0
    mov #0x1F, r4               /* 5-bit mask */
    mov.b @r0, r0               /* r0 = first byte of result */
    add #0xC, r15               /* deallocate stack */
    extu.b r0, r0               /* zero-extend byte */
    lds.l @r15+, pr
    and r0, r4                  /* r4 = status & 0x1F */
    rts
    mov r4, r0                  /* return masked status */

    .global scsp_set_master_volume
/* scsp_set_master_volume() — write 0xE0 to SCSP slots 16+17 EFSDL/EFPAN
 * Sets effect send level for main audio output channels.
 */
scsp_set_master_volume:
    mov.w   .L_scsp_efsdl_val, r4
    mov.l   .L_scsp_slot16_efsdl, r2
    extu.b r4, r3               /* r3 = 0xE0 */
    mov.b r3, @r2               /* slot 16 EFSDL = 0xE0 */
    mov.l   .L_scsp_slot17_efsdl, r3
    rts
    mov.b r4, @r3               /* slot 17 EFSDL = 0xE0 */
.L_scsp_efsdl_val:
    .2byte  0x00E0              /* SCSP effect send level */
.L_ai_section_transition:
    .4byte  ai_section_transition
.L_scsp_slot16_efsdl:
    .4byte  0x25B00217          /* SCSP slot 16 EFSDL register */
.L_scsp_slot17_efsdl:
    .4byte  0x25B00237          /* SCSP slot 17 EFSDL register */
