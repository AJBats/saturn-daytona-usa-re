/* preview_camera_pos -- course teardown + variant reinit + sound trigger
 * Translation unit: 0x0601A770 - 0x0601A7AC
 *
 * Called during the track preview camera sequence. Performs up to three
 * actions depending on flag state:
 *
 *   1. If course_active_flag (sym_06085FF6) is set:
 *      - Calls load_gamed_lowram (sym_06012EC4) to reload GAMED.BIN
 *      - Calls load_slctd_lowram (sym_06012F00) to reload SLCTD.BIN
 *      - Clears course_active_flag
 *
 *   2. If variant_init_flag (sym_06085FF7) is set:
 *      - Calls race_variant_e to reinitialize the race variant
 *      - Clears variant_init_flag
 *
 *   3. Unconditionally tail-calls sound_cmd_dispatch(0, 0xAE0001FF)
 *      to send the sound init command.
 *
 * Pool entries live in the next section (preview_camera_target) and are
 * accessed via cross-section PC-relative mov.l (emitted as raw bytes).
 *
 * Auto-generated by tools/generate_l3_tu.py, then annotated.
 */

    .section .text.FUN_0601A770


    .global preview_camera_pos
    .type preview_camera_pos, @function
preview_camera_pos:
    sts.l pr, @-r15                         ! save PR (return address)
    .byte   0xD0, 0x1C    /* mov.l .L_ptr_course_active_flag, r0 */
    mov.b @r0, r0                           ! r0 = course_active_flag byte
    extu.b r0, r0                           ! zero-extend to 32-bit
    tst r0, r0                              ! course active?
    bt      .L_check_variant                ! no -> skip teardown
    .byte   0xD3, 0x1A    /* mov.l .L_fn_load_gamed_lowram, r3 */
    jsr @r3                                 ! call load_gamed_lowram()
    nop                                     ! (delay)
    .byte   0xD3, 0x1A    /* mov.l .L_fn_load_slctd_lowram, r3 */
    jsr @r3                                 ! call load_slctd_lowram()
    nop                                     ! (delay)
    mov #0x0, r2                            ! r2 = 0
    .byte   0xD3, 0x16    /* mov.l .L_ptr_course_active_flag, r3 */
    mov.b r2, @r3                           ! course_active_flag = 0 (cleared)
.L_check_variant:
    .byte   0xD2, 0x18    /* mov.l .L_ptr_variant_init_flag, r2 */
    mov.b @r2, r2                           ! r2 = variant_init_flag byte
    tst r2, r2                              ! variant needs init?
    bt      .L_send_sound_cmd               ! no -> skip variant init
    .byte   0xD3, 0x17    /* mov.l .L_fn_race_variant_e, r3 */
    jsr @r3                                 ! call race_variant_e()
    nop                                     ! (delay)
    mov #0x0, r2                            ! r2 = 0
    .byte   0xD3, 0x14    /* mov.l .L_ptr_variant_init_flag, r3 */
    mov.b r2, @r3                           ! variant_init_flag = 0 (cleared)
.L_send_sound_cmd:
    .byte   0xD5, 0x15    /* mov.l .L_snd_init_cmd, r5 */
    mov #0x0, r4                            ! r4 = 0 (channel arg)
    .byte   0xD3, 0x15    /* mov.l .L_fn_sound_cmd_dispatch, r3 */
    jmp @r3                                 ! tail-call sound_cmd_dispatch(0, 0xAE0001FF)
    lds.l @r15+, pr                         ! (delay) restore PR
