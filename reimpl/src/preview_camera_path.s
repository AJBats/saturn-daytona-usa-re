/* preview_camera_path -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0601AAE8 - 0x0601ABC8
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Course preview camera path — two functions:
 *
 * preview_camera_path (0x0601AAE8):
 *   Triggered by status word & 0x0700 (any of bits 8-10 set).
 *   Sets up the course preview flythrough camera sequence:
 *     1. Set game_state = 0x1E (preview mode)
 *     2. Configure 7 camera/preview flags
 *     3. Display layer setup(0xC) + render config
 *     4. course_select_draw() — draw course selection screen
 *     5. sound_cmd_dispatch(0xF, 0xAE0001FF) — preview music
 *     6. Tail-call handler_init_reset()
 *
 * sym_0601AB8C (camera path data lookup):
 *   Reads path_index byte, computes table offset (index * 12),
 *   looks up camera position and orientation from data tables,
 *   stores results to camera state registers.
 *
 * sym_0601ABC6 (stub):
 *   Sets r4 = 0 (fallthrough or inline helper).
 */

    .section .text.FUN_0601AAE8


    .global preview_camera_path
    .type preview_camera_path, @function
preview_camera_path:
    sts.l pr, @-r15
    mov.l   .L_status_word, r3
    mov.w @r3, r2
    extu.w r2, r2
    mov.w   .L_preview_button_mask, r3  /* 0x0700 = bits 8-10 */
    and r3, r2
    tst r2, r2
    bt      .L_0601AB48                  /* no preview button → return */
    mov #0x1E, r3                        /* === Begin preview setup === */
    mov.l   .L_game_state, r2
    mov #0x1, r5
    mov #0x0, r4
    mov.l r3, @r2                        /* game_state = 0x1E (preview) */
    exts.b r4, r0
    extu.b r5, r3
    mov.l   .L_preview_flag_a, r2
    exts.b r5, r5
    mov.b r3, @r2                        /* preview_flag_a = 1 */
    mov.l   .L_preview_flag_b, r2
    mov.b r4, @r2                        /* preview_flag_b = 0 */
    mov.l   .L_preview_flag_c, r2
    mov.b r0, @r2                        /* preview_flag_c = 0 */
    mov.l   .L_preview_flag_d, r3
    mov.b r5, @r3                        /* preview_flag_d = 1 */
    mov.l   .L_preview_flag_e, r3
    mov.b r4, @r3                        /* preview_flag_e = 0 */
    extu.b r4, r4
    mov.l   .L_preview_flag_f, r3
    mov.b r4, @r3                        /* preview_flag_f = 0 */
    mov.l   .L_fn_layer_config, r3
    jsr @r3                              /* display_layer_config(0xC) */
    mov #0xC, r4
    mov.l   .L_render_flags, r4        /* --- set render bit --- */
    mov.l   .L_fn_render_commit, r3
    mov.l @r4, r0
    or #0x4, r0                          /* set bit 2 */
    jsr @r3                              /* render_commit(flags|4) */
    mov.l r0, @r4
    mov.l   .L_fn_course_draw, r3
    jsr @r3                              /* course_select_draw() */
    nop
    mov.l   .L_snd_cmd_preview, r5     /* 0xAE0001FF = preview music */
    mov.l   .L_fn_sound_dispatch, r3
    jsr @r3                              /* sound_cmd_dispatch(0xF, preview_cmd) */
    mov #0xF, r4
    mov.l   .L_fn_handler_reset, r3
    jmp @r3                              /* → handler_init_reset() (tail call) */
    lds.l @r15+, pr
.L_0601AB48:                              /* --- no preview: return --- */
    lds.l @r15+, pr
    rts
    nop
.L_preview_button_mask:
    .2byte  0x0700                        /* preview trigger: bits 8-10 */
.L_status_word:
    .4byte  sym_06063D9A               /* input status word (16-bit) */
.L_game_state:
    .4byte  g_game_state               /* game state dispatch value */
.L_preview_flag_a:
    .4byte  sym_0605E0A2               /* preview camera flag A (byte) */
.L_preview_flag_b:
    .4byte  sym_06085FF0               /* preview camera flag B (byte) */
.L_preview_flag_c:
    .4byte  sym_0605D245               /* preview camera flag C (byte) */
.L_preview_flag_d:
    .4byte  sym_06085FF1               /* preview camera flag D (byte) */
.L_preview_flag_e:
    .4byte  sym_06085FF2               /* preview camera flag E (byte) */
.L_preview_flag_f:
    .4byte  sym_06085FF3               /* preview camera flag F (byte) */
.L_fn_layer_config:
    .4byte  sym_0602853E               /* display layer configuration */
.L_render_flags:
    .4byte  sym_0605B6D8               /* render mode flags (32-bit) */
.L_fn_render_commit:
    .4byte  sym_06028560               /* render state commit */
.L_fn_course_draw:
    .4byte  course_select_draw         /* course selection screen draw */
.L_snd_cmd_preview:
    .4byte  0xAE0001FF                  /* sound command: preview music */
.L_fn_sound_dispatch:
    .4byte  sound_cmd_dispatch         /* sound command dispatcher */
.L_fn_handler_reset:
    .4byte  handler_init_reset         /* handler initialization reset */

    .global sym_0601AB8C
sym_0601AB8C:                             /* === Camera path data lookup === */
    .byte   0xD4, 0x21    /* mov.l .L_path_index, r4 — path index ptr */
    .byte   0xD2, 0x22    /* mov.l .L_path_table_base, r2 — path table */
    mov.l @r4, r0                        /* path_index (byte) */
    exts.b r0, r0
    mov r0, r3
    shll2 r0                             /* index * 4 */
    shll2 r3
    shll r3                              /* index * 8 */
    add r3, r0                           /* index * 12 (4 + 8) */
    exts.b r0, r0                        /* sign-extend offset */
    .byte   0xD3, 0x1E    /* mov.l .L_path_data_index, r3 — data index */
    add r2, r0                           /* &path_table[index * 12] */
    mov.l @r3, r3                        /* data_index value */
    shll2 r3                             /* data_index * 4 */
    mov.l @(r0, r3), r1                 /* path_table[idx * 12 + data_index * 4] */
    .byte   0xD3, 0x1D    /* mov.l .L_camera_pos_store, r3 — camera pos */
    mov.l r1, @r3                        /* store camera position data */
    mov.l @r4, r0                        /* re-read path_index */
    .byte   0xD3, 0x1C    /* mov.l .L_orient_data_index, r3 — orient index */
    .byte   0xD2, 0x1D    /* mov.l .L_orient_table, r2 — orient table */
    shll r0                              /* index * 2 */
    mov.l @r3, r3                        /* orient_data_index value */
    add r3, r0
    shll2 r0                             /* (index * 2 + orient_idx) * 4 */
    mov.l @(r0, r2), r4                 /* orient_table[...] */
    mov.l @(4, r4), r1                  /* orient_entry[+4] = orientation data */
    .byte   0xD0, 0x1A    /* mov.l .L_camera_orient_store, r0 — orient dest */
    rts
    mov.l r1, @r0                        /* store camera orientation */

    .global sym_0601ABC6
sym_0601ABC6:                             /* === Stub: clear r4 === */
    mov #0x0, r4
