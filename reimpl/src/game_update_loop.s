/* game_update_loop -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06033BC8 - 0x06034E20
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Main game update loop and per-frame subsystem dispatch.
 * Contains:
 *   - camera_attract_init: Attract mode camera animation — dispatches
 *     display element rendering in 3 range-gated phases (time extend
 *     digits, selector thunks, extended selector thunks).
 *   - disp_score_renderer: Score display state machine (phase 0-2).
 *   - sym_06033F54: Core display element renderer — indexes into a
 *     0x2C-byte element array, dispatches position update, camera
 *     path interpolation, and animation frame advance per element.
 *   - Camera path modes 1-4: velocity integration (XYZ axes),
 *     rotation adjustments, direct camera writes.
 *   - vblank_handler: Per-frame update — rank calculation, blink
 *     state cycling, checkpoint sound triggers.
 *   - terrain_data_lookup: Sound volume from speed + checkpoint sfx.
 *   - SMPC peripheral I/O: ai_checkpoint_section, cd_block_read_atomic
 *     (interrupt-safe double-read with SR mask), ai_pit_stop_logic,
 *     track_intersect_test, road_segment_query, ai_drafting_calc.
 *   - ai_throttle_adjust: 5-case switch for throttle response encoding.
 *   - ai_recovery_handler: Recovery input formatting.
 */

    .section .text.FUN_06033BC8


    .global camera_attract_init
    .type camera_attract_init, @function
camera_attract_init:
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov.l r12, @-r15
    mov.l r11, @-r15
    mov.l r10, @-r15
    mov.l r9, @-r15
    mov.l r8, @-r15
    mov.l   .L_game_state_ptr, r0      ! r0 = &game_state
    mov.l @r0, r0                      ! r0 = game_state
    mov.l   .L_state_field_1EC, r1
    mov.l @(r0, r1), r1                ! r1 = game_state[0x1EC] (frame counter)
    mov.l   .L_range_min_DC, r0
    cmp/ge r0, r1                      ! frame >= 0xDC?
    bf      .L_range_check_fail_1
    mov.l   .L_range_max_EC, r0
    cmp/gt r0, r1                      ! frame > 0xEC?
    bt      .L_range_check_fail_1
    bra     .L_range_check_pass_1      ! in range: set T bit
    sett
    .2byte  0x0000
.L_game_state_ptr:
    .4byte  sym_0607E944
.L_state_field_1EC:
    .4byte  0x000001EC
.L_range_min_DC:
    .4byte  0x000000DC
.L_range_max_EC:
    .4byte  0x000000EC
.L_range_check_fail_1:
    clrt
.L_range_check_pass_1:
    bf      .L_skip_timeext_digits
    mov #0x0, r4
    mov.l   .L_fn_disp_elem_render, r0

    .global disp_timeext_digit_0
    .type disp_timeext_digit_0, @function
disp_timeext_digit_0:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov #0x1, r4
    mov.l   .L_fn_disp_elem_render, r0

    .global disp_timeext_digit_1
    .type disp_timeext_digit_1, @function
disp_timeext_digit_1:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov #0x2, r4
    mov.l   .L_fn_disp_elem_render, r0

    .global disp_timeext_digit_2
    .type disp_timeext_digit_2, @function
disp_timeext_digit_2:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    bra     .L_check_sel_range
    nop
.L_fn_disp_elem_render:
    .4byte  sym_06033F54
.L_skip_timeext_digits:
    mov.l   .L_fn_clear_anim_state, r0

    .global time_extend_digits
    .type time_extend_digits, @function
time_extend_digits:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
.L_check_sel_range:
    mov.l   .L_game_state_ptr_2, r0
    mov.l @r0, r0
    mov.l   .L_state_field_1EC_2, r1
    mov.l @(r0, r1), r1
    mov.l   .L_range_min_ED, r0
    cmp/ge r0, r1
    bf      .L_range_check_fail_2
    mov.l   .L_range_max_104, r0
    cmp/gt r0, r1
    bt      .L_range_check_fail_2
    bra     .L_range_check_pass_2
    sett
    .2byte  0x0000
.L_fn_clear_anim_state:
    .4byte  sym_0603446C
.L_game_state_ptr_2:
    .4byte  sym_0607E944
.L_state_field_1EC_2:
    .4byte  0x000001EC
.L_range_min_ED:
    .4byte  0x000000ED
.L_range_max_104:
    .4byte  0x00000104
.L_range_check_fail_2:
    clrt
.L_range_check_pass_2:
    bf      .L_check_selext_range
    mov #0x5, r4

    .global disp_sel_thunk_00
    .type disp_sel_thunk_00, @function
disp_sel_thunk_00:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x6, r4

    .global disp_sel_thunk_01
    .type disp_sel_thunk_01, @function
disp_sel_thunk_01:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x7, r4

    .global disp_sel_thunk_02
    .type disp_sel_thunk_02, @function
disp_sel_thunk_02:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x8, r4

    .global disp_sel_thunk_03
    .type disp_sel_thunk_03, @function
disp_sel_thunk_03:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x9, r4

    .global disp_sel_thunk_04
    .type disp_sel_thunk_04, @function
disp_sel_thunk_04:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0xA, r4

    .global disp_sel_thunk_05
    .type disp_sel_thunk_05, @function
disp_sel_thunk_05:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0xB, r4

    .global disp_sel_thunk_06
    .type disp_sel_thunk_06, @function
disp_sel_thunk_06:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0xC, r4

    .global disp_sel_thunk_07
    .type disp_sel_thunk_07, @function
disp_sel_thunk_07:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0xD, r4

    .global disp_sel_thunk_08
    .type disp_sel_thunk_08, @function
disp_sel_thunk_08:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0xE, r4

    .global disp_sel_thunk_09
    .type disp_sel_thunk_09, @function
disp_sel_thunk_09:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0xF, r4

    .global disp_sel_thunk_10
    .type disp_sel_thunk_10, @function
disp_sel_thunk_10:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x10, r4

    .global disp_sel_thunk_11
    .type disp_sel_thunk_11, @function
disp_sel_thunk_11:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x11, r4

    .global disp_sel_thunk_12
    .type disp_sel_thunk_12, @function
disp_sel_thunk_12:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x12, r4

    .global disp_sel_thunk_13
    .type disp_sel_thunk_13, @function
disp_sel_thunk_13:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x13, r4

    .global disp_sel_thunk_14
    .type disp_sel_thunk_14, @function
disp_sel_thunk_14:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x14, r4

    .global disp_sel_thunk_15
    .type disp_sel_thunk_15, @function
disp_sel_thunk_15:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x15, r4

    .global disp_sel_thunk_16
    .type disp_sel_thunk_16, @function
disp_sel_thunk_16:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x16, r4

    .global disp_sel_thunk_17
    .type disp_sel_thunk_17, @function
disp_sel_thunk_17:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x17, r4

    .global disp_sel_thunk_18
    .type disp_sel_thunk_18, @function
disp_sel_thunk_18:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x18, r4

    .global selector_group_render
    .type selector_group_render, @function
selector_group_render:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
.L_check_selext_range:
    mov.l   .L_game_state_ptr_3, r0
    mov.l @r0, r0
    mov.l   .L_state_field_1EC_3, r1
    mov.l @(r0, r1), r1
    mov.l   .L_range_min_1B8, r0
    cmp/ge r0, r1
    bf      .L_range_check_fail_3
    mov.l   .L_range_max_1E0, r0
    cmp/gt r0, r1
    bt      .L_range_check_fail_3
    bra     .L_range_check_pass_3
    sett
.L_game_state_ptr_3:
    .4byte  sym_0607E944
.L_state_field_1EC_3:
    .4byte  0x000001EC
.L_range_min_1B8:
    .4byte  0x000001B8
.L_range_max_1E0:
    .4byte  0x000001E0
.L_range_check_fail_3:
    clrt
.L_range_check_pass_3:
    bt      .L_selext_range_active
    bra     .L_reset_anim_counter
    nop
.L_selext_range_active:
    mov.l   .L_selext_enable_flag, r0
    mov.l @r0, r0
    tst r0, r0
    bf      .L_selext_dispatch
    bra     .L_attract_return
    nop
.L_selext_enable_flag:
    .4byte  sym_0607EAE0
.L_selext_dispatch:
    mov.l   .L_selext_start_idx, r4

    .global disp_selext_thunk_00
    .type disp_selext_thunk_00, @function
disp_selext_thunk_00:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l   .L_anim_frame_counter, r0
    mov.l @r0, r13
    mov.l   .L_selext_phase2_threshold, r0
    cmp/ge r0, r13
    bf      .L_selext_advance_counter
    mov.l   .L_selext_idx_1A, r4

    .global disp_selext_thunk_01
    .type disp_selext_thunk_01, @function
disp_selext_thunk_01:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l   .L_selext_idx_1B, r4

    .global disp_selext_thunk_02
    .type disp_selext_thunk_02, @function
disp_selext_thunk_02:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l   .L_selext_idx_1C, r4

    .global disp_selext_thunk_03
    .type disp_selext_thunk_03, @function
disp_selext_thunk_03:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l   .L_selext_idx_1D, r4

    .global disp_selext_thunk_04
    .type disp_selext_thunk_04, @function
disp_selext_thunk_04:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l   .L_selext_phase3_threshold, r0
    cmp/ge r0, r13
    bf      .L_selext_advance_counter
    mov #0x1E, r4

    .global disp_selext_thunk_05
    .type disp_selext_thunk_05, @function
disp_selext_thunk_05:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x1F, r4

    .global disp_selext_thunk_06
    .type disp_selext_thunk_06, @function
disp_selext_thunk_06:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x20, r4

    .global disp_selext_thunk_07
    .type disp_selext_thunk_07, @function
disp_selext_thunk_07:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x21, r4

    .global disp_selext_thunk_08
    .type disp_selext_thunk_08, @function
disp_selext_thunk_08:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x22, r4

    .global disp_selext_thunk_09
    .type disp_selext_thunk_09, @function
disp_selext_thunk_09:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l   .L_selext_phase4_threshold, r0
    cmp/ge r0, r13
    bf      .L_selext_advance_counter
    mov #0x23, r4

    .global disp_selext_thunk_10
    .type disp_selext_thunk_10, @function
disp_selext_thunk_10:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x24, r4

    .global disp_selext_thunk_11
    .type disp_selext_thunk_11, @function
disp_selext_thunk_11:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x25, r4

    .global disp_selext_thunk_12
    .type disp_selext_thunk_12, @function
disp_selext_thunk_12:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x26, r4

    .global disp_selext_thunk_13
    .type disp_selext_thunk_13, @function
disp_selext_thunk_13:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x27, r4

    .global disp_selext_thunk_14
    .type disp_selext_thunk_14, @function
disp_selext_thunk_14:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x28, r4

    .global disp_selext_thunk_15
    .type disp_selext_thunk_15, @function
disp_selext_thunk_15:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x29, r4

    .global disp_selext_thunk_16
    .type disp_selext_thunk_16, @function
disp_selext_thunk_16:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x2A, r4

    .global disp_selext_thunk_17
    .type disp_selext_thunk_17, @function
disp_selext_thunk_17:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x2B, r4

    .global disp_selext_thunk_18
    .type disp_selext_thunk_18, @function
disp_selext_thunk_18:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov #0x2C, r4

    .global score_display_render
    .type score_display_render, @function
score_display_render:
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
.L_selext_advance_counter:
    mov.l   .L_anim_frame_counter, r1
    mov.l @r1, r0
    add #0x1, r0
    mov.l   .L_anim_frame_max, r2
    cmp/ge r2, r0
    bf      .L_clamp_counter
    mov.l   .L_anim_frame_max, r0
.L_clamp_counter:
    bra     .L_attract_return
    mov.l r0, @r1
.L_selext_start_idx:
    .4byte  0x00000019
.L_anim_frame_counter:
    .4byte  sym_06083250
.L_selext_phase2_threshold:
    .4byte  0x0000013B
.L_selext_idx_1A:
    .4byte  0x0000001A
.L_selext_idx_1B:
    .4byte  0x0000001B
.L_selext_idx_1C:
    .4byte  0x0000001C
.L_selext_idx_1D:
    .4byte  0x0000001D
.L_selext_phase3_threshold:
    .4byte  0x00000276
.L_selext_phase4_threshold:
    .4byte  0x000003B1
.L_anim_frame_max:
    .4byte  0x00000EC4
.L_reset_anim_counter:
    xor r0, r0
    mov.l   .L_anim_frame_counter_2, r1
    mov.l r0, @r1
.L_attract_return:
    mov.l @r15+, r8
    mov.l @r15+, r9
    mov.l @r15+, r10
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    mov.l @r15+, r14
    rts
    nop
.L_anim_frame_counter_2:
    .4byte  sym_06083250

    .global disp_score_renderer
    .type disp_score_renderer, @function
disp_score_renderer:
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov.l r12, @-r15
    mov.l r11, @-r15
    mov.l r10, @-r15
    mov.l r9, @-r15
    mov.l r8, @-r15
    mov.l   .L_game_mode_flag, r0
    mov.w @r0, r0
    cmp/eq #0x1, r0
    bf      .L_check_score_phase
    mov.l   .L_score_render_phase, r1
    mov.b @r1, r0
    add #0x1, r0
    mov.b r0, @r1
.L_check_score_phase:
    mov.l   .L_score_render_phase, r0
    mov.b @r0, r0
    cmp/eq #0x1, r0
    bf      .L_check_score_clear
    mov.l   .L_score_digit_idx_0, r4
    mov.l   .L_fn_disp_elem_render_2, r0

    .global disp_score_digit_0
    .type disp_score_digit_0, @function
disp_score_digit_0:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_score_digit_idx_1, r4
    mov.l   .L_fn_disp_elem_render_2, r0

    .global disp_score_digit_1
    .type disp_score_digit_1, @function
disp_score_digit_1:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_score_digit_idx_2, r4
    mov.l   .L_fn_disp_elem_render_2, r0

    .global disp_score_digit_2
    .type disp_score_digit_2, @function
disp_score_digit_2:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_score_digit_idx_4, r4
    mov.l   .L_fn_disp_elem_render_2, r0

    .global bonus_points_display
    .type bonus_points_display, @function
bonus_points_display:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
.L_check_score_clear:
    mov.l   .L_score_render_phase, r0
    mov.b @r0, r0
    cmp/eq #0x2, r0
    bf      .L_score_render_done
    mov.l   .L_score_clear_start_idx, r4
.L_score_clear_loop:
    mov.l r4, @-r15
    sts.l pr, @-r15
    bsr     sym_06033F54
    nop
    lds.l @r15+, pr
    mov.l @r15+, r4
    add #0x1, r4
    mov.l   .L_score_clear_end_idx, r0
    cmp/ge r0, r4
    bf      .L_score_clear_loop
.L_score_render_done:
    mov.l @r15+, r8
    mov.l @r15+, r9
    mov.l @r15+, r10
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    mov.l @r15+, r14
    rts
    nop
    .2byte  0x0000
.L_game_mode_flag:
    .4byte  sym_06063E08
.L_score_render_phase:
    .4byte  sym_06083254
.L_score_digit_idx_0:
    .4byte  0x00000000
.L_fn_disp_elem_render_2:
    .4byte  sym_06033F54
.L_score_digit_idx_1:
    .4byte  0x00000001
.L_score_digit_idx_2:
    .4byte  0x00000002
.L_score_digit_idx_4:
    .4byte  0x00000004
.L_score_clear_start_idx:
    .4byte  0x00000006
.L_score_clear_end_idx:
    .4byte  0x00000019

    .global sym_06033F54
sym_06033F54:                           ! Display element renderer (r4 = element index)
    mov.l r13, @-r15
    mov.l   .L_elem_struct_size, r1    ! struct size = 0x2C
    mulu.w r4, r1                      ! offset = index * 0x2C
    sts macl, r0
    mov.l   .L_elem_array_base, r14
    add r0, r14                        ! r14 = &elem_array[index]
    mov.l   .L_game_state_ptr_4, r0
    mov.l @r0, r10                     ! r10 = game_state
    mov.l   .L_elem_type_offset, r0
    mov.b @(r0, r14), r0              ! r0 = elem.type
    cmp/eq #0x1, r0                    ! type 1 or 4: pos update only
    bt      disp_end_stub_0
    cmp/eq #0x4, r0
    bt      disp_end_stub_0
    mov.l   .L_elem_anim_mode_offset, r0
    mov.b @(r0, r14), r0              ! r0 = elem.anim_mode
    cmp/eq #0x0, r0                    ! mode 0: distance calc path
    bt      disp_end_stub_2
    cmp/eq #0x1, r0                    ! mode 1: heading init path
    bt      disp_end_stub_6
    cmp/eq #0x2, r0                    ! mode 2: collision path
    bt      disp_end_stub_7

    .global disp_end_stub_0
    .type disp_end_stub_0, @function
disp_end_stub_0:
    sts.l pr, @-r15
    bsr     .L_update_position
    nop
    lds.l @r15+, pr

    .global disp_end_stub_1
    .type disp_end_stub_1, @function
disp_end_stub_1:
    sts.l pr, @-r15
    bsr     .L_camera_path_dispatch
    nop
    lds.l @r15+, pr

    .global display_frame_mgr
    .type display_frame_mgr, @function
display_frame_mgr:
    sts.l pr, @-r15
    bsr     .L_advance_anim_frame
    nop
    lds.l @r15+, pr
    bra     .L_elem_render_return
    nop
.L_elem_struct_size:
    .4byte  0x0000002C
.L_elem_array_base:
    .4byte  DAT_06082A7C
.L_game_state_ptr_4:
    .4byte  sym_0607E944
.L_elem_type_offset:
    .4byte  0x00000001
.L_elem_anim_mode_offset:
    .4byte  0x00000026

    .global disp_end_stub_2
    .type disp_end_stub_2, @function
disp_end_stub_2:
    sts.l pr, @-r15
    bsr     .L_calc_distance
    nop
    lds.l @r15+, pr

    .global disp_end_stub_3
    .type disp_end_stub_3, @function
disp_end_stub_3:
    sts.l pr, @-r15
    bsr     .L_update_position
    nop
    lds.l @r15+, pr

    .global disp_end_stub_4
    .type disp_end_stub_4, @function
disp_end_stub_4:
    sts.l pr, @-r15
    bsr     .L_camera_path_dispatch
    nop
    lds.l @r15+, pr

    .global disp_end_stub_5
    .type disp_end_stub_5, @function
disp_end_stub_5:
    sts.l pr, @-r15
    bsr     .L_advance_anim_frame
    nop
    lds.l @r15+, pr
    bra     .L_elem_render_return
    nop

    .global disp_end_stub_6
    .type disp_end_stub_6, @function
disp_end_stub_6:
    sts.l pr, @-r15
    bsr     .L_init_heading_transfer
    nop
    lds.l @r15+, pr

    .global disp_end_stub_7
    .type disp_end_stub_7, @function
disp_end_stub_7:
    sts.l pr, @-r15
    bsr     .L_calc_distance
    nop
    lds.l @r15+, pr

    .global disp_end_stub_8
    .type disp_end_stub_8, @function
disp_end_stub_8:
    sts.l pr, @-r15
    bsr     .L_collision_pos_update
    nop
    lds.l @r15+, pr

    .global disp_end_stub_9
    .type disp_end_stub_9, @function
disp_end_stub_9:
    sts.l pr, @-r15
    bsr     .L_spawn_cam_setup
    nop
    lds.l @r15+, pr

    .global display_frame_flush
    .type display_frame_flush, @function
display_frame_flush:
    sts.l pr, @-r15
    bsr     .L_advance_anim_frame
    nop
    lds.l @r15+, pr
.L_elem_render_return:
    rts
    mov.l @r15+, r13
.L_update_position:
    mov.l   .L_elem_type_ofs_frame, r0
    mov.b @(r0, r14), r0
    cmp/eq #0x3, r0
    bf      .L_pos_normal_update
    mov.l   .L_elem_heading_ofs_frame, r0
    mov.w @(r0, r14), r1
    exts.w r1, r1
    mov.l   .L_elem_pos_z_ofs_frame, r0
    mov.l @(r0, r14), r2
    add r1, r2
    rts
    mov.l r2, @(r0, r14)
.L_elem_type_ofs_frame:
    .4byte  0x00000001
.L_elem_heading_ofs_frame:
    .4byte  0x00000012
.L_elem_pos_z_ofs_frame:
    .4byte  0x0000001C
.L_pos_normal_update:
    mov.l   .L_elem_heading_offset, r0
    mov.w @(r0, r14), r2
    mov.l   .L_elem_angle_offset, r0
    mov.w @(r0, r14), r1
    add r2, r1
    mov.w r1, @(r0, r14)
    mov r1, r13
    mov r13, r4
    mov.l   .L_fn_cos_lookup, r0

    .global phys_position_load
    .type phys_position_load, @function
phys_position_load:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov r0, r12
    mov.l   .L_elem_vel_scale_offset, r0
    mov.l @(r0, r14), r11
    dmuls.l r12, r11
    sts mach, r0
    sts macl, r1
    xtrct r0, r1
    mov.l   .L_elem_pos_x_offset, r0
    mov.l @(r0, r14), r0
    add r0, r1
    mov.l   .L_elem_dst_x_offset, r0
    mov.l r1, @(r0, r14)
    mov r13, r4
    mov.l   .L_fn_sin_lookup, r0

    .global phys_velocity_integrate
    .type phys_velocity_integrate, @function
phys_velocity_integrate:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    dmuls.l r0, r11
    sts mach, r0
    sts macl, r1
    xtrct r0, r1
    mov.l   .L_elem_pos_z_offset, r0
    mov.l @(r0, r14), r0
    add r0, r1
    mov.l   .L_elem_dst_z_offset, r0
    mov.l r1, @(r0, r14)
    mov.l   .L_elem_type_offset_2, r0
    mov.b @(r0, r14), r0
    cmp/eq #0x2, r0
    bt      .L_direct_cam_write
    mov.l   .L_elem_lateral_offset, r0
    mov.w @(r0, r14), r1
    tst r1, r1
    bf      .L_apply_lateral_vel
    bra     .L_store_y_position
    xor r2, r2
.L_elem_heading_offset:
    .4byte  0x00000012
.L_elem_angle_offset:
    .4byte  0x00000002
.L_fn_cos_lookup:
    .4byte  cos_lookup
.L_elem_vel_scale_offset:
    .4byte  0x00000020
.L_elem_pos_x_offset:
    .4byte  0x00000014
.L_elem_dst_x_offset:
    .4byte  0x00000004
.L_fn_sin_lookup:
    .4byte  sin_lookup
.L_elem_pos_z_offset:
    .4byte  0x0000001C
.L_elem_dst_z_offset:
    .4byte  0x0000000C
.L_elem_type_offset_2:
    .4byte  0x00000001
.L_elem_lateral_offset:
    .4byte  0x00000024
.L_apply_lateral_vel:
    dmuls.l r12, r1
    sts mach, r0
    sts macl, r10
    xtrct r0, r10
    mov r10, r4
    mov.l   .L_fn_sin_lookup_2, r0

    .global phys_result_store
    .type phys_result_store, @function
phys_result_store:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov r0, r9
    mov r10, r4
    mov.l   .L_fn_cos_lookup_2, r0

    .global phys_perspective
    .type phys_perspective, @function
phys_perspective:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov r0, r5
    mov r9, r4
    mov.l   .L_fn_fpdiv_setup, r0

    .global phys_final_integrate
    .type phys_final_integrate, @function
phys_final_integrate:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    dmuls.l r0, r11
    sts mach, r0
    sts macl, r2
    xtrct r0, r2
.L_store_y_position:
    mov.l   .L_elem_pos_y_offset, r0
    mov.l @(r0, r14), r1
    add r1, r2
    mov.l   .L_elem_dst_y_offset, r0
    bra     .L_pos_update_done
    mov.l r2, @(r0, r14)
.L_fn_sin_lookup_2:
    .4byte  sin_lookup
.L_fn_cos_lookup_2:
    .4byte  cos_lookup
.L_fn_fpdiv_setup:
    .4byte  fpdiv_setup
.L_elem_pos_y_offset:
    .4byte  0x00000018
.L_elem_dst_y_offset:
    .4byte  0x00000008
.L_direct_cam_write:
    mov.l   .L_elem_dst_x_offset_2, r0
    mov.l @(r0, r14), r4
    mov.l   .L_scratch_pos_x, r0
    mov.l r4, @r0
    mov.l   .L_elem_dst_z_offset_2, r0
    mov.l @(r0, r14), r5
    mov.l   .L_scratch_pos_z, r0
    mov.l r5, @r0
    mov.l   .L_fn_atan2_full, r0

    .global phys_lighting_setup
    .type phys_lighting_setup, @function
phys_lighting_setup:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov r0, r4
    mov.l   .L_scratch_pos_x, r5
    mov.l   .L_scratch_pos_y, r6
    mov.l   .L_fn_scene_render_alt, r0

    .global ai_steering_response
    .type ai_steering_response, @function
ai_steering_response:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_scratch_result, r0
    mov.l @r0, r1
    mov.l   .L_elem_dst_y_offset_2, r0
    mov.l r1, @(r0, r14)
.L_pos_update_done:
    rts
    nop
    .2byte  0x0000
.L_elem_dst_x_offset_2:
    .4byte  0x00000004
.L_scratch_pos_x:
    .4byte  sym_06083238
.L_elem_dst_z_offset_2:
    .4byte  0x0000000C
.L_scratch_pos_z:
    .4byte  sym_06083240
.L_fn_atan2_full:
    .4byte  sym_06006838
.L_scratch_pos_y:
    .4byte  sym_06083244
.L_fn_scene_render_alt:
    .4byte  scene_render_alt
.L_scratch_result:
    .4byte  sym_0608323C
.L_elem_dst_y_offset_2:
    .4byte  0x00000008
.L_camera_path_dispatch:
    mov.l   .L_elem_type_ofs_a, r0
    mov.b @(r0, r14), r0
    cmp/eq #0x1, r0
    bf      .L_cam_check_mode_2
    mov.l   .L_fn_cam_setup_a, r0

    .global ai_vel_x_entry
    .type ai_vel_x_entry, @function
ai_vel_x_entry:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_a, r13
    mov.l @r13, r13
    mov.l   .L_elem_dst_x_ofs_a, r0
    mov.l @(r0, r14), r4
    mov.l   .L_elem_dst_y_ofs_a, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_dst_z_ofs_a, r0
    mov.l @(r0, r14), r6
    mov.l   .L_fn_cam_transform_a, r0

    .global ai_vel_x_step_a
    .type ai_vel_x_step_a, @function
ai_vel_x_step_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_a, r0
    mov.w @(r0, r14), r4
    mov.l   .L_fn_mat_rot_y_a, r0

    .global ai_vel_x_step_b
    .type ai_vel_x_step_b, @function
ai_vel_x_step_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_a, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_param_load_a, r0

    .global ai_vel_x_step_c
    .type ai_vel_x_step_c, @function
ai_vel_x_step_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_a, r0

    .global xaxis_integrate_damp
    .type xaxis_integrate_damp, @function
xaxis_integrate_damp:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_a, r13
    mov.l @r13, r13
    bra     .L_cam_path_return
    nop
    .2byte  0x0000
.L_elem_type_ofs_a:
    .4byte  0x00000001
.L_fn_cam_setup_a:
    .4byte  sym_06026DBC
.L_cam_result_ptr_a:
    .4byte  sym_06089EDC
.L_elem_dst_x_ofs_a:
    .4byte  0x00000004
.L_elem_dst_y_ofs_a:
    .4byte  0x00000008
.L_elem_dst_z_ofs_a:
    .4byte  0x0000000C
.L_fn_cam_transform_a:
    .4byte  sym_06026E2E
.L_elem_angle_ofs_a:
    .4byte  0x00000002
.L_fn_mat_rot_y_a:
    .4byte  mat_rot_y
.L_elem_flags_ofs_a:
    .4byte  0x00000011
.L_fn_cam_param_load_a:
    .4byte  camera_param_load
.L_fn_cam_finalize_a:
    .4byte  sym_06026DF8
.L_cam_check_mode_2:
    cmp/eq #0x2, r0
    bf      .L_cam_check_mode_3
    mov.l   .L_fn_cam_setup_b, r0

    .global ai_vel_x_cleanup_entry
    .type ai_vel_x_cleanup_entry, @function
ai_vel_x_cleanup_entry:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_b, r13
    mov.l @r13, r13
    mov.l   .L_elem_dst_x_ofs_b, r0
    mov.l @(r0, r14), r4
    mov.l   .L_elem_dst_y_ofs_b, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_dst_z_ofs_b, r0
    mov.l @(r0, r14), r6
    mov.l   .L_fn_cam_transform_b, r0

    .global ai_vel_x_cleanup_a
    .type ai_vel_x_cleanup_a, @function
ai_vel_x_cleanup_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_b, r0
    mov.w @(r0, r14), r4
    mov.l   .L_fp_half, r0
    add r0, r4
    exts.w r4, r4
    mov.l   .L_fn_mat_rot_y_b, r0

    .global ai_vel_x_cleanup_b
    .type ai_vel_x_cleanup_b, @function
ai_vel_x_cleanup_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_b, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_scene_setup_b, r0

    .global ai_vel_x_cleanup_c
    .type ai_vel_x_cleanup_c, @function
ai_vel_x_cleanup_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_b, r0

    .global yaxis_integrate
    .type yaxis_integrate, @function
yaxis_integrate:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_b, r13
    mov.l @r13, r13
    bra     .L_cam_path_return
    nop
.L_fn_cam_setup_b:
    .4byte  sym_06026DBC
.L_cam_result_ptr_b:
    .4byte  sym_06089EDC
.L_elem_dst_x_ofs_b:
    .4byte  0x00000004
.L_elem_dst_y_ofs_b:
    .4byte  0x00000008
.L_elem_dst_z_ofs_b:
    .4byte  0x0000000C
.L_fn_cam_transform_b:
    .4byte  sym_06026E2E
.L_elem_angle_ofs_b:
    .4byte  0x00000002
.L_fp_half:
    .4byte  0x00008000                  /* 0.5 (16.16 fixed-point) */
.L_fn_mat_rot_y_b:
    .4byte  mat_rot_y
.L_elem_flags_ofs_b:
    .4byte  0x00000011
.L_fn_cam_scene_setup_b:
    .4byte  camera_scene_setup
.L_fn_cam_finalize_b:
    .4byte  sym_06026DF8
.L_cam_check_mode_3:
    cmp/eq #0x3, r0
    bf      .L_cam_check_mode_4
    mov.l   .L_fn_cam_setup_c, r0

    .global ai_vel_y_entry
    .type ai_vel_y_entry, @function
ai_vel_y_entry:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_c, r13
    mov.l @r13, r13
    mov.l   .L_elem_pos_x_ofs_c, r0
    mov.l @(r0, r14), r4
    mov.l   .L_elem_pos_y_ofs_c, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_pos_z_ofs_c, r0
    mov.l @(r0, r14), r6
    mov.l   .L_fn_cam_transform_c, r0

    .global ai_vel_y_step_a
    .type ai_vel_y_step_a, @function
ai_vel_y_step_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_c, r0
    mov.w @(r0, r14), r4
    mov.l   .L_fn_mat_rot_y_c, r0

    .global ai_vel_y_step_b
    .type ai_vel_y_step_b, @function
ai_vel_y_step_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_c, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_scene_setup_c, r0

    .global ai_vel_y_step_c
    .type ai_vel_y_step_c, @function
ai_vel_y_step_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_c, r0

    .global zaxis_integrate
    .type zaxis_integrate, @function
zaxis_integrate:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_c, r13
    mov.l @r13, r13
    bra     .L_cam_path_return
    nop
    .2byte  0x0000
.L_fn_cam_setup_c:
    .4byte  sym_06026DBC
.L_cam_result_ptr_c:
    .4byte  sym_06089EDC
.L_elem_pos_x_ofs_c:
    .4byte  0x00000014
.L_elem_pos_y_ofs_c:
    .4byte  0x00000018
.L_elem_pos_z_ofs_c:
    .4byte  0x0000001C
.L_fn_cam_transform_c:
    .4byte  sym_06026E2E
.L_elem_angle_ofs_c:
    .4byte  0x00000002
.L_fn_mat_rot_y_c:
    .4byte  mat_rot_y
.L_elem_flags_ofs_c:
    .4byte  0x00000011
.L_fn_cam_scene_setup_c:
    .4byte  camera_scene_setup
.L_fn_cam_finalize_c:
    .4byte  sym_06026DF8
.L_cam_check_mode_4:
    cmp/eq #0x4, r0
    bt      .L_cam_mode_4_active
    bra     .L_cam_path_return
    nop
.L_cam_mode_4_active:
    mov.l   .L_fn_cam_setup_d, r0

    .global ai_vel_z_entry
    .type ai_vel_z_entry, @function
ai_vel_z_entry:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_d, r13
    mov.l @r13, r13
    mov.l   .L_elem_dst_x_ofs_d, r0
    mov.l @(r0, r14), r4
    mov.l   .L_elem_dst_y_ofs_d, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_dst_z_ofs_d, r0
    mov.l @(r0, r14), r6
    mov.l   .L_fn_cam_transform_d, r0

    .global ai_vel_z_step_a
    .type ai_vel_z_step_a, @function
ai_vel_z_step_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_d, r0
    mov.w @(r0, r14), r4
    mov.l   .L_fn_mat_rot_y_d, r0

    .global ai_vel_z_step_b
    .type ai_vel_z_step_b, @function
ai_vel_z_step_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_d, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_param_load_d, r0

    .global ai_vel_z_step_c
    .type ai_vel_z_step_c, @function
ai_vel_z_step_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_d, r0

    .global ai_rot_a_entry
    .type ai_rot_a_entry, @function
ai_rot_a_entry:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_d, r13
    mov.l @r13, r13
    mov.l   .L_anim_frame_counter_d, r0
    mov.l @r0, r1
    mov.l   .L_rot_a_frame_threshold, r0
    cmp/ge r0, r1
    bf      .L_cam_rot_skip
    mov.l   .L_fn_cam_setup_d, r0

    .global ai_rot_a_step
    .type ai_rot_a_step, @function
ai_rot_a_step:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_d, r13
    mov.l @r13, r13
    mov.l   .L_elem_dst_x_ofs_d, r0
    mov.l @(r0, r14), r4
    mov.l   .L_rot_a_x_adjust, r0
    sub r0, r4
    mov.l   .L_elem_dst_y_ofs_d, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_dst_z_ofs_d, r0
    mov.l @(r0, r14), r6
    mov.l   .L_rot_a_z_adjust, r0
    sub r0, r6
    mov.l   .L_fn_cam_transform_d, r0

    .global ai_rot_a_fix_a
    .type ai_rot_a_fix_a, @function
ai_rot_a_fix_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_d, r0
    mov.w @(r0, r14), r4
    mov.l   .L_fn_mat_rot_y_d, r0

    .global ai_rot_a_fix_b
    .type ai_rot_a_fix_b, @function
ai_rot_a_fix_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_d, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_param_load_d, r0

    .global ai_rot_a_fix_c
    .type ai_rot_a_fix_c, @function
ai_rot_a_fix_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_d, r0

    .global ai_rot_b_entry
    .type ai_rot_b_entry, @function
ai_rot_b_entry:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_d, r13
    mov.l @r13, r13
    mov.l   .L_anim_frame_counter_d, r0
    mov.l @r0, r1
    mov.l   .L_rot_b_frame_threshold, r0
    cmp/ge r0, r1
    bf      .L_cam_rot_skip
    mov.l   .L_fn_cam_setup_d, r0

    .global ai_rot_b_step
    .type ai_rot_b_step, @function
ai_rot_b_step:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_d, r13
    mov.l @r13, r13
    mov.l   .L_elem_dst_x_ofs_d, r0
    mov.l @(r0, r14), r4
    mov.l   .L_rot_b_x_adjust, r0
    sub r0, r4
    mov.l   .L_elem_dst_y_ofs_d, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_dst_z_ofs_d, r0
    mov.l @(r0, r14), r6
    mov.l   .L_rot_b_z_adjust, r0
    sub r0, r6
    mov.l   .L_fn_cam_transform_d, r0

    .global ai_rot_b_fix_a
    .type ai_rot_b_fix_a, @function
ai_rot_b_fix_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_d, r0
    mov.w @(r0, r14), r4
    add r0, r4
    mov.l   .L_fn_mat_rot_y_d, r0

    .global ai_rot_b_fix_b
    .type ai_rot_b_fix_b, @function
ai_rot_b_fix_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_d, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_param_load_d, r0

    .global ai_rot_b_fix_c
    .type ai_rot_b_fix_c, @function
ai_rot_b_fix_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_d, r0

    .global ai_decision_dispatch
    .type ai_decision_dispatch, @function
ai_decision_dispatch:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_d, r13
    mov.l @r13, r13
.L_cam_rot_skip:
    bra     .L_cam_path_return
    nop
.L_fn_cam_setup_d:
    .4byte  sym_06026DBC
.L_cam_result_ptr_d:
    .4byte  sym_06089EDC
.L_elem_dst_x_ofs_d:
    .4byte  0x00000004
.L_elem_dst_y_ofs_d:
    .4byte  0x00000008
.L_elem_dst_z_ofs_d:
    .4byte  0x0000000C
.L_fn_cam_transform_d:
    .4byte  sym_06026E2E
.L_elem_angle_ofs_d:
    .4byte  0x00000002
.L_fn_mat_rot_y_d:
    .4byte  mat_rot_y
.L_elem_flags_ofs_d:
    .4byte  0x00000011
.L_fn_cam_param_load_d:
    .4byte  camera_param_load
.L_fn_cam_finalize_d:
    .4byte  sym_06026DF8
.L_anim_frame_counter_d:
    .4byte  sym_06083250
.L_rot_a_frame_threshold:
    .4byte  0x000004EC
.L_rot_a_x_adjust:
    .4byte  0x00280000
.L_rot_a_z_adjust:
    .4byte  0x003E0000
.L_rot_b_frame_threshold:
    .4byte  0x00000627
.L_rot_b_x_adjust:
    .4byte  0x00190000
.L_rot_b_z_adjust:
    .4byte  0x001C0000
.L_cam_path_return:
    rts
    nop

    .global sym_0603446C
sym_0603446C:
    xor r7, r7
.L_clear_anim_loop:
    mov.l   .L_elem_struct_size_2, r1
    mulu.w r7, r1
    sts macl, r0
    mov.l   .L_elem_array_base_2, r14
    add r0, r14
    xor r1, r1
    mov.l   .L_elem_anim_mode_ofs_2, r0
    mov.b r1, @(r0, r14)
    add #0x1, r7
    mov.l   .L_elem_count_5, r0
    cmp/ge r0, r7
    bf      .L_clear_anim_loop
    rts
    nop
    .2byte  0x0000
.L_elem_struct_size_2:
    .4byte  0x0000002C
.L_elem_array_base_2:
    .4byte  DAT_06082A7C
.L_elem_anim_mode_ofs_2:
    .4byte  0x00000026
.L_elem_count_5:
    .4byte  0x00000005
.L_calc_distance:
    mov.l   .L_elem_type_ofs_dist, r0
    mov.b @(r0, r14), r0
    cmp/eq #0x2, r0
    bf      .L_dist_calc_return
    mov.l   .L_elem_dst_x_ofs_dist, r0
    mov.l @(r0, r14), r3
    mov.l   .L_elem_dst_z_ofs_dist, r0
    mov.l @(r0, r14), r4
    mov.l   .L_cam_pos_x_ofs, r0
    mov.l @(r0, r10), r5
    mov.l   .L_cam_pos_z_ofs, r0
    mov.l @(r0, r10), r6
    mov.l r13, @-r15
    mov.l r1, @-r15
    mov.l r2, @-r15
    mov.l r3, @-r15
    mov.l r4, @-r15
    mov.l r5, @-r15
    mov.l   .L_scratch_vec_base, r13    ! scratch[0..4] = dx,dy, cam_x,cam_z, dist_sq
    mov.l r3, @(0, r13)               ! scratch[0] = elem.dst_x
    mov.l r4, @(4, r13)               ! scratch[1] = elem.dst_z
    mov.l r5, @(8, r13)               ! scratch[2] = cam_x
    mov.l r6, @(12, r13)              ! scratch[3] = cam_z
    mov.l @(0, r13), r1
    mov.l @(8, r13), r0
    sub r1, r0                         ! dx = cam_x - dst_x
    mov r0, r4
    mov r0, r5
    dmuls.l r4, r5                     ! dx * dx (64-bit)
    sts mach, r0
    sts macl, r1
    xtrct r0, r1                       ! dx^2 (16.16 fixed-point)
    mov.l r1, @(16, r13)              ! scratch[4] = dx^2
    mov.l @(4, r13), r1
    mov.l @(12, r13), r0
    sub r1, r0                         ! dz = cam_z - dst_z
    mov r0, r4
    mov r0, r5
    dmuls.l r4, r5                     ! dz * dz (64-bit)
    sts mach, r0
    sts macl, r1
    xtrct r0, r1
    mov.l @(16, r13), r4
    add r1, r4
    cmp/pz r4
    bt      .L_dist_positive_sqrt
    shlr2 r4
    mov.l   .L_fn_isqrt, r0

    .global ai_speed_limit
    .type ai_speed_limit, @function
ai_speed_limit:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    bra     .L_dist_check_threshold
    shll r0
.L_elem_type_ofs_dist:
    .4byte  0x00000001
.L_elem_dst_x_ofs_dist:
    .4byte  0x00000004
.L_elem_dst_z_ofs_dist:
    .4byte  0x0000000C
.L_cam_pos_x_ofs:
    .4byte  0x00000010
.L_cam_pos_z_ofs:
    .4byte  0x00000018
.L_scratch_vec_base:
    .4byte  sym_06083238
.L_fn_isqrt:
    .4byte  isqrt
.L_dist_positive_sqrt:
    mov.l   .L_fn_isqrt_2, r0

    .global ai_waypoint_follower
    .type ai_waypoint_follower, @function
ai_waypoint_follower:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
.L_dist_check_threshold:
    mov.l @r15+, r5
    mov.l @r15+, r4
    mov.l @r15+, r3
    mov.l @r15+, r2
    mov.l @r15+, r1
    mov.l @r15+, r13
    mov r0, r2
    mov r2, r8
    mov.l   .L_fp_eight, r0
    cmp/ge r0, r2
    bt      .L_dist_calc_return
    mov.l   .L_const_one, r1
    mov.l   .L_elem_anim_mode_ofs_dist, r0
    mov.b r1, @(r0, r14)
.L_dist_calc_return:
    rts
    nop
    .2byte  0x0000
.L_fn_isqrt_2:
    .4byte  isqrt
.L_fp_eight:
    .4byte  0x00080000                  /* 8.0 (16.16 fixed-point) */
.L_const_one:
    .4byte  0x00000001
.L_elem_anim_mode_ofs_dist:
    .4byte  0x00000026
.L_init_heading_transfer:
    mov.l   .L_elem_vel_ofs_init, r0
    mov.l @(r0, r10), r1
    mov.l   .L_elem_angle_ofs_init, r0
    mov.w r1, @(r0, r14)
    mov.l   .L_elem_dst_z_ofs_init, r0
    mov.l @(r0, r10), r4
    shal r4
    mov.l   .L_elem_vel_ofs_init, r0
    mov.l r4, @(r0, r14)
    mov.l   .L_elem_anim_mode_ofs_init, r0
    mov #0x2, r1
    mov.b r1, @(r0, r14)
    rts
    nop
.L_elem_vel_ofs_init:
    .4byte  0x00000028
.L_elem_angle_ofs_init:
    .4byte  0x00000002
.L_elem_dst_z_ofs_init:
    .4byte  0x0000000C
.L_elem_anim_mode_ofs_init:
    .4byte  0x00000026
.L_collision_pos_update:
    mov.l   .L_elem_angle_ofs_coll, r0
    mov.w @(r0, r14), r9
    mov.l   .L_fp_quarter, r1
    add r1, r9
    mov.l   .L_elem_vel_ofs_coll, r0
    mov.l @(r0, r14), r8
    mov r9, r4
    mov.l   .L_fn_cos_lookup_coll, r0

    .global ai_collision_trigger
    .type ai_collision_trigger, @function
ai_collision_trigger:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    dmuls.l r0, r8
    sts mach, r0
    sts macl, r3
    xtrct r0, r3
    mov.l   .L_elem_dst_x_ofs_coll, r0
    mov.l @(r0, r14), r1
    add r3, r1
    mov.l r1, @(r0, r14)
    mov r9, r4
    mov.l   .L_fn_sin_lookup_coll, r0

    .global ai_collision_response
    .type ai_collision_response, @function
ai_collision_response:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    dmuls.l r0, r8
    sts mach, r0
    sts macl, r3
    xtrct r0, r3
    mov.l   .L_elem_dst_z_ofs_coll, r0
    mov.l @(r0, r14), r1
    add r3, r1
    mov.l r1, @(r0, r14)
    mov.l   .L_elem_dst_x_ofs_coll, r0
    mov.l @(r0, r14), r4
    mov.l   .L_scratch_pos_x_coll, r0
    mov.l r4, @r0
    mov.l   .L_elem_dst_z_ofs_coll, r0
    mov.l @(r0, r14), r5
    mov.l   .L_scratch_pos_z_coll, r0
    mov.l r5, @r0
    mov.l   .L_fn_atan2_coll, r0

    .global ai_reset_stub
    .type ai_reset_stub, @function
ai_reset_stub:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov r0, r4
    mov.l   .L_scratch_pos_x_coll, r5
    mov.l   .L_scratch_pos_y_coll, r6
    mov.l   .L_fn_scene_render_alt_coll, r0

    .global ai_car_pos_init
    .type ai_car_pos_init, @function
ai_car_pos_init:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_scratch_result_coll, r0
    mov.l @r0, r1
    mov.l   .L_elem_dst_y_ofs_coll, r0
    mov.l r1, @(r0, r14)
    rts
    nop
    .2byte  0x0000
.L_elem_angle_ofs_coll:
    .4byte  0x00000002
.L_fp_quarter:
    .4byte  0x00004000                  /* 0.25 (16.16 fixed-point) */
.L_elem_vel_ofs_coll:
    .4byte  0x00000028
.L_fn_cos_lookup_coll:
    .4byte  cos_lookup
.L_elem_dst_x_ofs_coll:
    .4byte  0x00000004
.L_fn_sin_lookup_coll:
    .4byte  sin_lookup
.L_elem_dst_z_ofs_coll:
    .4byte  0x0000000C
.L_scratch_pos_x_coll:
    .4byte  sym_06083238
.L_scratch_pos_z_coll:
    .4byte  sym_06083240
.L_fn_atan2_coll:
    .4byte  sym_06006838
.L_scratch_pos_y_coll:
    .4byte  sym_06083244
.L_fn_scene_render_alt_coll:
    .4byte  scene_render_alt
.L_scratch_result_coll:
    .4byte  sym_0608323C
.L_elem_dst_y_ofs_coll:
    .4byte  0x00000008
.L_spawn_cam_setup:
    mov.l   .L_fn_cam_setup_e, r0

    .global ai_spawn_helper_a
    .type ai_spawn_helper_a, @function
ai_spawn_helper_a:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_e, r13
    mov.l @r13, r13
    mov.l   .L_elem_dst_x_ofs_e, r0
    mov.l @(r0, r14), r4
    mov.l   .L_elem_dst_y_ofs_e, r0
    mov.l @(r0, r14), r5
    mov.l   .L_elem_dst_z_ofs_e, r0
    mov.l @(r0, r14), r6
    mov.l   .L_fn_cam_transform_e, r0

    .global ai_spawn_helper_b
    .type ai_spawn_helper_b, @function
ai_spawn_helper_b:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_angle_ofs_e, r0
    mov.w @(r0, r14), r4
    mov.l   .L_fn_mat_rot_y_e, r0

    .global ai_spawn_helper_c
    .type ai_spawn_helper_c, @function
ai_spawn_helper_c:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_elem_flags_ofs_e, r0
    mov.b @(r0, r14), r4
    mov.l   .L_fn_cam_scene_setup_e, r0

    .global ai_spawn_helper_d
    .type ai_spawn_helper_d, @function
ai_spawn_helper_d:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_fn_cam_finalize_e, r0

    .global ai_car_full_init
    .type ai_car_full_init, @function
ai_car_full_init:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l   .L_cam_result_ptr_e, r13
    mov.l @r13, r13
    rts
    nop
    .2byte  0x0000
.L_fn_cam_setup_e:
    .4byte  sym_06026DBC
.L_cam_result_ptr_e:
    .4byte  sym_06089EDC
.L_elem_dst_x_ofs_e:
    .4byte  0x00000004
.L_elem_dst_y_ofs_e:
    .4byte  0x00000008
.L_elem_dst_z_ofs_e:
    .4byte  0x0000000C
.L_fn_cam_transform_e:
    .4byte  sym_06026E2E
.L_elem_angle_ofs_e:
    .4byte  0x00000002
.L_fn_mat_rot_y_e:
    .4byte  mat_rot_y
.L_elem_flags_ofs_e:
    .4byte  0x00000011
.L_fn_cam_scene_setup_e:
    .4byte  camera_scene_setup
.L_fn_cam_finalize_e:
    .4byte  sym_06026DF8
.L_advance_anim_frame:
    mov.l   .L_elem_type_ofs_anim, r0
    mov.b @(r0, r14), r0
    add #-0x1, r0
    mov.l   .L_anim_speed_table, r1
    mov.b @(r0, r1), r2
    mov.l   .L_anim_count_table, r1
    mov.b @(r0, r1), r3
    mov.l   .L_anim_tick_ofs, r0
    mov.b @(r0, r14), r1
    add #0x1, r1
    mov.b r1, @(r0, r14)
    cmp/ge r2, r1
    bf      .L_anim_advance_done
    xor r2, r2
    mov.b r2, @(r0, r14)
    mov.l   .L_anim_frame_ofs, r0
    mov.b @(r0, r14), r1
    add #0x1, r1
    cmp/ge r3, r1
    bf      .L_store_anim_frame
    mov.l   .L_anim_frame_reset, r1
.L_store_anim_frame:
    mov.b r1, @(r0, r14)
.L_anim_advance_done:
    rts
    nop
.L_elem_type_ofs_anim:
    .4byte  0x00000001
.L_anim_speed_table:
    .4byte  sym_060631B4
.L_anim_count_table:
    .4byte  sym_060631B8
.L_anim_tick_ofs:
    .4byte  0x00000010
.L_anim_frame_ofs:
    .4byte  0x00000011
.L_anim_frame_reset:
    .4byte  0x00000000

    .global vblank_handler
    .type vblank_handler, @function
vblank_handler:                         ! Per-frame game update (r4 = elem ptr)
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov.l r12, @-r15
    mov.l r11, @-r15
    mov.l r10, @-r15
    mov.l r9, @-r15
    mov.l r8, @-r15
    mov r4, r14                        ! r14 = element base
    mov.l   .L_prev_state_ofs, r0
    mov.l @(r0, r14), r2              ! save previous state
    mov.l   .L_saved_state_ofs, r0
    mov.l r2, @(r0, r14)

    .global ai_rank_stub_a
    .type ai_rank_stub_a, @function
ai_rank_stub_a:
    sts.l pr, @-r15
    bsr     .L_calc_rank_position
    nop
    lds.l @r15+, pr

    .global ai_rank_stub_b
    .type ai_rank_stub_b, @function
ai_rank_stub_b:
    sts.l pr, @-r15
    bsr     .L_update_blink_state
    nop
    lds.l @r15+, pr

    .global position_calc_current
    .type position_calc_current, @function
position_calc_current:
    sts.l pr, @-r15
    bsr     .L_checkpoint_sound
    nop
    lds.l @r15+, pr
    mov.l @r15+, r8
    mov.l @r15+, r9
    mov.l @r15+, r10
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    mov.l @r15+, r14
    rts
    nop
    .2byte  0x0000
.L_prev_state_ofs:
    .4byte  0x0000000C
.L_saved_state_ofs:
    .4byte  0x00000010
.L_calc_rank_position:
    mov.l   .L_game_state_ptr_rank, r0
    mov.l @r0, r1
    mov.l   .L_rank_position_ofs, r0
    mov.l   .L_fp_300_const, r5
    mov.l @(r0, r1), r4
    shll16 r4
    mov.l   .L_fn_fpdiv_rank, r0

    .global ranking_system_full
    .type ranking_system_full, @function
ranking_system_full:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov r0, r2
    mov.l   .L_rank_position_ofs, r0
    mov.l @(r0, r14), r1
    add r2, r1
    mov.l   .L_fp_6_wrap, r3
    cmp/ge r3, r1
    bf      .L_rank_no_wrap
    xor r1, r1
.L_rank_no_wrap:
    mov.l r1, @(r0, r14)
    mov r1, r2
    shlr16 r2
    mov.l   .L_rank_mask_7, r0
    and r0, r2
    mov.l   .L_rank_output_ofs, r0
    mov.l r2, @(r0, r14)
    rts
    nop
.L_game_state_ptr_rank:
    .4byte  sym_0607E944
.L_rank_position_ofs:
    .4byte  0x00000008
.L_fp_300_const:
    .4byte  0x012C0000
.L_fn_fpdiv_rank:
    .4byte  fpdiv_setup
.L_fp_6_wrap:
    .4byte  0x00060000
.L_rank_mask_7:
    .4byte  0x00000007
.L_rank_output_ofs:
    .4byte  0x0000000C
.L_update_blink_state:
    mov.l   .L_state_field_0C, r0
    mov.l @(r0, r14), r1
    mov #0x1, r3
    cmp/eq r3, r1
    bf      .L_check_blink_b
    mov.l   .L_state_field_10, r0
    mov.l @(r0, r14), r0
    xor r1, r0
    tst r0, r0
    bt      .L_check_blink_b
    mov.l   .L_blink_phase_a_ofs, r0
    mov.l   .L_sh2_periph_0x1FF, r1
    mov.b r1, @(r0, r14)
    mov.l   .L_blink_tick_a_ofs, r0
    xor r1, r1
    mov.b r1, @(r0, r14)
.L_check_blink_b:
    mov.l   .L_state_field_0C, r0
    mov.l @(r0, r14), r1
    mov #0x5, r3
    cmp/eq r3, r1
    bf      .L_advance_blink_ticks
    mov.l   .L_state_field_10, r0
    mov.l @(r0, r14), r0
    xor r1, r0
    tst r0, r0
    bt      .L_advance_blink_ticks
    mov.l   .L_blink_phase_b_ofs, r0
    mov.l   .L_sh2_periph_0x1FF, r1
    mov.b r1, @(r0, r14)
    mov.l   .L_blink_tick_b_ofs, r0
    xor r1, r1
    mov.b r1, @(r0, r14)
.L_advance_blink_ticks:
    mov.l   .L_blink_tick_a_ofs, r0
    mov.b @(r0, r14), r1
    add #0x1, r1
    mov.b r1, @(r0, r14)
    mov #0x3, r2
    and r2, r1
    mov.l   .L_blink_output_a_ofs, r0
    mov.b r1, @(r0, r14)
    mov #0x3, r2
    cmp/eq r2, r1
    bf      .L_advance_blink_b
    mov.l   .L_blink_phase_a_ofs, r0
    xor r1, r1
    mov.b r1, @(r0, r14)
.L_advance_blink_b:
    mov.l   .L_blink_tick_b_ofs, r0
    mov.b @(r0, r14), r1
    add #0x1, r1
    mov.b r1, @(r0, r14)
    mov #0x3, r2
    and r2, r1
    mov.l   .L_blink_output_b_ofs, r0
    mov.b r1, @(r0, r14)
    mov #0x3, r2
    cmp/eq r2, r1
    bf      .L_blink_state_done
    mov.l   .L_blink_phase_b_ofs, r0
    xor r1, r1
    mov.b r1, @(r0, r14)
.L_blink_state_done:
    rts
    nop
.L_state_field_0C:
    .4byte  0x0000000C
.L_state_field_10:
    .4byte  0x00000010
.L_blink_phase_a_ofs:
    .4byte  0x00000001
.L_sh2_periph_0x1FF:
    .4byte  0xFFFFFFFF                  /* SH-2 peripheral +0x1FF */
.L_blink_tick_a_ofs:
    .4byte  0x00000002
.L_blink_phase_b_ofs:
    .4byte  0x00000004
.L_blink_tick_b_ofs:
    .4byte  0x00000005
.L_blink_output_a_ofs:
    .4byte  0x00000000
.L_blink_output_b_ofs:
    .4byte  0x00000003
.L_checkpoint_sound:
    mov.l   .L_sound_enable_flag, r0
    mov.b @r0, r0
    tst r0, r0
    bt      .L_checkpoint_snd_done
    mov.l   .L_input_flags_ptr, r0
    mov.l @r0, r0
    mov.l   .L_start_button_mask, r1
    tst r1, r0
    bf      .L_check_state_changed
    bra     .L_checkpoint_snd_done
    nop
    .2byte  0x0000
.L_sound_enable_flag:
    .4byte  sym_06083255
.L_input_flags_ptr:
    .4byte  sym_0607EBC4
.L_start_button_mask:
    .4byte  0x00028000
.L_check_state_changed:
    mov.l   .L_state_saved_ofs, r0
    mov.l @(r0, r14), r1
    mov.l   .L_state_current_ofs, r0
    mov.l @(r0, r14), r0
    cmp/eq r1, r0
    bt      .L_checkpoint_snd_done
    mov.l   .L_game_state_ptr_snd, r0
    mov.l @r0, r1
    mov.l   .L_state_race_timer_ofs, r0
    mov.l @(r0, r1), r1
    mov.w   DAT_0603489e, r0
    cmp/ge r0, r1
    bt      .L_timer_past_threshold
    mov.l   .L_state_current_ofs, r0
    mov.l @(r0, r14), r0
    cmp/eq #0x0, r0
    bt      .L_snd_select_default
    cmp/eq #0x3, r0
    bt      .L_snd_select_state_3
    cmp/eq #0x4, r0
    bt      .L_snd_select_state_4
    cmp/eq #0x5, r0
    bt      .L_snd_select_default
    bra     .L_checkpoint_snd_done
    nop

    .global DAT_0603489e
DAT_0603489e:
    .2byte  0x0104
.L_state_saved_ofs:
    .4byte  0x00000010
.L_state_current_ofs:
    .4byte  0x0000000C
.L_game_state_ptr_snd:
    .4byte  sym_0607E944
.L_state_race_timer_ofs:
    .4byte  0x00000008
.L_timer_past_threshold:
    mov.l   .L_state_current_ofs_2, r0
    mov.l @(r0, r14), r0
    cmp/eq #0x0, r0
    bt      .L_snd_select_default
    cmp/eq #0x3, r0
    bt      .L_snd_select_state_3
    cmp/eq #0x4, r0
    bt      .L_snd_select_state_4
    bra     .L_checkpoint_snd_done
    nop
.L_state_current_ofs_2:
    .4byte  0x0000000C
.L_snd_select_state_3:
    mov.l   .L_snd_cmd_state_3, r5
    bra     .L_snd_dispatch_cmd
    nop
    .2byte  0x0000
.L_snd_cmd_state_3:
    .4byte  0xAE113BFF
.L_snd_select_state_4:
    mov.l   .L_snd_cmd_state_4, r5
    bra     .L_snd_dispatch_cmd
    nop
    .2byte  0x0000
.L_snd_cmd_state_4:
    .4byte  0xAE113CFF
.L_snd_select_default:
    mov.l   .L_snd_cmd_default, r5
.L_snd_dispatch_cmd:
    mov.l   .L_snd_channel_0, r4
    mov.l   .L_fn_sound_cmd_dispatch, r0

    .global lap_complete_check
    .type lap_complete_check, @function
lap_complete_check:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
.L_checkpoint_snd_done:
    rts
    nop
    .2byte  0x0000
.L_snd_cmd_default:
    .4byte  0xAE113DFF
.L_snd_channel_0:
    .4byte  0x00000000
.L_fn_sound_cmd_dispatch:
    .4byte  sound_cmd_dispatch

    .global terrain_data_lookup
    .type terrain_data_lookup, @function
terrain_data_lookup:
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov.l r12, @-r15
    mov.l r11, @-r15
    mov.l r10, @-r15
    mov.l r9, @-r15
    mov.l r8, @-r15
    mov.l   .L_game_state_ptr_terr, r1
    mov.l @r1, r14
    mov.l   .L_state_mode_B8_ofs, r0
    mov.l @(r0, r14), r0
    cmp/eq #0x2C, r0
    bt      .L_terrain_play_sound
    mov.l   .L_state_mode_1BC_ofs, r0
    mov.l @(r0, r14), r0
    cmp/eq #0x28, r0
    bt      .L_terrain_play_sound
    bra     .L_terrain_calc_volume
    nop
    .2byte  0x0000
.L_game_state_ptr_terr:
    .4byte  sym_0607E944
.L_state_mode_B8_ofs:
    .4byte  0x000000B8
.L_state_mode_1BC_ofs:
    .4byte  0x000001BC
.L_terrain_play_sound:
    mov.l   .L_snd_channel_terr, r4
    mov.l   .L_snd_cmd_checkpoint, r5
    mov.l   .L_fn_sound_cmd_dispatch_2, r0

    .global checkpoint_validate
    .type checkpoint_validate, @function
checkpoint_validate:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
.L_terrain_calc_volume:
    mov.w   DAT_06034976, r0
    mov.l @(r0, r14), r5
    cmp/pz r5
    bt      .L_speed_abs_done
    neg r5, r5
.L_speed_abs_done:
    shlr8 r5
    mov #0x7, r3
    shlr2 r5
    cmp/ge r5, r3
    bt      .L_speed_clamped
    mov #0x7, r5
.L_speed_clamped:
    mov #0x2, r4
    mov.l   .L_fn_sound_cmd_dispatch_2, r0

    .global section_transition
    .type section_transition, @function
section_transition:
    sts.l pr, @-r15
    jsr @r0
    nop
    lds.l @r15+, pr
    mov.l @r15+, r8
    mov.l @r15+, r9
    mov.l @r15+, r10
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    mov.l @r15+, r14
    rts
    nop

    .global DAT_06034976
DAT_06034976:
    .2byte  0x005C
.L_snd_channel_terr:
    .4byte  0x00000000
.L_snd_cmd_checkpoint:
    .4byte  0xAE1128FF
.L_fn_sound_cmd_dispatch_2:
    .4byte  sound_cmd_dispatch

    .global ai_checkpoint_section
    .type ai_checkpoint_section, @function
ai_checkpoint_section:
    mov.l r14, @-r15
    mov.l r13, @-r15
    sts.l pr, @-r15
    mov r4, r13
    add #-0x8, r15
    mov.l   .L_fn_input_proc_analog, r3
    jsr @r3
    mov r15, r4
    mov r15, r2
    mov #0x0, r3
    mov r15, r5
    mov.b r3, @r2
    mov.l   .L_fn_input_proc_buttons, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r14
    mov.l   .L_fn_input_proc_extended, r3
    jsr @r3
    mov r13, r4
    mov r14, r0
    add #0x8, r15
    lds.l @r15+, pr
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global ai_checkpoint_validate
    .type ai_checkpoint_validate, @function
ai_checkpoint_validate:
    sts.l pr, @-r15
    mov.l   .L_fn_input_proc_extended, r3
    jsr @r3
    nop
    lds.l @r15+, pr
    rts
    mov #0x0, r0

/* VERIFIED: reads CD Block status registers CR1-CR4 (0x25890018-0x25890024)
 * with interrupt-masked double-read for consistency. Not AI-related.
 * Method: code audit — hardware register addresses are definitive.
 * Date: 2026-02-28
 */
    .global cd_block_read_safe
    .type cd_block_read_safe, @function
cd_block_read_safe:
    mov.l r14, @-r15
    mov.l r13, @-r15
    sts.l pr, @-r15
    mov r4, r13
    add #-0x8, r15
    bsr     cd_block_read_atomic
    mov r15, r4
    mov r0, r14
    tst r14, r14
    bt      .L_transition_validate
    bra     .L_transition_return
    mov r14, r0
.L_fn_input_proc_analog:
    .4byte  input_proc_analog
.L_fn_input_proc_buttons:
    .4byte  input_proc_buttons
.L_fn_input_proc_extended:
    .4byte  input_proc_extended
.L_transition_validate:
    mov r13, r5
    mov.l   .L_fn_validate_response, r3
    jsr @r3
    mov r15, r4
    mov.b @r13, r4
    mov.w   DAT_06034a8e, r2
    extu.b r4, r4
    cmp/eq r2, r4
    bt      .L_set_error_code
    mov #0x20, r2
    and r4, r2
    tst r2, r2
    bf      .L_return_result
.L_set_error_code:
    mov #-0x8, r14
.L_return_result:
    mov r14, r0
.L_transition_return:
    add #0x8, r15
    lds.l @r15+, pr
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

/* VERIFIED: inner double-read helper. Saves/restores IMASK, reads CD Block
 * registers twice for consistency check. Part of cd_block_read_safe family.
 * Method: code audit — same CD Block register addresses as cd_block_read_safe.
 * Date: 2026-02-28
 */
    .global cd_block_read_atomic
    .type cd_block_read_atomic, @function
cd_block_read_atomic:                      ! interrupt-masked double-read of CD regs
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov.l r12, @-r15
    mov.l r11, @-r15
    mov.l r10, @-r15
    mov.l r9, @-r15
    sts.l pr, @-r15
    add #-0x8, r15
    mov #0x0, r12                      ! success = 0
    mov.l   .L_fn_smpc_exchange, r14   ! r14 = SMPC exchange fn
    mov r4, r11                        ! r11 = output buffer
    mov #-0x3, r10                     ! r10 = error sentinel
    mov r12, r13                       ! r13 = retry counter
.L_smpc_retry_loop:
    stc sr, r0                         ! save current IMASK
    shlr2 r0
    shlr2 r0
    and #0xF, r0
    mov r0, r9                         ! r9 = saved IMASK
    stc sr, r0
    mov.w   .L_sr_imask_clear, r3      ! 0xFF0F: mask out IMASK bits
    and r3, r0
    or #0xF0, r0                       ! set IMASK=0xF (disable interrupts)
    ldc r0, sr
    jsr @r14                           ! 1st SMPC read (to output buffer)
    mov r11, r4
    jsr @r14                           ! 2nd SMPC read (to stack for verify)
    mov r15, r4
    mov r9, r0                         ! restore original IMASK
    and #0xF, r0
    shll2 r0
    shll2 r0
    stc sr, r2
    mov.w   .L_sr_imask_clear, r3
    and r3, r2
    or r2, r0
    ldc r0, sr                         ! interrupts re-enabled
    mov r11, r4
    mov r15, r2
    mov.l @r4, r3
    mov.l @r2, r2
    cmp/eq r2, r3
    bf      .L_smpc_mismatch
    mov r15, r2
    mov.l @(4, r4), r3
    mov.l @(4, r2), r2
    cmp/eq r2, r3
    bf      .L_smpc_mismatch
    bra     .L_smpc_update_done
    mov r12, r10
.L_smpc_mismatch:
    add #0x1, r13
    mov #0x64, r2
    cmp/ge r2, r13
    bf      .L_smpc_retry_loop
.L_smpc_update_done:
    mov r10, r0
    add #0x8, r15
    lds.l @r15+, pr
    mov.l @r15+, r9
    mov.l @r15+, r10
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global DAT_06034a8e
DAT_06034a8e:
    .2byte  0x00FF
.L_sr_imask_clear:
    .2byte  0xFF0F
    .2byte  0xFFFF
.L_fn_validate_response:
    .4byte  sym_06035F16
.L_fn_smpc_exchange:
    .4byte  sym_06035E5E

    .global ai_nop_stub
    .type ai_nop_stub, @function
ai_nop_stub:
    mov.l r14, @-r15
    mov r4, r14

    .global ai_pit_stop_logic
    .type ai_pit_stop_logic, @function
ai_pit_stop_logic:
    sts.l pr, @-r15
    add #-0x10, r15
    mov r15, r4
    mov.l   .L_fn_input_proc_analog_2, r3
    jsr @r3
    add #0x8, r4
    mov r15, r2
    mov #0x1, r3
    mov r15, r6
    mov r15, r5
    add #0x8, r2
    add #0x8, r5
    mov.b r3, @r2
    mov.l   .L_fn_input_proc_digital, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r4
    mov r15, r2
    mov.b @(2, r2), r0
    mov r0, r3
    mov.b r3, @r14
    mov r15, r3
    mov.b @(3, r3), r0
    mov r15, r3
    mov.b r0, @(1, r14)
    mov.b @(5, r3), r0
    mov r15, r3
    mov.b r0, @(2, r14)
    mov.b @(6, r3), r0
    mov r15, r3
    mov.b r0, @(3, r14)
    mov.b @(7, r3), r0
    mov r0, r2
    mov.b r0, @(4, r14)
    mov r4, r0
    add #0x10, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14

    .global track_intersect_test
    .type track_intersect_test, @function
track_intersect_test:
    mov.l r14, @-r15
    sts.l pr, @-r15
    mov r4, r14
    add #-0x14, r15
    mov r15, r4
    mov.l   .L_fn_input_proc_analog_2, r3
    jsr @r3
    add #0xC, r4
    mov r15, r2
    mov #0x2, r3
    mov r15, r6
    mov r15, r5
    add #0xC, r2
    add #0x4, r6
    add #0xC, r5
    mov.b r3, @r2
    mov.l   .L_fn_input_proc_digital, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r4
    tst r4, r4
    bt      .L_intersect_extract_addr
    mov r4, r0
    add #0x14, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14
.L_intersect_extract_addr:
    mov r15, r3
    mov r14, r5
    add #0x4, r3
    mov.l @r3, r2
    mov.l   .L_mask_low24, r3
    and r3, r2
    mov.l r2, @r15
    mov.l   .L_fn_smpc_secondary_proc, r3
    jsr @r3
    mov r2, r4
    mov r0, r4
    add #0x14, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14
    .2byte  0xFFFF
.L_fn_input_proc_analog_2:
    .4byte  input_proc_analog
.L_fn_input_proc_digital:
    .4byte  input_proc_digital
.L_mask_low24:
    .4byte  0x00FFFFFF                  /* low 24-bit mask */
.L_fn_smpc_secondary_proc:
    .4byte  smpc_secondary_proc

    .global mesh_boundary_check
    .type mesh_boundary_check, @function
mesh_boundary_check:
    mov.l r14, @-r15
    mov r4, r14
    mov.l r13, @-r15
    mov r5, r13

    .global ai_crash_recovery
    .type ai_crash_recovery, @function
ai_crash_recovery:
    sts.l pr, @-r15
    add #-0x10, r15
    mov r15, r4
    mov.l   .L_fn_input_proc_analog_3, r3
    jsr @r3
    add #0x8, r4
    mov r15, r2
    mov #0x3, r3
    extu.b r14, r14
    mov r15, r6
    mov r15, r5
    add #0x8, r2
    mov r14, r0
    add #0x8, r5
    mov.b r3, @r2
    mov r15, r2
    add #0x8, r2
    mov.b r0, @(1, r2)
    mov.l   .L_fn_input_proc_digital_2, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r4
    mov r15, r2
    mov r4, r0
    mov.l @(4, r2), r3
    mov.l r3, @r13
    add #0x10, r15
    lds.l @r15+, pr
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global road_segment_query
    .type road_segment_query, @function
road_segment_query:
    mov.l r14, @-r15
    mov.l r13, @-r15
    mov r4, r14
    mov.l r12, @-r15
    mov r6, r13
    mov.l r11, @-r15
    mov r7, r12

    .global ai_drafting_calc
    .type ai_drafting_calc, @function
ai_drafting_calc:
    sts.l pr, @-r15
    mov r5, r11
    add #-0xC, r15
    mov r15, r4
    mov.l   .L_fn_input_proc_analog_3, r3
    jsr @r3
    add #0x4, r4
    mov r15, r2
    mov #0x4, r3
    extu.w r11, r11
    extu.b r13, r13
    extu.b r12, r12
    add #0x4, r2
    mov.b r3, @r2
    mov r15, r2
    extu.b r14, r3
    add #0x4, r2
    mov r3, r0
    mov.b r0, @(1, r2)
    mov r15, r3
    mov r11, r0
    add #0x4, r3
    mov.w r0, @(2, r3)
    mov r15, r3
    mov r13, r0
    add #0x4, r3
    mov.b r0, @(6, r3)
    mov r15, r3
    mov r12, r0
    add #0x4, r3
    mov.b r0, @(7, r3)
    mov.w   .L_periph_type_mask, r0
    and r14, r0
    cmp/eq #0x1, r0
    bf      .L_no_wheel_periph
    mov.w   .L_wheel_delay_count, r2
    bra     .L_wheel_delay_loop
    nop
.L_periph_type_mask:
    .2byte  0x0081
.L_wheel_delay_count:
    .2byte  0x0DAC
.L_fn_input_proc_analog_3:
    .4byte  input_proc_analog
.L_fn_input_proc_digital_2:
    .4byte  input_proc_digital
.L_wheel_delay_dec:
    mov.l @r15, r2
    add #-0x1, r2
.L_wheel_delay_loop:
    mov.l r2, @r15
    mov.l @r15, r3
    cmp/pl r3
    bt      .L_wheel_delay_dec
    mov.l   .L_fn_periph_read_a, r3
    jsr @r3
    mov #0x41, r4
    mov r15, r5
    mov.l   .L_fn_input_proc_buttons_2, r3
    add #0x4, r5
    jsr @r3
    mov #0x40, r4
    mov r0, r14
    tst r14, r14
    bf      .L_drafting_return
    mov.l   .L_fn_smpc_cmd_helper, r3
    jsr @r3
    nop
    bra     .L_drafting_return
    nop
.L_no_wheel_periph:
    mov r15, r5
    mov.l   .L_fn_input_proc_buttons_2, r3
    add #0x4, r5
    jsr @r3
    mov #0x0, r4
    mov r0, r14
.L_drafting_return:
    mov r14, r0
    add #0xC, r15
    lds.l @r15+, pr
    mov.l @r15+, r11
    mov.l @r15+, r12
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global ai_brake_zone_calc
    .type ai_brake_zone_calc, @function
ai_brake_zone_calc:
    sts.l pr, @-r15
    add #-0x8, r15
    mov.l   .L_fn_input_proc_analog_4, r3
    jsr @r3
    mov r15, r4
    mov r15, r2
    mov #0x5, r3
    mov r15, r5
    mov.b r3, @r2
    mov.l   .L_fn_input_proc_buttons_2, r3
    jsr @r3
    mov #0x0, r4
    add #0x8, r15
    lds.l @r15+, pr
    rts
    mov r0, r4

    .global ai_brake_zone_adjust
    .type ai_brake_zone_adjust, @function
ai_brake_zone_adjust:
    mov.l r14, @-r15
    mov.l r13, @-r15
    sts.l pr, @-r15
    mov r4, r13
    add #-0x8, r15
    tst r13, r13
    bf      .L_brake_use_extended_cmd
    bra     .L_brake_send_cmd
    mov #0x2, r4
    .2byte  0xFFFF
.L_fn_periph_read_a:
    .4byte  sym_06035C92
.L_fn_input_proc_buttons_2:
    .4byte  input_proc_buttons
.L_fn_smpc_cmd_helper:
    .4byte  smpc_cmd_helper_c
.L_fn_input_proc_analog_4:
    .4byte  input_proc_analog
.L_brake_use_extended_cmd:
    mov.w   .L_brake_zone_cmd_id, r4
.L_brake_send_cmd:
    mov.l   .L_fn_input_proc_init, r3
    jsr @r3
    mov r15, r5
    mov r0, r14
    mov r13, r0
    cmp/eq #0x1, r0
    bf      .L_brake_check_result
    tst r14, r14
    bf      .L_brake_check_result
    mov.w @r15, r0
    extu.w r0, r0
    tst #0x80, r0
    bt      .L_brake_check_result
    mov #-0x4, r14
.L_brake_check_result:
    tst r14, r14
    bt      .L_brake_finalize
    mov r15, r4
    bsr     ai_brake_zone_main
    add #0x4, r4
.L_brake_finalize:
    mov.l   .L_brake_zone_param, r4
    mov.l   .L_fn_brake_finalize, r3
    jsr @r3
    nop
    mov r14, r0
    add #0x8, r15
    lds.l @r15+, pr
    mov.l @r15+, r13
    rts
    mov.l @r15+, r14

    .global ai_brake_zone_main
    .type ai_brake_zone_main, @function
ai_brake_zone_main:
    mov.l r14, @-r15
    mov r4, r14

    .global ai_brake_zone
    .type ai_brake_zone, @function
ai_brake_zone:
    sts.l pr, @-r15
    add #-0x10, r15
    mov r15, r4
    mov.l   .L_fn_input_proc_analog_5, r3
    jsr @r3
    add #0x8, r4
    mov r15, r2
    mov #0x6, r3
    mov r15, r6
    mov r15, r5
    add #0x8, r2
    add #0x8, r5
    mov.b r3, @r2
    mov.l   .L_fn_input_proc_digital_3, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r4
    mov r15, r2
    mov r4, r0
    mov.l @r2, r3
    mov.l   .L_mask_low24_06034D18, r2
    and r2, r3
    mov.l r3, @r14
    add #0x10, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14
.L_brake_zone_cmd_id:
    .2byte  0x0082
.L_fn_input_proc_init:
    .4byte  input_proc_init
.L_brake_zone_param:
    .4byte  0x0000FFFD
.L_fn_brake_finalize:
    .4byte  sym_06035C6E
.L_fn_input_proc_analog_5:
    .4byte  input_proc_analog
.L_fn_input_proc_digital_3:
    .4byte  input_proc_digital
.L_mask_low24_06034D18:
    .4byte  0x00FFFFFF                  /* low 24-bit mask */

    .global ai_throttle_modulate
    .type ai_throttle_modulate, @function
ai_throttle_modulate:
    mov.l r14, @-r15
    mov r4, r14

    .global ai_throttle_mod
    .type ai_throttle_mod, @function
ai_throttle_mod:
    sts.l pr, @-r15
    add #-0x8, r15
    mov.l   .L_fn_input_proc_analog_6, r3
    jsr @r3
    mov r15, r4
    mov r15, r2
    mov #0x10, r3
    mov r15, r5
    mov.b r3, @r2
    add #0x1, r5
    bsr     ai_throttle_adjust
    mov r14, r4
    mov r15, r2
    mov #0x10, r0
    mov r15, r5
    mov r14, r4
    mov.b @(r0, r14), r3
    add #0x5, r5
    mov r3, r0
    mov.b r0, @(4, r2)
    bsr     ai_throttle_adjust
    add #0x8, r4
    mov r15, r5
    mov.l   .L_fn_input_proc_buttons_3, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r4
    add #0x8, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14

    .global ai_throttle_adjust
    .type ai_throttle_adjust, @function
ai_throttle_adjust:
    sts.l pr, @-r15
    bra     .L_throttle_dispatch
    mov.l @r4, r0
.L_throttle_case_2:
    mov #0x0, r2
    mov.b r2, @r5
    mov.b @(4, r4), r0
    mov r0, r3
    mov.b r0, @(1, r5)
    mov.b @(5, r4), r0
    mov r0, r3
    bra     .L_throttle_store_byte2
    nop
.L_throttle_case_1:
    mov r4, r0
    add #0x4, r0
    mov.b @(1, r0), r0
    extu.b r0, r0
    or #0x80, r0
    extu.b r0, r0
    mov.b r0, @r5
    mov r4, r3
    add #0x4, r3
    mov.b @(2, r3), r0
    mov r0, r2
    mov r2, r0
    mov.b r0, @(1, r5)
    mov r4, r3
    add #0x4, r3
    mov.b @(3, r3), r0
    mov r0, r2
    mov r2, r0
.L_throttle_store_byte2:
    bra     .L_throttle_adjust_done
    mov.b r0, @(2, r5)
.L_throttle_case_3:
    mov r5, r1
    mov.l   .L_throttle_table_a, r2
    mov.l   .L_fn_memcpy_small, r3
    jsr @r3
    mov #0x3, r0
    bra     .L_throttle_adjust_done
    nop
.L_throttle_case_default:
    mov r5, r1
    mov.l   .L_throttle_table_b, r2
    mov.l   .L_fn_memcpy_small, r3
    jsr @r3
    mov #0x3, r0
    bra     .L_throttle_adjust_done
    nop
    .2byte  0xFFFF
.L_fn_input_proc_analog_6:
    .4byte  input_proc_analog
.L_fn_input_proc_buttons_3:
    .4byte  input_proc_buttons
.L_throttle_table_a:
    .4byte  sym_06059CA7
.L_fn_memcpy_small:
    .4byte  sym_06035228
.L_throttle_table_b:
    .4byte  sym_06059CA4
.L_throttle_dispatch:
    cmp/eq #0x0, r0
    bt      .L_throttle_case_default
    cmp/eq #0x1, r0
    bt      .L_throttle_case_1
    cmp/eq #0x2, r0
    bt      .L_throttle_case_2
    cmp/eq #0x3, r0
    bt      .L_throttle_case_3
    bra     .L_throttle_case_default
    nop
.L_throttle_adjust_done:
    lds.l @r15+, pr
    rts
    nop

    .global ai_recovery_handler
    .type ai_recovery_handler, @function
ai_recovery_handler:
    mov.l r14, @-r15
    sts.l pr, @-r15
    mov r4, r14
    add #-0x8, r15
    mov.l   .L_fn_input_proc_analog_7, r3
    jsr @r3
    mov r15, r4
    mov r15, r2
    mov #0x11, r3
    mov r15, r5
    mov.b r3, @r2
    add #0x1, r5
    bsr     ai_throttle_adjust
    mov r14, r4
    mov r15, r5
    mov.l   .L_fn_input_proc_buttons_4, r3
    jsr @r3
    mov #0x0, r4
    mov r0, r4
    add #0x8, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14
.L_fn_input_proc_analog_7:
    .4byte  input_proc_analog
.L_fn_input_proc_buttons_4:
    .4byte  input_proc_buttons
