/* course_desc_display -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06033614 - 0x0603367A
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Course description display element handler.
 * Trampoline calls a display callback via function pointer in r0,
 * then the data block at sym_0603363C contains the element's main
 * logic: checks special mode and demo flags, resolves the display
 * element count, and tests whether the element slot is populated.
 */

    .section .text.FUN_06033614


    .global course_desc_display
    .type course_desc_display, @function
course_desc_display:
    sts.l pr, @-r15                       ! save return address
    jsr @r0                               ! call display callback (fn ptr in r0)
    nop                                   ! delay slot
    lds.l @r15+, pr                       ! restore return address
    mov r0, r8                            ! r8 = callback result
    mov.l @r15+, r0                       ! restore saved r0 from caller
    rts                                   ! return
    nop                                   ! delay slot
    .4byte  sym_0603363C                  ! ptr to course desc element logic
    .4byte  sin_lookup                    ! ptr to sine table
    .4byte  cos_lookup                    ! ptr to cosine table

    .global sym_06033630
sym_06033630:
    .word 0x0000 /* display element descriptor: x position */
    .word 0x0000 /* display element descriptor: y position */
    .word 0x0000 /* display element descriptor: width */
    shll r0      /* 0x4000 — display element descriptor: height / attribute */
    .word 0x0000 /* display element descriptor: flags low */
    .word 0x8E00 /* display element descriptor: flags high (priority) */

    .global sym_0603363C
sym_0603363C:
    .word 0x0000 /* element descriptor B: x position */
    .word 0x0000 /* element descriptor B: y position */
    .word 0x0000 /* element descriptor B: width */
    mov.b r0, @(0, gbr) /* 0xC000 — element descriptor B: attribute */
    .word 0x0000 /* element descriptor B: flags low */
    add #0x0, r6                          ! element descriptor B: padding / flags high
    mov.l r0, @-r15                       ! push r0 (display object base)
    sts.l pr, @-r15                       ! save return address
    .byte   0xB0, 0x51    /* bsr 0x060336F2 (external) — check_special_mode */
    nop                                   ! delay slot
    lds.l @r15+, pr                       ! restore return address
    bf      .L_not_special_mode           ! branch if special mode flag not set
    mov.l @r15+, r0                       ! restore display object base
    bra     .L_check_element              ! skip to element existence check
    mov #0x1, r6                          ! r6 = 1 (single element in special mode)
.L_not_special_mode:
    .byte   0xD0, 0x82    /* mov.l .L_pool_06033864, r0 — ptr to demo_mode_flag (0x0607EAE0) */
    mov.l @r0, r0                         ! r0 = demo_mode_flag value
    cmp/pl r0                             ! test if demo mode active (> 0)
    .byte   0x89, 0x28    /* bt 0x060336B4 (external) — branch if demo mode active */
    mov.l @r15+, r0                       ! restore display object base
    .byte   0xD6, 0x15    /* mov.l .L_pool_060336BC, r6 — ptr to element count indirect (0x0603386C) */
    mov.l @r6, r6                         ! r6 = dereference first pointer
    mov.l @r6, r6                         ! r6 = dereference second pointer (element count)
    add #-0x1, r6                         ! r6 = element count - 1 (zero-based max index)
.L_check_element:
    mov.l r0, @-r15                       ! push display object base
    .byte   0xD2, 0x14    /* mov.l .L_pool_060336C0, r2 — element struct offset (0x224) */
    mov.l @(r0, r2), r3                   ! r3 = display_obj[r0 + 0x224] (element slot)
    mov #0x0, r4                          ! r4 = 0 (null check value)
    cmp/eq r4, r3                         ! test if element slot is null
    .byte   0x8B, 0x00    /* bf 0x0603367A (external) — branch if slot populated */
    mov #0x1, r4                          ! r4 = 1 (flag: element slot is empty)
