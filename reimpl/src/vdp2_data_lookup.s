/* vdp2_data_lookup -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06017372 - 0x060173AC
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Linear search through 68-byte slot structs (sym_06084FC8).
 * Compares the first byte of each struct against a search key in r4.
 * Returns the matching slot index in r0 (0..17), or 18 if not found.
 *
 * Input:  r4 = search key (byte)
 * Output: r0 = matching slot index (0-based), or 0x12 if no match
 */

    .section .text.FUN_06017372


    .global vdp2_data_lookup
    .type vdp2_data_lookup, @function
vdp2_data_lookup:
    .byte   0xD7, 0x0D    /* mov.l .L_pool_slot_table_base, r7 */
    mov #0x12, r6                         ! r6 = max slot count (18 entries)
    mov #0x0, r5                          ! r5 = current search index (starts at 0)
.L_search_loop:
    extu.b r4, r3                         ! r3 = search key (zero-extended byte)
    extu.b r5, r2                         ! r2 = current index (zero-extended byte)
    mov r2, r1                            ! r1 = index copy for stride calc
    shll2 r2                              ! r2 = index * 4
    shll2 r1                              ! r1 = index * 4
    shll2 r1                              ! r1 = index * 16
    shll2 r1                              ! r1 = index * 64
    add r1, r2                            ! r2 = index * 68 (struct stride)
    exts.w r2, r2                         ! sign-extend offset to word
    add r7, r2                            ! r2 = &slot_table[index] (struct base ptr)
    mov.b @r2, r2                         ! r2 = first byte of struct (slot ID)
    extu.b r2, r2                         ! zero-extend loaded byte
    cmp/eq r2, r3                         ! compare slot ID with search key
    bf      .L_no_match                   ! branch if no match
    bra     .L_return                     ! match found â€” jump to return
    nop                                   ! delay slot (unused)
.L_no_match:
    add #0x1, r5                          ! increment search index
    extu.b r5, r2                         ! r2 = index (zero-extended)
    cmp/ge r6, r2                         ! has index reached max (18)?
    bf      .L_search_loop                ! if not, continue searching
.L_return:
    rts                                   ! return to caller
    extu.b r5, r0                         ! r0 = result index (delay slot)
    .4byte  sym_06085490
.L_pool_slot_table_base:
    .4byte  sym_06084FC8
