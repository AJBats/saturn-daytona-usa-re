/* channel_config_b -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06014994 - 0x06014A04
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Display Channel B Config + Display Enable/Disable (112 bytes)
 *
 * Contains three functions:
 *
 *   channel_config_b()
 *     Configures display channel B by calling channel_nibble_config
 *     six times with different bitmask/value pairs. Sets up nibble-packed
 *     fields for the VDP2 display channel pipeline.
 *
 *     Calls: channel_nibble_config(bitmask, value) for each field:
 *       (0x0100, 4), (0x04, 1), (0x08, 0), (0x10, 6), (0x20, 7), (0x01, 0)
 *
 *   sym_060149CC — display_enable
 *     Sets bit 15 of the display state word (sym_060A3D88), enabling
 *     the VDP2 display output. Sets the command-ready flag (sym_060635AC)
 *     to 1 to signal a pending register commit.
 *
 *   sym_060149E0 — display_disable
 *     Clears bit 15 of the display state word (sym_060A3D88), disabling
 *     the VDP2 display output. Sets the command-ready flag (sym_060635AC)
 *     to 1 to signal a pending register commit.
 *
 * Called from: display_mode_init, engine_init_global, game_init_master,
 *   geom_output_main, render_coord_transform, render_stage_1, and others.
 */

    .section .text.FUN_06014994


    .global channel_config_b
    .type channel_config_b, @function
channel_config_b:
    mov.l r14, @-r15                        ! save r14 (will hold &channel_nibble_config)
    sts.l pr, @-r15                         ! save return address
    mov.l   .L_pool_nibble_config_fn, r14   ! r14 = &channel_nibble_config
    mov.w   .L_wpool_chan_id_256, r4         ! r4 = 0x0100 (bitmask: array_a[0] low nibble)
    jsr @r14                                ! channel_nibble_config(0x0100, 4)
    mov #0x4, r5                            ! (delay) r5 = 4 (nibble value)
    mov #0x1, r5                            ! r5 = 1 (nibble value)
    jsr @r14                                ! channel_nibble_config(0x04, 1)
    mov #0x4, r4                            ! (delay) r4 = 0x04 (bitmask: array_b[0] low byte)
    mov #0x0, r5                            ! r5 = 0 (nibble value)
    jsr @r14                                ! channel_nibble_config(0x08, 0)
    mov #0x8, r4                            ! (delay) r4 = 0x08 (bitmask: array_b[0] high byte)
    mov #0x6, r5                            ! r5 = 6 (nibble value)
    jsr @r14                                ! channel_nibble_config(0x10, 6)
    mov #0x10, r4                           ! (delay) r4 = 0x10 (bitmask: array_b[2] low byte)
    mov #0x7, r5                            ! r5 = 7 (nibble value)
    jsr @r14                                ! channel_nibble_config(0x20, 7)
    mov #0x20, r4                           ! (delay) r4 = 0x20 (bitmask: array_b[2] high byte)
    mov #0x0, r5                            ! r5 = 0 (nibble value)
    jsr @r14                                ! channel_nibble_config(0x01, 0)
    mov #0x1, r4                            ! (delay) r4 = 0x01 (bitmask: cfg_final[4] direct)
    lds.l @r15+, pr                         ! restore return address
    rts                                     ! return to caller
    mov.l @r15+, r14                        ! (delay) restore r14
.L_wpool_chan_id_256:
    .2byte  0x0100
    .2byte  0xFFFF
.L_pool_nibble_config_fn:
    .4byte  channel_nibble_config

    .global sym_060149CC
sym_060149CC:
    mov.l   .L_pool_display_enable_mask, r3  ! r3 = 0x8000 (bit 15 mask for display enable)
    mov.l   .L_pool_display_state_ptr, r2   ! r2 = &display_state (sym_060A3D88)
    mov.w @r2, r2                           ! r2 = display_state word (current value)
    or r3, r2                               ! r2 |= 0x8000 (set bit 15 = enable display)
    mov.l   .L_pool_display_state_ptr, r3   ! r3 = &display_state (reload for store)
    mov.w r2, @r3                           ! display_state = r2 (bit 15 now set)
    mov #0x1, r2                            ! r2 = 1 (command pending)
    mov.l   .L_pool_cmd_ready_flag_ptr, r3  ! r3 = &cmd_ready_flag (sym_060635AC)
    rts                                     ! return to caller
    mov.w r2, @r3                           ! (delay) cmd_ready_flag = 1 (signal pending commit)

    .global sym_060149E0
sym_060149E0:
    mov.w   .L_wpool_display_disable_mask, r3 ! r3 = 0x7FFF (bit 15 clear mask for display disable)
    mov.l   .L_pool_display_state_ptr, r2   ! r2 = &display_state (sym_060A3D88)
    mov.w @r2, r2                           ! r2 = display_state word (current value)
    and r3, r2                              ! r2 &= 0x7FFF (clear bit 15 = disable display)
    mov.l   .L_pool_display_state_ptr, r3   ! r3 = &display_state (reload for store)
    mov.w r2, @r3                           ! display_state = r2 (bit 15 now clear)
    mov #0x1, r2                            ! r2 = 1 (command pending)
    mov.l   .L_pool_cmd_ready_flag_ptr, r3  ! r3 = &cmd_ready_flag (sym_060635AC)
    rts                                     ! return to caller
    mov.w r2, @r3                           ! (delay) cmd_ready_flag = 1 (signal pending commit)
.L_wpool_display_disable_mask:
    .2byte  0x7FFF
    .2byte  0xFFFF
.L_pool_display_enable_mask:
    .4byte  0x00008000                  /* bit 15 mask — display enable */
.L_pool_display_state_ptr:
    .4byte  sym_060A3D88
.L_pool_cmd_ready_flag_ptr:
    .4byte  sym_060635AC
