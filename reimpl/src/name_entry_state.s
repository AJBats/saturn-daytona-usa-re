/* name_entry_state -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0603D43C - 0x0603D514
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Scroll Config Block B Reset (channel 3)
 *
 * Clears all four config words in scroll config block B (sym_060A4D36)
 * by applying two masks per word: 0xFF00 (keep high byte) then 0x00FF
 * (keep low byte). Each mask application is preceded by a bitfield
 * read-modify-write commit call to sym_06034F78 with channel/field
 * descriptor 0x0301 (channel 3, field 1).
 *
 * Processes words at offsets 0, 2, 4, 6 from sym_060A4D36.
 * Note: The final pair (offsets 6/4) re-reads offset 4 for the second
 * mask â€” this matches the original retail binary exactly.
 *
 * Registers:
 *   r3 = bitfield RMW utility (sym_06034F78)
 *   r4 = scroll config block B ptr (sym_060A4D36)
 *   r5 = config byte ptr (sym_060A4D58)
 *   r6 = commit value (passed as r0)
 *   r7 = byte 1 mask (0x0000FF00)
 *   r14 = byte 0 mask (0x000000FF)
 */

    .section .text.FUN_0603D43C


    .global name_entry_state
    .type name_entry_state, @function
name_entry_state:
    sts.l pr, @-r15                     ! save return address
    mov r6, r0                          ! r0 = commit value (from caller)
    mov.l   .L_mask_byte1, r7           ! r7 = 0x0000FF00 (high byte mask)
    mov.l   .L_pool_config_byte, r5     ! r5 = &config byte (sym_060A4D58)
    mov.l   .L_pool_scroll_cfg_b, r4   ! r4 = &scroll config B (sym_060A4D36)
    mov.w   .L_w_chan3_field1_desc, r1   ! r1 = 0x0301 (chan 3, field 1 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw(r0=val, r1=0x0301, r2=cfg_ptr)
    mov r5, r2                          ! (delay) r2 = config byte ptr
    ! --- word[0] offset 0: mask with 0xFF00 (keep high byte) ---
    mov r6, r0                          ! r0 = commit value
    mov.w @r4, r2                       ! r2 = scroll_cfg_b.word[0]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r7, r2                          ! r2 &= 0xFF00 (keep high byte only)
    mov.w r2, @r4                       ! write back word[0]
    mov.w   DAT_0603d500, r14           ! r14 = 0x00FF (low byte mask)
    ! --- word[0] offset 0: mask with 0x00FF (keep low byte) ---
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov r6, r0                          ! r0 = commit value
    mov.w @r4, r2                       ! r2 = scroll_cfg_b.word[0]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r14, r2                         ! r2 &= 0x00FF (keep low byte only)
    mov.w r2, @r4                       ! write back word[0]
    ! --- word[1] offset 2: mask with 0xFF00 (keep high byte) ---
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov.w @(2, r4), r0                  ! r0 = scroll_cfg_b.word[1]
    mov r0, r2                          ! r2 = word[1]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r7, r2                          ! r2 &= 0xFF00 (keep high byte only)
    extu.w r2, r0                       ! r0 = zero-extended result
    mov.w r0, @(2, r4)                  ! write back word[1]
    ! --- word[1] offset 2: mask with 0x00FF (keep low byte) ---
    mov r6, r0                          ! r0 = commit value
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov.w @(2, r4), r0                  ! r0 = scroll_cfg_b.word[1]
    mov r0, r2                          ! r2 = word[1]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r14, r2                         ! r2 &= 0x00FF (keep low byte only)
    extu.w r2, r0                       ! r0 = zero-extended result
    mov.w r0, @(2, r4)                  ! write back word[1]
    ! --- word[2] offset 4: mask with 0xFF00 (keep high byte) ---
    mov r6, r0                          ! r0 = commit value
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov.w @(4, r4), r0                  ! r0 = scroll_cfg_b.word[2]
    mov r0, r2                          ! r2 = word[2]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r7, r2                          ! r2 &= 0xFF00 (keep high byte only)
    extu.w r2, r0                       ! r0 = zero-extended result
    mov.w r0, @(4, r4)                  ! write back word[2]
    ! --- word[2] offset 4: mask with 0x00FF (keep low byte) ---
    mov r6, r0                          ! r0 = commit value
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov.w @(4, r4), r0                  ! r0 = scroll_cfg_b.word[2]
    mov r0, r2                          ! r2 = word[2]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r14, r2                         ! r2 &= 0x00FF (keep low byte only)
    extu.w r2, r0                       ! r0 = zero-extended result
    mov.w r0, @(4, r4)                  ! write back word[2]
    ! --- word[3] offset 6: mask with 0xFF00 (keep high byte) ---
    mov r6, r0                          ! r0 = commit value
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov.w @(6, r4), r0                  ! r0 = scroll_cfg_b.word[3]
    mov r0, r2                          ! r2 = word[3]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r7, r2                          ! r2 &= 0xFF00 (keep high byte only)
    extu.w r2, r0                       ! r0 = zero-extended result
    mov.w r0, @(6, r4)                  ! write back word[3]
    ! --- word[2] offset 4: mask with 0x00FF (re-reads offset 4, not 6) ---
    mov r6, r0                          ! r0 = commit value
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    mov.w @(4, r4), r0                  ! r0 = scroll_cfg_b.word[2] (NOTE: offset 4, not 6)
    mov r0, r2                          ! r2 = word[2]
    extu.w r2, r2                       ! zero-extend to 32 bits
    and r14, r2                         ! r2 &= 0x00FF (keep low byte only)
    extu.w r2, r0                       ! r0 = zero-extended result
    mov.w r0, @(4, r4)                  ! write back word[2]
    ! --- final commit ---
    mov r6, r0                          ! r0 = commit value
    mov.w   .L_w_chan3_field1_desc, r1       ! r1 = 0x0301 (chan 3 descriptor)
    mov.l   .L_pool_bitfield_rmw, r3   ! r3 = bitfield RMW utility fn
    jsr @r3                             ! bitfield_rmw commit
    mov r5, r2                          ! (delay) r2 = config byte ptr
    ! --- epilogue ---
    lds.l @r15+, pr                     ! restore return address
    rts                                 ! return
    mov.l @r15+, r14                    ! (delay) restore r14
.L_w_chan3_field1_desc:
    .2byte  0x0301                     /* [HIGH] chan 3 field 1 descriptor */

    .global DAT_0603d500
DAT_0603d500:
    .2byte  0x00FF
    .2byte  0xFFFF
.L_mask_byte1:
    .4byte  0x0000FF00                 /* [HIGH] byte 1 mask */
.L_pool_config_byte:
    .4byte  sym_060A4D58               /* [MEDIUM] scroll config byte ptr */
.L_pool_scroll_cfg_b:
    .4byte  sym_060A4D36               /* [MEDIUM] scroll config block B base */
.L_pool_bitfield_rmw:
    .4byte  sym_06034F78               /* [HIGH] bitfield read-modify-write utility */
