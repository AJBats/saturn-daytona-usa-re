/* car_select_setup -- car/course selection screen initializer
 * Translation unit: 0x060198E0 - 0x06019928
 *
 * One-time setup for entering the car/course selection screen.
 * Configures display layers, commits render state, then sets three
 * initialization flags before calling the display list loader and
 * course data handler. Finally tail-calls course_init_pipeline to
 * begin processing course selection input each frame.
 *
 * Initialization sequence:
 *   1. display_layer_config(0xC) — configure display layer 0xC
 *   2. render_state_commit() — flush/commit render state
 *   3. input_dirty_flag = 1 — mark input as changed
 *   4. course_active_flag = 1 — mark course as active
 *   5. variant_init_flag = 0xFF (-1) — reset variant init state
 *   6. BSR track_seg_phys_init — load car display lists + physics
 *   7. BSR course_data_rom_load — set up ROM course data handler
 *   8. JMP course_init_pipeline — tail-call to course input handler
 *
 * Parameters: none
 * Returns: does not return (tail-calls course_init_pipeline)
 *
 * Calls: display_layer_config, render_state_commit,
 *        track_seg_phys_init, course_data_rom_load,
 *        course_init_pipeline (tail)
 *
 * Auto-generated by tools/generate_l3_tu.py, then annotated.
 */

    .section .text.FUN_060198E0


    .global car_select_setup
    .type car_select_setup, @function
car_select_setup:
    sts.l pr, @-r15                          ! save return address
    mov.l   .L_fn_display_layer_config, r3   ! r3 -> display_layer_config
    jsr @r3                                  ! call display_layer_config(0xC)
    mov #0xC, r4                             ! (delay) r4 = layer ID 0xC
    mov.l   .L_fn_render_state_commit, r3    ! r3 -> render_state_commit
    jsr @r3                                  ! call render_state_commit()
    nop                                      ! (delay)
    mov #0x1, r4                             ! r4 = 1 (flag value)
    mov.l   .L_ptr_input_dirty_flag, r3      ! r3 -> &input_dirty_flag (sym_06085FF1)
    mov #-0x1, r1                            ! r1 = 0xFF (-1, variant reset sentinel)
    mov.b r4, @r3                            ! input_dirty_flag = 1 (mark changed)
    extu.b r4, r4                            ! zero-extend r4 to 32-bit (r4 = 1)
    mov.l   .L_ptr_course_active_flag, r3    ! r3 -> &course_active_flag (sym_06085FF6)
    mov.b r4, @r3                            ! course_active_flag = 1 (course active)
    mov.l   .L_ptr_variant_init_flag, r3     ! r3 -> &variant_init_flag (sym_06085FF7)
    mov.b r1, @r3                            ! variant_init_flag = 0xFF (reset)
    .byte   0xB0, 0x12    /* bsr 0x06019928 (track_seg_phys_init) */
    nop                                      ! (delay)
    .byte   0xB7, 0x82    /* bsr 0x0601A80C (course_data_rom_load) */
    nop                                      ! (delay)
    mov.l   .L_fn_course_init_pipeline, r3   ! r3 -> course_init_pipeline
    jmp @r3                                  ! tail-call course_init_pipeline
    lds.l @r15+, pr                          ! (delay) restore return address
    .2byte  0xFFFF                           ! alignment padding
.L_fn_display_layer_config:
    .4byte  sym_0602853E                     /* display_layer_config */
.L_fn_render_state_commit:
    .4byte  sym_06028560                     /* render_state_commit */
.L_ptr_input_dirty_flag:
    .4byte  sym_06085FF1                     /* input dirty flag (byte) */
.L_ptr_course_active_flag:
    .4byte  sym_06085FF6                     /* course active flag (byte) */
.L_ptr_variant_init_flag:
    .4byte  sym_06085FF7                     /* variant init flag (byte) */
.L_fn_course_init_pipeline:
    .4byte  course_init_pipeline             /* course selection input handler */
