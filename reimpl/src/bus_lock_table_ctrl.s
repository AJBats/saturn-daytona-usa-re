/* bus_lock_table_ctrl -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0603D3A8 - 0x0603D438
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Bus Lock Table Controller (144 bytes)
 *
 * Initializes 3 config words in Array B (sym_060A4D30) with fixed
 * bus-lock configuration values, calling the bitfield RMW utility
 * (sym_06034F78) before each word modification.
 *
 * Function:
 *   bus_lock_table_ctrl()
 *
 * Args: none (writes fixed values)
 *
 * Config word writes to Array B at sym_060A4D30:
 *   word[0] (offset 0): low byte = 0x03, high byte = 0x02 -> 0x0203
 *   word[2] (offset 2): low byte = 0x01, high byte = 0x00 -> 0x0001
 *   word[4] (offset 4): direct write 0x0004
 *
 * Each word update is preceded by a call to the bitfield RMW utility
 * (sym_06034F78) with r0=1, r1=0x0201, r2=&sym_060A4D58 to commit
 * the field descriptor to the final config area.
 *
 * Final call (6th iteration) commits but writes no word -- just returns.
 */

    .section .text.FUN_0603D3A8


    .global bus_lock_table_ctrl
    .type bus_lock_table_ctrl, @function
bus_lock_table_ctrl:
    sts.l pr, @-r15                     ! save return address
    mov #0x1, r5                        ! r5 = 0x1 (constant: commit value / bus lock enable)
    mov.l   .L_pool_mask_hi_byte, r7    ! r7 = 0x0000FF00 (mask: keep high byte, clear low byte)
    mov.l   .L_pool_cfg_final, r6       ! r6 = &sym_060A4D58 (target struct for bitfield RMW)
    mov.l   .L_pool_cfg_array_b, r4     ! r4 = &sym_060A4D30 (config word array B, 3 words)
    mov.w   .L_wpool_0603D424, r1       ! r1 = 0x0201 (field descriptor for array B RMW)
    mov.l   .L_pool_bitfield_rmw, r3    ! r3 = &sym_06034F78 (bitfield RMW utility)
    mov r5, r0                          ! r0 = 0x1 (commit value)
    jsr @r3                             ! call bitfield_rmw(r0=1, r1=0x0201, r2=&cfg_final)
    mov r6, r2                          ! (delay) r2 = &cfg_final
    ! --- word[0] low byte: set to 0x03 ---
    mov.w @r4, r0                       ! r0 = array_b[0] (16-bit config word)
    extu.w r0, r0                       ! zero-extend to 32 bits
    and r7, r0                          ! r0 &= 0xFF00 (clear low byte)
    or #0x3, r0                         ! r0 |= 0x03 (set low byte to 0x03)
    mov.w r0, @r4                       ! array_b[0] = updated word (low byte = 0x03)
    ! --- word[0] high byte: set to 0x02 ---
    mov r5, r0                          ! r0 = 0x1 (commit value)
    mov.w   .L_wpool_0603D424, r1       ! r1 = 0x0201 (field descriptor)
    mov.l   .L_pool_bitfield_rmw, r3    ! r3 = &bitfield_rmw
    jsr @r3                             ! call bitfield_rmw(1, 0x0201, &cfg_final)
    mov r6, r2                          ! (delay) r2 = &cfg_final
    mov.w @r4, r0                       ! r0 = array_b[0]
    mov.w   DAT_0603d426, r3            ! r3 = 0x0200 (high byte value to OR)
    extu.w r0, r0                       ! zero-extend
    and #0xFF, r0                       ! r0 &= 0xFF (clear high byte, keep low byte)
    or r3, r0                           ! r0 |= 0x0200 (set high byte to 0x02)
    mov.w r0, @r4                       ! array_b[0] = updated word (0x0203)
    ! --- word[2] low byte: set to 0x01 ---
    mov r5, r0                          ! r0 = 0x1 (commit value)
    mov.w   .L_wpool_0603D424, r1       ! r1 = 0x0201 (field descriptor)
    mov.l   .L_pool_bitfield_rmw, r3    ! r3 = &bitfield_rmw
    jsr @r3                             ! call bitfield_rmw(1, 0x0201, &cfg_final)
    mov r6, r2                          ! (delay) r2 = &cfg_final
    mov.w @(2, r4), r0                  ! r0 = array_b[2] (word at offset 2)
    mov r0, r2                          ! r2 = array_b[2]
    extu.w r2, r2                       ! zero-extend
    and r7, r2                          ! r2 &= 0xFF00 (clear low byte)
    or r5, r2                           ! r2 |= 0x01 (set low byte to 0x01)
    extu.w r2, r0                       ! r0 = result, clean to 16 bits
    mov.w r0, @(2, r4)                  ! array_b[2] = updated word (low byte = 0x01)
    ! --- word[2] high byte: clear to 0x00 ---
    mov r5, r0                          ! r0 = 0x1 (commit value)
    mov.w   .L_wpool_0603D424, r1       ! r1 = 0x0201 (field descriptor)
    mov.l   .L_pool_bitfield_rmw, r3    ! r3 = &bitfield_rmw
    jsr @r3                             ! call bitfield_rmw(1, 0x0201, &cfg_final)
    mov r6, r2                          ! (delay) r2 = &cfg_final
    mov.w @(2, r4), r0                  ! r0 = array_b[2]
    extu.w r0, r0                       ! zero-extend
    and #0xFF, r0                       ! r0 &= 0xFF (clear high byte, keep low byte)
    mov.w r0, @(2, r4)                  ! array_b[2] = updated word (high byte = 0x00)
    ! --- word[4]: direct write 0x0004 ---
    mov r5, r0                          ! r0 = 0x1 (commit value)
    mov.w   .L_wpool_0603D424, r1       ! r1 = 0x0201 (field descriptor)
    mov.l   .L_pool_bitfield_rmw, r3    ! r3 = &bitfield_rmw
    jsr @r3                             ! call bitfield_rmw(1, 0x0201, &cfg_final)
    mov r6, r2                          ! (delay) r2 = &cfg_final
    mov #0x4, r0                        ! r0 = 0x4 (direct value for word[4])
    mov.w r0, @(4, r4)                  ! array_b[4] = 0x0004
    ! --- final commit (no word write follows) ---
    mov r5, r0                          ! r0 = 0x1 (commit value)
    mov.w   .L_wpool_0603D424, r1       ! r1 = 0x0201 (field descriptor)
    mov.l   .L_pool_bitfield_rmw, r3    ! r3 = &bitfield_rmw
    jsr @r3                             ! call bitfield_rmw(1, 0x0201, &cfg_final)
    mov r6, r2                          ! (delay) r2 = &cfg_final
    ! --- epilogue ---
    lds.l @r15+, pr                     ! restore return address
    rts                                 ! return to caller
    nop                                 ! (delay) padding
.L_wpool_0603D424:
    .2byte  0x0201                      /* field descriptor: array B bitfield RMW param */

    .global DAT_0603d426
DAT_0603d426:
    .2byte  0x0200                      /* high byte OR value: 0x0200 */
.L_pool_mask_hi_byte:
    .4byte  0x0000FF00                  /* mask: keep high byte, clear low byte */
.L_pool_cfg_final:
    .4byte  sym_060A4D58                /* &cfg_final: target struct for bitfield RMW */
.L_pool_cfg_array_b:
    .4byte  sym_060A4D30                /* &cfg_array_b: config word array B (3 words) */
.L_pool_bitfield_rmw:
    .4byte  sym_06034F78                /* &bitfield_rmw: read-modify-write utility */
