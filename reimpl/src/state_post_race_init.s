/* state_post_race_init -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06009CFC - 0x06009D4E
 * Auto-generated by tools/generate_l3_tu.py
 *
 * State 24: Post-Race Initialization (single-frame setup)
 * Called from main state dispatch when state index == 24.
 * Also entered from: state 17 (timer=0), state 19 (A+B+C with init flag).
 *
 * Sets phase=3, calls display_mode_init and race_state_pair_2 for cleanup,
 * transitions to state 25, sets difficulty=6, calls gameover_channel_setup
 * and obj_render_update, clears car speed, sets display_flags bit 30,
 * calls camera state finalization, and clears results_flag.
 *
 * Pool entries live in the adjacent state_post_race_display.s section
 * (shared pool block at 0x06009D7C).
 */

    .section .text.FUN_06009CFC


    .global state_post_race_init
    .type state_post_race_init, @function
state_post_race_init:
    sts.l pr, @-r15

    ! Set phase = 3
    mov #0x3, r3
    .byte   0xD2, 0x1E    /* mov.l .L_pool_phase_flag, r2 */  /* &sym_0605A016 (phase flag) */
    mov.w r3, @r2                             ! phase_flag = 3

    ! Post-race cleanup A
    .byte   0xD3, 0x1E    /* mov.l .L_pool_fn_display_mode_init, r3 */  /* &display_mode_init (FUN_06014A74) */
    jsr @r3                                   ! display_mode_init()
    nop

    ! Post-race cleanup B
    .byte   0xD3, 0x1E    /* mov.l .L_pool_fn_race_state_pair_2, r3 */  /* &race_state_pair_2 (FUN_06019058) */
    jsr @r3                                   ! race_state_pair_2()
    nop

    .byte   0xB2, 0x52    /* bsr 0x0600A1B8 (external) */  ! FUN_0600A1B8 -- special input handler
    nop

    ! Transition to state 25
    mov #0x19, r2                             ! r2 = 25
    .byte   0xD3, 0x1C    /* mov.l .L_pool_state_var, r3 */  /* &sym_0605AD10 (game state variable) */
    mov.l r2, @r3                             ! state = 25

    ! Set difficulty = 6
    mov #0x6, r2
    .byte   0xD3, 0x1B    /* mov.l .L_pool_difficulty, r3 */  /* &sym_06078654 (difficulty byte) */
    mov.b r2, @r3                             ! difficulty = 6

    ! Additional post-race setup calls
    .byte   0xD3, 0x1B    /* mov.l .L_pool_fn_gameover_ch_setup, r3 */  /* &gameover_channel_setup (FUN_060032D4) */
    jsr @r3                                   ! gameover_channel_setup()
    nop
    .byte   0xD3, 0x1B    /* mov.l .L_pool_fn_obj_render_update, r3 */  /* &obj_render_update (FUN_060210F6) */
    jsr @r3                                   ! obj_render_update()
    nop

    ! Clear car speed
    .byte   0xD2, 0x1A    /* mov.l .L_pool_car_ptr, r2 */  /* &sym_0607E944 (car state pointer) */
    mov #0x0, r3
    mov.l @r2, r2                             ! r2 = *car_ptr (dereference to car object)
    mov.l r3, @(8, r2)                        ! car[0x08] = 0 (speed = 0)

    ! Set display_flags bit 30
    .byte   0xD4, 0x19    /* mov.l .L_pool_display_flags, r4 */  /* &sym_0605B6D8 (display flags) */
    .byte   0xD2, 0x1A    /* mov.l .L_pool_const_bit30, r2 */  /* 0x40000000 (bit 30 mask) */
    mov.l @r4, r3                             ! r3 = current display_flags
    or r2, r3                                 ! r3 |= 0x40000000
    mov.l r3, @r4                             ! display_flags |= bit 30

    ! Camera state finalization
    .byte   0xD3, 0x19    /* mov.l .L_pool_fn_camera_finalize, r3 */  /* &sym_06026CE0 (camera state finalization) */
    jsr @r3                                   ! camera_state_finalize()
    nop

    ! Clear results flag and return
    mov #0x0, r2
    .byte   0xD3, 0x18    /* mov.l .L_pool_results_flag, r3 */  /* &sym_06059F44 (results flag) */
    lds.l @r15+, pr
    rts
    mov.l r2, @r3                             ! results_flag = 0 (delay slot)
