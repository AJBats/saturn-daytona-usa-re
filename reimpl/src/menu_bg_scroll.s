/* menu_bg_scroll -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0603B598 - 0x0603B5D0
 * Auto-generated by tools/generate_l3_tu.py
 */

    .section .text.FUN_0603B598


    .global menu_bg_scroll
    .type menu_bg_scroll, @function
menu_bg_scroll:
    sts.l pr, @-r15                    ! save return address
    mov #0x1D, r1                       ! r1 = flags byte offset
    add #-0x8, r15                      ! allocate 8 bytes on stack
    mov.l r5, @r15                      ! save scroll value (r5) to stack
    mov.l @r4, r0                       ! r0 = menu context base pointer
    mov.b @(r0, r1), r0                 ! r0 = flags byte at offset 0x1D
    extu.b r0, r0                       ! zero-extend to 32-bit
    tst #0x60, r0                       ! test scroll-lock bits (0x40 | 0x20)
    bf      .L_commit_and_return        ! if either lock bit set, skip update
    bra     .L_apply_scroll             ! fall through to scroll update
    nop
.L_apply_scroll:
    mov.l @r4, r2                       ! r2 = menu context base pointer
    mov.l @r15, r5                      ! r5 = restore scroll value from stack
    mov.l   .L_pool_field_write, r3     ! r3 = field_write_byte function
    mov.l @(24, r2), r4                 ! r4 = scroll sub-struct at offset 24
    jsr @r3                             ! call field_write_byte(r4=sub_struct, r5=value)
    extu.b r5, r5                       ! delay slot: zero-extend scroll value
    mov.l r0, @(4, r15)                 ! save old field value to stack
.L_commit_and_return:
    .byte   0xB1, 0xBE    /* bsr 0x0603B93C (external) */  ! call save_checksum_calc
    mov #0x0, r4                        ! delay slot: r4 = 0 (success status)
    mov.l @(4, r15), r0                 ! r0 = return value (old field value)
    add #0x8, r15                       ! deallocate stack frame
    lds.l @r15+, pr                     ! restore return address
    rts                                 ! return to caller
    nop                                 ! delay slot
    .2byte  0xFFFF                      ! alignment padding
.L_pool_field_write:
    .4byte  sym_06040894
