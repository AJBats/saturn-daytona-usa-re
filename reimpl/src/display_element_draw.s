/* display_element_draw -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0603D5D0 - 0x0603D7B0
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Draws a single display element by clearing individual bits from two
 * config words (offsets 0 and 2), then zeroing the remaining data words
 * (offsets 4-14). Each bit-clear is preceded by a bitfield commit call
 * to sym_06034F78 (bitfield read-modify-write utility).
 *
 * Element structure at sym_060A4D46 (16 bytes = 8 words):
 *   word[0] (offset 0): element flags A — bits 0-6 cleared individually
 *   word[1] (offset 2): element flags B — bits 0-6 cleared individually
 *   words[2-7] (offsets 4-14): element data — zeroed out
 *
 * Persistent registers:
 *   r4 = element base ptr (sym_060A4D46, channel 5 display data)
 *   r5 = config base ptr (sym_060A4D58, channel config byte)
 *   r6 = 1 (constant: bitfield commit value)
 *   r7 = current bit-clear mask (changes across phases)
 */

    .section .text.FUN_0603D5D0


    .global display_element_draw
    .type display_element_draw, @function
display_element_draw:
    sts.l pr, @-r15               ! save return address
    mov #0x1, r6                  ! r6 = 1 (commit value, persistent)
    mov.l   .L_mask_clear_bit0, r7 ! r7 = 0xFFFE (clear bit 0 mask)
    mov.l   .L_ptr_config_base, r5 ! r5 = &config (sym_060A4D58)
    mov.l   .L_ptr_elem_base, r4  ! r4 = &elem (sym_060A4D46, channel 5)
    mov.w   .L_chan5_id, r1       ! r1 = 0x0501 (channel 5, enable)
    mov.l   .L_fn_bitfield_commit, r3 ! r3 = bitfield_commit fn
    mov r6, r0                    ! r0 = 1 (value to commit)
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2                    ! (delay) r2 = config ptr
    ! --- flags_a bit 0: commit then clear ---
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov r6, r0                    ! r0 = 1
    extu.w r2, r2                 ! zero-extend to 32-bit
    and r7, r2                    ! clear bit 0 (& 0xFFFE)
    mov.w r2, @r4                 ! write back flags_a
    ! --- flags_a bit 1: commit then clear ---
    mov.w   .L_chan5_id, r1       ! r1 = 0x0501
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2                    ! (delay) r2 = config ptr
    mov r6, r0                    ! r0 = 1
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov.l   .L_mask_clear_bit1, r3 ! r3 = 0xFFFD
    extu.w r2, r2
    and r3, r2                    ! clear bit 1
    mov.w r2, @r4                 ! write back flags_a
    ! --- flags_a bit 2: commit then clear ---
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov r6, r0
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov.l   .L_mask_clear_bit2, r3 ! r3 = 0xFFFB
    extu.w r2, r2
    and r3, r2                    ! clear bit 2
    mov.w r2, @r4
    ! --- flags_a bit 3: commit then clear ---
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov r6, r0
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov.l   .L_mask_clear_bit3, r3 ! r3 = 0xFFF7
    extu.w r2, r2
    and r3, r2                    ! clear bit 3
    mov.w r2, @r4
    ! --- flags_a bit 4: commit then clear ---
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov r6, r0
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov.l   .L_mask_clear_bit4, r3 ! r3 = 0xFFEF
    extu.w r2, r2
    and r3, r2                    ! clear bit 4
    mov.w r2, @r4
    ! --- flags_a bit 5: commit then clear ---
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov r6, r0
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov.l   .L_mask_clear_bit5, r3 ! r3 = 0xFFDF
    extu.w r2, r2
    and r3, r2                    ! clear bit 5
    mov.w r2, @r4
    ! --- flags_a bit 6: commit then clear ---
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov r6, r0
    mov.w @r4, r2                 ! r2 = elem.flags_a
    mov.l   .L_mask_clear_bit6, r3 ! r3 = 0xFFBF
    extu.w r2, r2
    and r3, r2                    ! clear bit 6
    mov.w r2, @r4
    ! === Phase 2: clear flags_b (word at offset 2) bits 0-4 ===
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    ! --- flags_b bit 0: clear (reuse r7 = 0xFFFE) ---
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov r0, r2
    extu.w r2, r2
    and r7, r2                    ! clear bit 0 (& 0xFFFE)
    extu.w r2, r0
    mov.w r0, @(2, r4)            ! write back flags_b
    ! --- flags_b bit 1: commit then clear ---
    mov r6, r0
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov.l   .L_mask_clear_bit1, r3 ! r3 = 0xFFFD
    mov r0, r2
    extu.w r2, r2
    and r3, r2                    ! clear bit 1
    extu.w r2, r0
    mov.w r0, @(2, r4)
    ! --- flags_b bit 2: commit then clear ---
    mov r6, r0
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov.l   .L_mask_clear_bit2, r3 ! r3 = 0xFFFB
    mov r0, r2
    extu.w r2, r2
    and r3, r2                    ! clear bit 2
    extu.w r2, r0
    mov.w r0, @(2, r4)
    ! --- flags_b bit 3: commit then clear ---
    mov r6, r0
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov.l   .L_mask_clear_bit3, r3 ! r3 = 0xFFF7
    mov r0, r2
    extu.w r2, r2
    and r3, r2                    ! clear bit 3
    extu.w r2, r0
    mov.w r0, @(2, r4)
    ! --- flags_b bit 4: commit then clear ---
    mov r6, r0
    mov.w   .L_chan5_id, r1
    mov.l   .L_fn_bitfield_commit, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov r0, r2
    extu.w r2, r2
    mov.l   .L_mask_clear_bit4, r3 ! r3 = 0xFFEF
    and r3, r2                    ! clear bit 4
    extu.w r2, r0
    bra     .L_clear_flags_b      ! jump past literal pool
    nop
    ! --- literal pool (mid-function) ---
.L_chan5_id:
    .2byte  0x0501                ! channel 5, enable flag
    .2byte  0xFFFF                ! (padding)
.L_mask_clear_bit0:
    .4byte  0x0000FFFE            ! ~bit0
.L_ptr_config_base:
    .4byte  sym_060A4D58          ! display channel config byte
.L_ptr_elem_base:
    .4byte  sym_060A4D46          ! channel 5 element data (16 bytes)
.L_fn_bitfield_commit:
    .4byte  sym_06034F78          ! bitfield read-modify-write utility
.L_mask_clear_bit1:
    .4byte  0x0000FFFD            ! ~bit1
.L_mask_clear_bit2:
    .4byte  0x0000FFFB            ! ~bit2
.L_mask_clear_bit3:
    .4byte  0x0000FFF7            ! ~bit3
.L_mask_clear_bit4:
    .4byte  0x0000FFEF            ! ~bit4
.L_mask_clear_bit5:
    .4byte  0x0000FFDF            ! ~bit5
.L_mask_clear_bit6:
    .4byte  0x0000FFBF            ! ~bit6
.L_clear_flags_b:
    mov.w r0, @(2, r4)            ! write back flags_b (bit 4 cleared)
    ! --- flags_b bit 5: commit then clear ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov.l   .L_mask_clear_bit5_b, r3 ! r3 = 0xFFDF
    mov r0, r2
    extu.w r2, r2
    and r3, r2                    ! clear bit 5
    extu.w r2, r0
    mov.w r0, @(2, r4)
    ! --- flags_b bit 6: commit then clear ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    mov.w @(2, r4), r0            ! r0 = elem.flags_b
    mov #0x0, r7                  ! r7 = 0 (zero for data words)
    mov.l   .L_mask_clear_bit6_b, r3 ! r3 = 0xFFBF
    mov r0, r2
    extu.w r2, r2
    and r3, r2                    ! clear bit 6
    extu.w r2, r0
    mov.w r0, @(2, r4)
    ! === Phase 3: zero data words (offsets 4-14) ===
    ! --- word[2] = 0 ---
    mov r6, r0                    ! r0 = 1
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    extu.w r7, r0                 ! r0 = 0
    mov.w r0, @(4, r4)            ! elem[4] = 0
    ! --- word[3] = 0 ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    extu.w r7, r0                 ! r0 = 0
    mov.w r0, @(6, r4)            ! elem[6] = 0
    ! --- word[4] = 0 ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    extu.w r7, r0                 ! r0 = 0
    mov.w r0, @(8, r4)            ! elem[8] = 0
    ! --- word[5] = 0 ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    extu.w r7, r0                 ! r0 = 0
    mov.w r0, @(10, r4)           ! elem[10] = 0
    ! --- word[6] = 0 ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    extu.w r7, r0                 ! r0 = 0
    mov.w r0, @(12, r4)           ! elem[12] = 0
    ! --- word[7] = 0 ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    extu.w r7, r0                 ! r0 = 0
    mov.w r0, @(14, r4)           ! elem[14] = 0
    ! --- final commit and return ---
    mov r6, r0
    mov.w   .L_chan5_id_b, r1
    mov.l   .L_fn_bitfield_commit_b, r3
    jsr @r3                       ! bitfield_commit(1, 0x0501, config)
    mov r5, r2
    lds.l @r15+, pr               ! restore return address
    rts
    nop
    ! --- literal pool (end of function) ---
.L_chan5_id_b:
    .2byte  0x0501                ! channel 5, enable flag (duplicate for range)
    .2byte  0xFFFF                ! (padding)
.L_fn_bitfield_commit_b:
    .4byte  sym_06034F78          ! bitfield read-modify-write utility (dup)
.L_mask_clear_bit5_b:
    .4byte  0x0000FFDF            ! ~bit5
.L_mask_clear_bit6_b:
    .4byte  0x0000FFBF            ! ~bit6
