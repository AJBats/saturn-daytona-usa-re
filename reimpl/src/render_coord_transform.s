/* render_coord_transform -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0601D2DC - 0x0601D3C0
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Results/ranking screen render setup — configures VDP2 display channels,
 * loads pattern data to VDP2 VRAM, copies palettes to CRAM, and initializes
 * the display list for the post-race results or ranking screen.
 *
 * Steps:
 *   1. Initialize VDP2 display system (sym_060149E0)
 *   2. Configure 5 VDP2 display channels via channel_nibble_config
 *   3. Initialize audio display
 *   4. Upload character patterns to VDP2 VRAM +0x6F9C4
 *   5. Copy 3 palette banks to CRAM 0x600/0x660/0x000
 *   6. DMA transfer 2 tilemap blocks to VDP2 VRAM
 *   7. Load display list for results screen
 *   8. Clear state flag and tail-call display finalize
 */

    .section .text.FUN_0601D2DC


    .global render_coord_transform
    .type render_coord_transform, @function
render_coord_transform:
    mov.l r14, @-r15
    sts.l pr, @-r15
    add #-0x4, r15
    mov.l   .L_fn_vdp2_init, r3       /* step 1: init VDP2 display system */
    jsr @r3
    nop
    mov.l   .L_fn_chan_config, r14    /* step 2: configure 5 display channels */
    mov.w   .L_chan_id_0x100, r4      /* channel 0x100: priority 0 */
    jsr @r14
    mov #0x0, r5
    mov #0x0, r5                      /* channel 4: priority 0 */
    jsr @r14
    mov #0x4, r4
    mov #0x0, r5                      /* channel 8: priority 0 */
    jsr @r14
    mov #0x8, r4
    mov #0x6, r5                      /* channel 0x10: priority 6 */
    jsr @r14
    mov #0x10, r4
    mov #0x7, r5                      /* channel 0x20: priority 7 */
    jsr @r14
    mov #0x20, r4
    mov.l   .L_fn_audio_disp, r3     /* step 3: init audio display */
    jsr @r3
    nop
    mov #0x8, r7                      /* step 4: upload patterns to VDP2 VRAM */
    mov.l   .L_rom_pattern_offset, r5
    mov.l   .L_vdp2_vram_0x6F9C4, r4
    mov.l   .L_fn_pattern_upload, r3
    jsr @r3
    mov #0x0, r6
    mov #0x40, r6                     /* step 5: copy 3 palettes to CRAM */
    mov.l   .L_pal_base, r2          /* palette A → CRAM 0x600 (64 bytes) */
    mov.l   .L_fn_dma_transfer, r14
    mov.l r2, @r15
    mov.l   .L_vdp2_cram_0x600, r4
    jsr @r14
    mov r2, r5
    mov.l   .L_pal_sprite_c, r5      /* palette B → CRAM 0x660 (96 bytes) */
    mov.l   .L_vdp2_cram_0x660, r4
    jsr @r14
    mov #0x60, r6
    mov #0x60, r6                     /* palette A → CRAM 0x000 (96 bytes, reuse) */
    mov.l   .L_vdp2_cram_0x000, r4
    jsr @r14
    mov.l @r15, r5
    mov.l   .L_tilemap_a, r5         /* step 6: DMA tilemap A → VDP2 VRAM +0x759EC */
    mov.l   .L_vdp2_vram_0x759EC, r4
    mov.l   .L_fn_dma_mem, r3
    jsr @r3
    nop
    mov.l   .L_tilemap_b, r2         /* DMA tilemap B → VDP2 VRAM +0x75DDC */
    mov.l r2, @r15
    mov.l   .L_vdp2_vram_0x75DDC, r4
    mov.l   .L_fn_dma_mem, r3
    jsr @r3
    mov r2, r5
    mov #0x0, r6                      /* step 7: load display list */
    mov.l @r15, r5
    mov.w   DAT_0601d36c, r7         /* display list size (0x1000) */
    mov.l   .L_fn_disp_loader, r3
    jsr @r3
    mov #0x8, r4
    mov #0x0, r2                      /* step 8: clear state flag */
    mov.l   .L_state_flag, r3
    mov.b r2, @r3
    add #0x4, r15
    lds.l @r15+, pr
    mov.l   .L_fn_disp_finalize, r3  /* tail-call display finalize */
    jmp @r3
    mov.l @r15+, r14
.L_chan_id_0x100:
    .2byte  0x0100                      /* display channel ID */

    .global DAT_0601d36c
DAT_0601d36c:
    .2byte  0x1000                      /* display list size */
    .2byte  0xFFFF
.L_fn_vdp2_init:
    .4byte  sym_060149E0               /* VDP2 display system init */
.L_fn_chan_config:
    .4byte  channel_nibble_config      /* display channel priority config */
.L_fn_audio_disp:
    .4byte  audio_display_init         /* audio display init */
.L_rom_pattern_offset:
    .4byte  0x00017700                  /* ROM offset: character pattern data */
.L_vdp2_vram_0x6F9C4:
    .4byte  0x25E6F9C4                  /* VDP2 VRAM +0x6F9C4 — pattern destination */
.L_fn_pattern_upload:
    .4byte  sym_0600511E               /* pattern data upload */
.L_fn_dma_transfer:
    .4byte  dma_transfer               /* word-indexed memcpy */
.L_pal_base:
    .4byte  sym_0604842C               /* source: base palette (64 bytes) */
.L_vdp2_cram_0x600:
    .4byte  0x25F00600                  /* VDP2 color RAM +0x600 — sprite high bank */
.L_pal_sprite_c:
    .4byte  sym_0604888C               /* source: sprite palette C (96 bytes) */
.L_vdp2_cram_0x660:
    .4byte  0x25F00660                  /* VDP2 color RAM +0x660 — sprite C */
.L_vdp2_cram_0x000:
    .4byte  0x25F00000                  /* VDP2 color RAM +0x000 — bank 0 */
.L_tilemap_a:
    .4byte  sym_06094FA8               /* source: tilemap A (results screen) */
.L_vdp2_vram_0x759EC:
    .4byte  0x25E759EC                  /* VDP2 VRAM +0x759EC — tilemap A destination */
.L_fn_dma_mem:
    .4byte  dma_memory_transfer        /* DMA memory transfer */
.L_tilemap_b:
    .4byte  sym_06095F48               /* source: tilemap B (results screen) */
.L_vdp2_vram_0x75DDC:
    .4byte  0x25E75DDC                  /* VDP2 VRAM +0x75DDC — tilemap B destination */
.L_fn_disp_loader:
    .4byte  sym_06028400               /* display list loader */
.L_state_flag:
    .4byte  sym_0607887F               /* results screen state flag (byte) */
.L_fn_disp_finalize:
    .4byte  sym_060149CC               /* display system finalize */
