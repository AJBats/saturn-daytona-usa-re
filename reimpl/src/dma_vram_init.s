/* dma_vram_init -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x060038D4 - 0x060039C8
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Initial palette load — copies 14 palette source buffers from Work RAM
 * into VDP2 Color RAM banks via dma_transfer (word-indexed memcpy).
 *
 * VDP2 CRAM layout (2048 colors in mode 1, 15-bit RGB):
 *   0x000-0x05F  Bank  0: NBG0 palette (96 bytes = 48 colors)
 *   0x060-0x09F  Bank  1: NBG0 extended (64 bytes = 32 colors)
 *   0x0A0-0x0DF  Bank  2: NBG1 palette (32 bytes = 16 colors)
 *   0x0E0-0x0FF  Bank  3: NBG2 palette
 *   0x100-0x11F  Bank  4: NBG3 palette
 *   0x120-0x13F  Bank  5: RBG0 palette
 *   0x140-0x15F  Bank  6: sprite bank A
 *   0x160-0x17F  Bank  7: sprite bank B
 *   0x1A0-0x1DF  Bank  8: course UI palette (64 bytes)
 *   0x1C0-0x1FF  Bank  9: HUD palette (64 bytes)
 *   0x600-0x63F  Bank 10: sprite bank B (high mirror) — reuses bank 1 source
 *   0x660-0x6BF  Bank 11: sprite bank C (96 bytes)
 *   0x7A0-0x7BF  Bank 12: course UI palette (high mirror)
 *   0x7C0-0x7FF  Bank 13: HUD palette (high mirror)
 */

    .section .text.FUN_060038D4


    .global dma_vram_init
    .type dma_vram_init, @function
dma_vram_init:
    mov.l r14, @-r15
    sts.l pr, @-r15
    add #-0xC, r15
    mov.l   .L_fn_dma_transfer, r14  /* r14 = dma_transfer (reused for all 14 copies) */
    mov.l   .L_pal_nbg0_base, r5    /* copy 0: NBG0 base → CRAM 0x000 (96 bytes) */
    mov.l   .L_vdp2_cram_0x000, r4
    jsr @r14
    mov #0x60, r6                    /* r6 = 0x60 = 96 bytes */
    mov #0x40, r6                    /* copy 1: NBG0 ext → CRAM 0x060 (64 bytes) */
    mov.l   .L_pal_nbg0_ext, r3
    mov.l r3, @(8, r15)
    mov.l   .L_vdp2_cram_0x060, r4
    jsr @r14
    mov r3, r5
    mov.l   .L_pal_nbg1, r5          /* copy 2: NBG1 → CRAM 0x0A0 (32 bytes) */
    mov.l   .L_vdp2_cram_0x0A0, r4
    jsr @r14
    mov #0x20, r6
    mov.l   .L_pal_nbg2, r5          /* copy 3: NBG2 → CRAM 0x0E0 (32 bytes) */
    mov.l   .L_vdp2_cram_0x0E0, r4
    jsr @r14
    mov #0x20, r6
    mov.l   .L_pal_nbg3, r5          /* copy 4: NBG3 → CRAM 0x100 (32 bytes) */
    mov.l   .L_vdp2_cram_0x100, r4
    jsr @r14
    mov #0x20, r6
    mov.l   .L_pal_rbg0, r5          /* copy 5: RBG0 → CRAM 0x120 (32 bytes) */
    mov.l   .L_vdp2_cram_0x120, r4
    jsr @r14
    mov #0x20, r6
    mov.l   .L_pal_sprite_a, r5      /* copy 6: sprite A → CRAM 0x140 (32 bytes) */
    mov.l   .L_vdp2_cram_0x140, r4
    jsr @r14
    mov #0x20, r6
    mov.l   .L_pal_sprite_b, r5      /* copy 7: sprite B → CRAM 0x160 (32 bytes) */
    mov.l   .L_vdp2_cram_0x160, r4
    jsr @r14
    mov #0x20, r6
    mov #0x20, r6                     /* copy 8: course UI → CRAM 0x1A0 (32 bytes, extended to 64 below) */
    mov.l   .L_pal_course_ui, r3
    mov.l r3, @r15
    mov.l   .L_vdp2_cram_0x1A0, r4
    jsr @r14
    mov r3, r5
    mov #0x40, r6                     /* copy 9: HUD → CRAM 0x1C0 (64 bytes) */
    mov.l   .L_pal_hud, r3
    mov.l r3, @(4, r15)
    mov.l   .L_vdp2_cram_0x1C0, r4
    jsr @r14
    mov r3, r5
    mov #0x40, r6                     /* copy 10: NBG0 ext → CRAM 0x600 (high mirror, 64 bytes) */
    mov.l   .L_vdp2_cram_0x600, r4
    jsr @r14
    mov.l @(8, r15), r5              /* reuse NBG0 ext source from stack */
    mov.l   .L_pal_sprite_c, r5      /* copy 11: sprite C → CRAM 0x660 (96 bytes) */
    mov.l   .L_vdp2_cram_0x660, r4
    jsr @r14
    mov #0x60, r6
    mov #0x20, r6                     /* copy 12: course UI → CRAM 0x7A0 (high mirror, 64 bytes) */
    mov.l   .L_vdp2_cram_0x7A0, r4
    jsr @r14
    mov.l @r15, r5                   /* reuse course UI source from stack */
    mov #0x40, r6                     /* copy 13: HUD → CRAM 0x7C0 (high mirror, 64 bytes) */
    mov.l   .L_vdp2_cram_0x7C0, r4
    jsr @r14
    mov.l @(4, r15), r5             /* reuse HUD source from stack */
    add #0xC, r15
    lds.l @r15+, pr
    rts
    mov.l @r15+, r14
.L_fn_dma_transfer:
    .4byte  dma_transfer               /* word-indexed memcpy */
.L_pal_nbg0_base:
    .4byte  sym_0604814C               /* source: NBG0 base palette (48 colors) */
.L_vdp2_cram_0x000:
    .4byte  0x25F00000                  /* VDP2 color RAM +0x000 — bank 0 */
.L_pal_nbg0_ext:
    .4byte  sym_0604848C               /* source: NBG0 extended palette (32 colors) */
.L_vdp2_cram_0x060:
    .4byte  0x25F00060                  /* VDP2 color RAM +0x060 — bank 1 */
.L_pal_nbg1:
    .4byte  sym_060484CC               /* source: NBG1 palette */
.L_vdp2_cram_0x0A0:
    .4byte  0x25F000A0                  /* VDP2 color RAM +0x0A0 — bank 2 */
.L_pal_nbg2:
    .4byte  sym_060485AC               /* source: NBG2 palette */
.L_vdp2_cram_0x0E0:
    .4byte  0x25F000E0                  /* VDP2 color RAM +0x0E0 — bank 3 */
.L_pal_nbg3:
    .4byte  sym_0604892C               /* source: NBG3 palette */
.L_vdp2_cram_0x100:
    .4byte  0x25F00100                  /* VDP2 color RAM +0x100 — bank 4 */
.L_pal_rbg0:
    .4byte  sym_060488EC               /* source: RBG0 palette */
.L_vdp2_cram_0x120:
    .4byte  0x25F00120                  /* VDP2 color RAM +0x120 — bank 5 */
.L_pal_sprite_a:
    .4byte  sym_0604890C               /* source: sprite palette A */
.L_vdp2_cram_0x140:
    .4byte  0x25F00140                  /* VDP2 color RAM +0x140 — bank 6 */
.L_pal_sprite_b:
    .4byte  sym_0605CDBC               /* source: sprite palette B */
.L_vdp2_cram_0x160:
    .4byte  0x25F00160                  /* VDP2 color RAM +0x160 — bank 7 */
.L_pal_course_ui:
    .4byte  sym_060487EC               /* source: course UI palette */
.L_vdp2_cram_0x1A0:
    .4byte  0x25F001A0                  /* VDP2 color RAM +0x1A0 — bank 8 */
.L_pal_hud:
    .4byte  sym_060483EC               /* source: HUD palette */
.L_vdp2_cram_0x1C0:
    .4byte  0x25F001C0                  /* VDP2 color RAM +0x1C0 — bank 9 */
.L_vdp2_cram_0x600:
    .4byte  0x25F00600                  /* VDP2 color RAM +0x600 — high bank (sprite B mirror) */
.L_pal_sprite_c:
    .4byte  sym_0604888C               /* source: sprite palette C */
.L_vdp2_cram_0x660:
    .4byte  0x25F00660                  /* VDP2 color RAM +0x660 — high bank (sprite C) */
.L_vdp2_cram_0x7A0:
    .4byte  0x25F007A0                  /* VDP2 color RAM +0x7A0 — high bank (course UI mirror) */
.L_vdp2_cram_0x7C0:
    .4byte  0x25F007C0                  /* VDP2 color RAM +0x7C0 — high bank (HUD mirror) */
