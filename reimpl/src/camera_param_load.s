/* camera_param_load -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0600A5B2 - 0x0600A614
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Camera parameter load â€” loads and applies camera transform parameters for
 * a given car index. This is structurally identical to a single branch of
 * camera_scene_setup, but uses its own parameter tables (in the 0x0606350x
 * range) rather than the per-state tables used by camera_scene_setup.
 *
 * Steps:
 *   1. Scales car index (r4) by 4 to form a dword offset
 *   2. Indexes into rotation source and destination arrays, dereferences both
 *   3. Calls sprite_matrix_transform (sym_06031D8C) with r4=dest, r5=source
 *   4. Indexes into display param array, dereferences it
 *   5. Reads per-mode scale factor (16-bit) from sym_06089E98
 *   6. Indexes into model param array, dereferences it
 *   7. Tail-calls register save wrapper (sym_06031A28) with display/model params
 *
 * Arguments:
 *   r4 = car index (0-based, used to index into parameter arrays)
 *
 * Return value:
 *   Returns through sym_06031A28 (tail call)
 *
 * Note: The first 4 pool entries (sym_060634A4..sym_0606346C) are cross-TU
 * pool data referenced by camera_scene_setup's forward-reaching mov.l
 * instructions. They are not used by this function directly.
 */

    .section .text.FUN_0600A5B2


    .global camera_param_load
    .type camera_param_load, @function
camera_param_load:
    mov.l r14, @-r15                         ! save r14 (callee-saved)
    sts.l pr, @-r15                          ! save return address
    mov r4, r14                              ! r14 = car_index
    add #-0x4, r15                           ! allocate 4 bytes on stack
    shll2 r14                                ! r14 = car_index * 4 (dword offset)
    mov.l r4, @r15                           ! store original car_index on stack
    .byte   0xD5, 0x0E    /* mov.l .L_pool_rot_source_array, r5 */
    .byte   0xD4, 0x0E    /* mov.l .L_pool_rot_dest_array, r4 */
    .byte   0xD3, 0x0F    /* mov.l .L_pool_fn_matrix_xform, r3 */
    add r14, r5                              ! r5 -> rot_source_array[car_index]
    add r14, r4                              ! r4 -> rot_dest_array[car_index]
    mov.l @r5, r5                            ! r5 = rotation source param ptr
    jsr @r3                                  ! call sprite_matrix_transform(r4, r5)
    mov.l @r4, r4                            ! r4 = rotation dest param ptr (delay slot)
    .byte   0xD6, 0x0D    /* mov.l .L_pool_display_array, r6 */
    add r14, r6                              ! r6 -> display_array[car_index]
    mov.l @r6, r6                            ! r6 = display param ptr
    .byte   0xD5, 0x0C    /* mov.l .L_pool_scale_factor, r5 */
    mov.w @r5, r5                            ! r5 = per-mode scale factor (16-bit)
    .byte   0xD4, 0x0C    /* mov.l .L_pool_model_array, r4 */
    add r14, r4                              ! r4 -> model_array[car_index]
    mov.l @r4, r4                            ! r4 = model param ptr
    add #0x4, r15                            ! free stack allocation
    lds.l @r15+, pr                          ! restore return address
    .byte   0xD3, 0x0B    /* mov.l .L_pool_fn_reg_save, r3 */
    jmp @r3                                  ! tail-call register save wrapper (sym_06031A28)
    mov.l @r15+, r14                         ! restore r14 (delay slot)
! --- cross-TU pool data (referenced by camera_scene_setup) ---
    .4byte  sym_060634A4                     ! state 1 rotation source params
    .4byte  sym_06063450                     ! state 1 rotation dest params
    .4byte  sym_060634C0                     ! state 2 rotation source params
    .4byte  sym_0606346C                     ! state 2 rotation dest params
! --- constant pool for camera_param_load ---
.L_pool_rot_source_array:
    .4byte  sym_06063538                     ! rotation source param array base
.L_pool_rot_dest_array:
    .4byte  sym_06063520                     ! rotation dest param array base
.L_pool_fn_matrix_xform:
    .4byte  sym_06031D8C                     ! sprite_matrix_transform function
.L_pool_display_array:
    .4byte  sym_0606352C                     ! display param array base
.L_pool_scale_factor:
    .4byte  sym_06089E98                     ! per-mode scale factor (16-bit word)
.L_pool_model_array:
    .4byte  sym_06063514                     ! model param array base
.L_pool_fn_reg_save:
    .4byte  sym_06031A28                     ! register save wrapper / transform chain B
