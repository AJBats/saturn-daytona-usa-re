/* hud_sound_trigger -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06010B54 - 0x06010BC4
 * Auto-generated by tools/generate_l3_tu.py
 *
 * VERIFIED: dispatches HUD sound effects via sound_cmd_dispatch.
 * Zero drawing code — no VDP writes, no sprite commands, no coordinates.
 * Method: code audit — only external call is jsr sound_cmd_dispatch.
 *         55 instructions, every one accounted for.
 * Date: 2026-02-28
 *
 * Path A (hud_active_flag != 0):
 *   Checks scale_mode_flag. If scale_mode == 1, plays the fixed
 *   sound 0xAB110AFF. Otherwise plays an alternate sound loaded
 *   from a cross-TU pool entry (0xAB110BFF).
 *
 * Path B (hud_active_flag == 0):
 *   Indexes into a display list table (sym_0604483C) using the
 *   car/sprite selector (sym_0607EAB8) as a dword offset, and
 *   passes the resulting entry as the sound parameter.
 *
 * In both paths, r4 = 0 (channel 0) and r5 = sound command ID.
 * The call target is sound_cmd_dispatch, loaded into r14 on entry.
 *
 * Args:    none (reads global state)
 * Returns: nothing (void)
 * Calls:   sound_cmd_dispatch(channel=0, sound_id)
 */

    .section .text.FUN_06010B54


    .global hud_sound_trigger
    .type hud_sound_trigger, @function
hud_sound_trigger:
    mov.l r14, @-r15                    ! save r14 on stack
    sts.l pr, @-r15                     ! save return address on stack
    mov.l   .L_pool_sound_dispatch, r14 ! r14 = &sound_cmd_dispatch (call target)
    mov.l   .L_pool_hud_active_flag, r0 ! r0 = &hud_active_flag (sym_0607EAE0)
    mov.l @r0, r0                       ! r0 = hud_active_flag value
    tst r0, r0                          ! test if hud_active_flag == 0
    bt      .L_hud_inactive             ! if zero, branch to inactive path
    mov.l   .L_pool_scale_mode_flag, r0 ! r0 = &scale_mode_flag (sym_06078644)
    mov.l @r0, r0                       ! r0 = scale_mode_flag value
    cmp/eq #0x1, r0                     ! compare scale_mode_flag with 1
    bf      .L_scale_mode_alt           ! if != 1, use alternate sound
    mov.l   .L_pool_snd_hud_default, r5 ! r5 = 0xAB110AFF (default HUD sound)
    bra     .L_call_sound_dispatch      ! jump to common call site
    nop                                 ! branch delay slot
    /* Cross-TU pool entries: referenced by tachometer_ctrl's .byte-encoded
     * mov.l instructions. These fall within this TU's address range but
     * belong to the preceding TU's constant pool. */
    .4byte  0x06FC0200                  ! tachometer countdown threshold + padding
    .4byte  0x00E100E2                  ! invalid mode sanitization constants
    .4byte  0x009007A2                  ! mode check / display parameter
    .4byte  sym_06063F42                ! HUD element index (word)
    .4byte  sym_06063D9E                ! game mode word (0x10 = demo/attract)
    .4byte  sym_0607887F                ! game state byte (8-bit)
    .4byte  sym_06078868                ! car/sprite frame index (dword)
    .4byte  sym_0605ACE3                ! display channel base address
    .4byte  sym_060284AE                ! display element renderer
.L_pool_sound_dispatch:
    .4byte  sound_cmd_dispatch          ! sound command dispatch function
.L_pool_hud_active_flag:
    .4byte  sym_0607EAE0               ! hud_active_flag (nonzero = HUD active)
.L_pool_scale_mode_flag:
    .4byte  sym_06078644               ! scale_mode_flag (1 = normal scale)
.L_pool_snd_hud_default:
    .4byte  0xAB110AFF                 ! sound ID: default HUD element sound
.L_scale_mode_alt:
    .byte   0xD5, 0x2B    /* mov.l .L_pool_06010C54, r5 — r5 = 0xAB110BFF (alt HUD sound) */
.L_call_sound_dispatch:
    jsr @r14                            ! call sound_cmd_dispatch(0, r5)
    mov #0x0, r4                        ! r4 = 0 (channel 0) — delay slot
    bra     .L_epilogue                 ! jump to function epilogue
    nop                                 ! branch delay slot
.L_hud_inactive:
    .byte   0xD5, 0x2A    /* mov.l .L_pool_06010C58, r5 — r5 = &car_sprite_selector (sym_0607EAB8) */
    .byte   0xD3, 0x2A    /* mov.l .L_pool_06010C5C, r3 — r3 = &display_list_table (sym_0604483C) */
    mov.l @r5, r5                       ! r5 = car_sprite_selector value
    shll2 r5                            ! r5 *= 4 (dword offset into table)
    add r3, r5                          ! r5 = &display_list_table[selector]
    mov.l @r5, r5                       ! r5 = display_list_table[selector] (sound param)
    jsr @r14                            ! call sound_cmd_dispatch(0, r5)
    mov #0x0, r4                        ! r4 = 0 (channel 0) — delay slot
.L_epilogue:
    lds.l @r15+, pr                     ! restore return address from stack
    rts                                 ! return to caller
    mov.l @r15+, r14                    ! restore r14 from stack — delay slot
