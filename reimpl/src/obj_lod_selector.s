/* obj_lod_selector -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06020950 - 0x060209AC
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Clears LOD sprite regions in VRAM for each object index.
 * Copies a blank tile template (sym_0605F52A: 44x1 fill pattern) onto
 * the stack, then loops over object indices [0..r11), calling
 * vram_rect_fill twice per index to blank both the primary and
 * secondary LOD slots (offset 0 and +0x2C within each 32-word slot).
 *
 * Entry: r11 = object count
 */

    .section .text.FUN_06020950


    .global obj_lod_selector
    .type obj_lod_selector, @function
obj_lod_selector:
    sts.l pr, @-r15                       ! save return address
    add #-0x5C, r15                       ! allocate 92 bytes of stack for tile buffer
    mov.l   .L_pool_vram_rect_fill, r12   ! r12 = &vram_rect_fill (called in loop)
    mov r15, r13                          ! r13 = tile_buf (stack base for source data)
    mov r15, r1                           ! r1 = dst for memcpy_byte
    mov.l   .L_pool_blank_tile_src, r2    ! r2 = src: blank tile template (44x1 pattern)
    mov.l   .L_pool_memcpy_byte, r3       ! r3 = &memcpy_byte
    jsr @r3                               ! memcpy_byte(r0=nbytes, r1=dst, r2=src)
    mov #0x5C, r0                         ! (delay slot) r0 = 92 bytes to copy
    mov #0x0, r14                         ! r14 = loop index = 0
.L_lod_loop:
    mov #0x0, r7                          ! r7 = color_bias = 0 (no tint)
    extu.b r14, r6                        ! r6 = index (zero-extended byte)
    mov r13, r5                           ! r5 = source tile buffer on stack
    shll2 r6                              ! r6 *= 4
    shll2 r6                              ! r6 *= 4  (cumulative: *16)
    shll2 r6                              ! r6 *= 4  (cumulative: *64)
    shll r6                               ! r6 *= 2  (cumulative: *128 -- VRAM row stride)
    jsr @r12                              ! vram_rect_fill(r4=slot, r5=src, r6=offset, r7=bias)
    mov #0x4, r4                          ! (delay slot) r4 = VRAM table slot 4
    mov #0x0, r7                          ! r7 = color_bias = 0 (no tint)
    extu.b r14, r6                        ! r6 = index (zero-extended byte)
    mov r13, r5                           ! r5 = source tile buffer on stack
    shll2 r6                              ! r6 *= 4
    shll2 r6                              ! r6 *= 4  (cumulative: *16)
    shll2 r6                              ! r6 *= 4  (cumulative: *64)
    add #0x2C, r6                         ! r6 += 44 (advance past primary LOD region)
    shll r6                               ! r6 *= 2  (cumulative: offset*128 + 88)
    jsr @r12                              ! vram_rect_fill(r4=slot, r5=src, r6=offset, r7=bias)
    mov #0x4, r4                          ! (delay slot) r4 = VRAM table slot 4
    add #0x1, r14                         ! index++
    extu.b r14, r3                        ! r3 = index (zero-extended for compare)
    cmp/ge r11, r3                        ! if index >= count ...
    bf      .L_lod_loop                   ! ... no: continue loop
    add #0x5C, r15                        ! deallocate stack frame
    lds.l @r15+, pr                       ! restore return address
    mov.l @r15+, r11                      ! restore r11
    mov.l @r15+, r12                      ! restore r12
    mov.l @r15+, r13                      ! restore r13
    rts                                   ! return
    mov.l @r15+, r14                      ! (delay slot) restore r14
.L_pool_vram_rect_fill:
    .4byte  sym_06028400
.L_pool_blank_tile_src:
    .4byte  sym_0605F52A
.L_pool_memcpy_byte:
    .4byte  sym_06035228
