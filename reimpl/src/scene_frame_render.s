/* scene_frame_render -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0603F0FC - 0x0603F148
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Renders a single scene frame.  Dispatches command processing for the
 * given scene pointer, then selects one of two rendering paths based on
 * a mode flag in the render descriptor.
 *
 * Flow:
 *   1. If scene_ptr (r4) is non-null, call menu_state_handler to set up
 *      state, then loop cmd_dispatch_main until it returns 0 (idle).
 *   2. Check render_desc[0] (mode flag):
 *        0 → call attract_demo_chooser(scene_ptr, render_desc[8], render_desc[4])
 *       !0 → call menu_text_position(scene_ptr, render_desc[8], render_desc[4])
 *   3. Return.
 *
 * Args:
 *   r4 = scene pointer (may be null to skip command processing)
 *   r5 = render descriptor pointer (3-word struct: mode flag, param_a, param_b)
 *   r6 = extra parameter passed as r5 to menu_state_handler
 *
 * Calls (external):
 *   cmd_dispatch_main       0x0603B424  command dispatch loop (pool)
 *   menu_state_handler      0x0603B31C  initialize menu/scene state (pool)
 *   attract_demo_chooser    0x0603F2E0  render path when mode == 0 (bsr)
 *   menu_text_position      0x0603F342  render path when mode != 0 (bsr)
 */

    .section .text.FUN_0603F0FC


    .global scene_frame_render
    .type scene_frame_render, @function
scene_frame_render:
    mov.l r14, @-r15                            ! save r14 (callee-saved)
    mov r4, r14                                 ! r14 = scene_ptr
    mov.l r13, @-r15                            ! save r13 (callee-saved)
    mov.l r12, @-r15                            ! save r12 (callee-saved)
    sts.l pr, @-r15                             ! save return address
    add #-0x4, r15                              ! allocate 4 bytes on stack for r6
    .byte   0xDC, 0x1E    /* mov.l .L_pool_0603F184, r12 */  ! r12 = cmd_dispatch_main
    mov.l r6, @r15                              ! stack[0] = extra param (saved r6)
    tst r14, r14                                ! scene_ptr == NULL?
    bt/s    .L_check_render_mode                ! if null, skip command processing
    mov r5, r13                                 ! delay: r13 = render_desc pointer
    mov.l @r15, r5                              ! r5 = extra param (from stack)
    .byte   0xD3, 0x1C    /* mov.l .L_pool_0603F188, r3 */  ! r3 = menu_state_handler
    jsr @r3                                     ! call menu_state_handler(r4=scene_ptr, r5=extra_param)
    mov r14, r4                                 ! delay: r4 = scene_ptr
.L_dispatch_loop:
    jsr @r12                                    ! call cmd_dispatch_main(r4=scene_ptr)
    mov r14, r4                                 ! delay: r4 = scene_ptr
    tst r0, r0                                  ! cmd_dispatch_main returned 0 (idle)?
    bf      .L_dispatch_loop                    ! if nonzero, keep processing commands
.L_check_render_mode:
    mov.l @r13, r0                              ! r0 = render_desc[0] (mode flag)
    tst r0, r0                                  ! mode == 0?
    bf      .L_render_text                      ! if nonzero, use menu_text_position path
    mov.l @(4, r13), r6                         ! r6 = render_desc[4] (param_a)
    mov.l @(8, r13), r5                         ! r5 = render_desc[8] (param_b)
    .byte   0xB0, 0xD8    /* bsr 0x0603F2E0 (external) */  ! call attract_demo_chooser(r4, r5, r6)
    mov r14, r4                                 ! delay: r4 = scene_ptr
    bra     .L_epilogue                         ! skip alternate path
    nop                                         ! delay slot (nop)
.L_render_text:
    mov.l @(4, r13), r6                         ! r6 = render_desc[4] (param_a)
    mov.l @(8, r13), r5                         ! r5 = render_desc[8] (param_b)
    .byte   0xB1, 0x03    /* bsr 0x0603F342 (external) */  ! call menu_text_position(r4, r5, r6)
    mov r14, r4                                 ! delay: r4 = scene_ptr
.L_epilogue:
    add #0x4, r15                               ! free stack allocation
    lds.l @r15+, pr                             ! restore return address
    mov.l @r15+, r12                            ! restore r12
    mov.l @r15+, r13                            ! restore r13
    rts                                         ! return to caller
    mov.l @r15+, r14                            ! delay: restore r14
