/* transition_handler_b -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x0600F8BE - 0x0600F914
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Transition tick handler (variant B). Called each frame during a UI
 * transition sequence:
 *
 *   1. Decrement the transition countdown timer (16-bit word at sym_0607887C).
 *   2. If timer > 0, tail-call hud_transparency (VDP2 coeff writer) — the
 *      transition is still in progress.
 *   3. If timer <= 0 (transition complete), call display_layer_config(4) via
 *      cross-TU pool (sym_0602853E) and advance game_state_byte (sym_0607887F)
 *      by +1.
 *
 * loc_0600F90A: Standalone helper that increments game_state_byte by +1.
 *               Referenced from the game state jump table in binary_final_func.
 *
 * Globals:
 *   sym_0607887C = transition countdown timer (16-bit word)
 *   sym_0607887F = game_state_byte (8-bit)
 *   sym_06028560 = render_state_commit (unreferenced pool entry)
 *   sym_0607EBCC = attract mode countdown (unreferenced pool entry)
 *   sym_0607886E = transition_state_word (unreferenced pool entry)
 */

    .section .text.FUN_0600F8BE


    .global transition_handler_b
    .type transition_handler_b, @function
transition_handler_b:
    sts.l pr, @-r15                      ! save return address
    .byte   0xD4, 0x07    /* mov.l .L_pool_countdown_timer, r4 */ ! r4 = &transition countdown timer
    mov.w @r4, r3                        ! r3 = countdown timer value (16-bit)
    add #-0x1, r3                        ! r3 = timer - 1
    mov.w r3, @r4                        ! store decremented timer
    exts.w r3, r3                        ! sign-extend to 32 bits
    cmp/pl r3                            ! is timer still > 0?
    bf      .L_transition_done           ! if timer <= 0, transition finished
    .byte   0xD3, 0x09    /* mov.l .L_pool_fn_hud_transparency, r3 */ ! r3 = &hud_transparency
    jmp @r3                              ! tail-call hud_transparency (transition in progress)
    lds.l @r15+, pr                      ! restore return address (delay slot)
    .4byte  0x0708FFFF                   /* unreferenced pool data (padding) */
    .4byte  anim_ui_transition           /* unreferenced pool: &anim_ui_transition */
    .4byte  hud_course_render            /* unreferenced pool: &hud_course_render */
.L_pool_countdown_timer:
    .4byte  sym_0607887C                 /* &transition countdown timer (16-bit word) */
    .4byte  sym_0607887F                 /* unreferenced pool: &game_state_byte */
    .4byte  sym_06028560                 /* unreferenced pool: &render_state_commit */
    .4byte  sym_0607EBCC                 /* unreferenced pool: &attract mode countdown */
    .4byte  sym_0607886E                 /* unreferenced pool: &transition_state_word */
.L_pool_fn_hud_transparency:
    .4byte  hud_transparency             /* VDP2 rotation-scroll coeff writer */
.L_transition_done:
    .byte   0xD3, 0x19    /* mov.l .L_pool_0600F960, r3 */ ! r3 = &display_layer_config (cross-TU pool)
    jsr @r3                              ! display_layer_config(4) — configure display layer
    mov #0x4, r4                         ! r4 = 4 (layer id, delay slot)
    .byte   0xD4, 0x19    /* mov.l .L_pool_0600F964, r4 */ ! r4 = &game_state_byte (cross-TU pool)
    lds.l @r15+, pr                      ! restore return address
    mov.b @r4, r2                        ! r2 = current game_state
    add #0x1, r2                         ! r2 = game_state + 1
    rts                                  ! return
    mov.b r2, @r4                        ! game_state_byte++ (delay slot)

    .global loc_0600F90A
loc_0600F90A:
    .byte   0xD4, 0x16    /* mov.l .L_pool_0600F964, r4 */ ! r4 = &game_state_byte (cross-TU pool)
    mov.b @r4, r3                        ! r3 = current game_state
    add #0x1, r3                         ! r3 = game_state + 1
    rts                                  ! return
    mov.b r3, @r4                        ! game_state_byte++ (delay slot)
