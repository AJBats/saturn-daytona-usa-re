/* course_select_state -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x060193FE - 0x0601950C
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Course selection screen setup — configures the display state for the
 * course selection menu. Stores 6 selection/mode flags, plays the course
 * select music, enables render layers, and sets up VDP2 tile data.
 *
 * Initialization sequence:
 *   1. Store 6 selection flags (r3, r4, r0 variants)
 *   2. sound_cmd_dispatch(0xF, 0xAE0003FF) — course select music
 *   3. render_flags |= 0x80000000 (course select mode bit)
 *   4. camera_finalize() × 2
 *   5. BSR to 0x0601938C (helper setup)
 *   6. course_name_render()
 *   7. vram_tile_copy(0x25E76174, 0x14000, 0, 9) — tile set A
 *   8. vram_tile_copy(0x25E761FC, 0x17700, 0, 8) — tile set B
 *   9. display_channel_b(8/16/32, 0, 0) — enable 3 channels
 *  10. layer_config(4) + layer_config(0xC) — enable display layers
 *  11. render_flags |= 4, render_commit()
 *  12. layer_setup(4, src, tile_data + 0xA000, 0)
 *  13. Tail-call to 0x06019324 (BRA helper)
 *
 * Parameters:
 *   r3 = selection flag A (byte)
 *   r4 = selection flag B (byte, also C/D/E/F)
 *   r0 = selection flag C (byte)
 */

    .section .text.FUN_060193FE


    .global course_select_state
    .type course_select_state, @function
course_select_state:
    sts.l pr, @-r15
    add #-0x4, r15
    .byte   0xD2, 0x2B    /* mov.l .L_select_flag_a, r2 — selection flag A */
    mov.b r3, @r2                        /* flag_a = r3 (course byte) */
    extu.b r4, r3
    .byte   0xD2, 0x2A    /* mov.l .L_select_flag_b, r2 — selection flag B */
    mov.b r4, @r2                        /* flag_b = r4 */
    .byte   0xD2, 0x2A    /* mov.l .L_select_flag_c, r2 — selection flag C */
    mov.b r0, @r2                        /* flag_c = r0 */
    extu.b r4, r0
    .byte   0xD2, 0x2A    /* mov.l .L_select_flag_d, r2 — selection flag D */
    extu.b r4, r4
    mov.b r0, @r2                        /* flag_d = r4 (zero-ext) */
    .byte   0xD2, 0x29    /* mov.l .L_select_flag_e, r2 — selection flag E */
    mov.b r3, @r2                        /* flag_e = r3 (zero-ext) */
    .byte   0xD2, 0x29    /* mov.l .L_select_flag_f, r2 — selection flag F */
    mov.b r4, @r2                        /* flag_f = r4 (zero-ext) */
    .byte   0xD5, 0x29    /* mov.l .L_snd_cmd_select, r5 — 0xAE0003FF */
    .byte   0xD2, 0x2A    /* mov.l .L_fn_sound_dispatch, r2 */
    jsr @r2                              /* sound_cmd_dispatch(0xF, 0xAE0003FF) */
    mov #0xF, r4
    .byte   0xDE, 0x29    /* mov.l .L_render_flags, r14 — render mode flags */
    .byte   0xD3, 0x2A    /* mov.l .L_fp_min, r3 — 0x80000000 */
    mov.l @r14, r2
    or r3, r2
    .byte   0xD3, 0x29    /* mov.l .L_fn_camera_finalize, r3 */
    jsr @r3                              /* camera_finalize() [1st call] */
    mov.l r2, @r14                       /* render_flags |= 0x80000000 */
    .byte   0xD3, 0x28    /* mov.l .L_fn_camera_finalize, r3 */
    jsr @r3                              /* camera_finalize() [2nd call] */
    nop
    .byte   0xBF, 0xA6    /* bsr 0x0601938C (external helper) */
    nop
    .byte   0xD3, 0x26    /* mov.l .L_fn_course_name_render, r3 */
    jsr @r3                              /* course_name_render() */
    nop
    mov #0x9, r7                         /* === VDP2 tile data setup === */
    .byte   0xD5, 0x25    /* mov.l .L_tile_data_a, r5 — 0x14000 */
    .byte   0xD4, 0x26    /* mov.l .L_vdp2_vram_0x76174, r4 — 0x25E76174 */
    .byte   0xD3, 0x26    /* mov.l .L_fn_vram_tile_copy, r3 */
    jsr @r3                              /* vram_tile_copy(VRAM+76174, 0x14000, 0, 9) */
    mov #0x0, r6
    mov #0x8, r7
    .byte   0xD5, 0x25    /* mov.l .L_tile_data_b, r5 — 0x17700 */
    .byte   0xD4, 0x26    /* mov.l .L_vdp2_vram_0x761FC, r4 — 0x25E761FC */
    .byte   0xD3, 0x23    /* mov.l .L_fn_vram_tile_copy, r3 */
    jsr @r3                              /* vram_tile_copy(VRAM+761FC, 0x17700, 0, 8) */
    mov #0x0, r6
    mov #0x0, r6                         /* === Display channel enable === */
    .byte   0xDD, 0x24    /* mov.l .L_fn_display_channel, r13 */
    mov r6, r5
    jsr @r13                             /* display_channel_b(8, 0, 0) */
    mov #0x8, r4
    mov #0x0, r6
    mov r6, r5
    jsr @r13                             /* display_channel_b(16, 0, 0) */
    mov #0x10, r4
    mov #0x0, r6
    mov r6, r5
    jsr @r13                             /* display_channel_b(32, 0, 0) */
    mov #0x20, r4
    .byte   0xD3, 0x1F    /* mov.l .L_fn_layer_config, r3 */
    jsr @r3                              /* layer_config(4) */
    mov #0x4, r4
    .byte   0xD3, 0x1E    /* mov.l .L_fn_layer_config, r3 */
    jsr @r3                              /* layer_config(0xC) */
    mov #0xC, r4
    mov.l @r14, r0                       /* === Render commit === */
    .byte   0xD3, 0x1D    /* mov.l .L_fn_render_commit, r3 */
    or #0x4, r0                          /* set bit 2 */
    jsr @r3                              /* render_commit(flags | 4) */
    mov.l r0, @r14
    mov #0x0, r6                         /* === Layer setup === */
    .byte   0xD2, 0x1B    /* mov.l .L_layer_data, r2 — display layer params */
    mov.l r2, @r15
    mov r2, r7
    mov r2, r5
    .byte   0xD3, 0x1A    /* mov.l .L_tile_vram_offset, r3 — 0xA000 */
    mov.l @(4, r7), r7                  /* layer_data[+4] = tile data ptr */
    mov.l @r5, r5                        /* layer_data[+0] = source ptr */
    add r3, r7                           /* tile_ptr += 0xA000 */
    .byte   0xD3, 0x19    /* mov.l .L_fn_layer_setup, r3 */
    jsr @r3                              /* layer_setup(4, src, tile+0xA000, 0) */
    mov #0x4, r4
    add #0x4, r15
    lds.l @r15+, pr
    mov.l @r15+, r13
    .byte   0xAF, 0x3A    /* bra 0x06019324 (external tail-call) */
    mov.l @r15+, r14
.L_select_flag_a:
    .4byte  sym_06085FF0               /* course select flag A (byte) */
.L_select_flag_b:
    .4byte  sym_0605D245               /* course select flag B (byte) */
.L_select_flag_c:
    .4byte  sym_06085FF1               /* course select flag C (byte) */
.L_select_flag_d:
    .4byte  sym_06085FF2               /* course select flag D (byte) */
.L_select_flag_e:
    .4byte  sym_06085FF3               /* course select flag E (byte) */
.L_select_flag_f:
    .4byte  sym_06085FF5               /* course select flag F (byte) */
.L_snd_cmd_select:
    .4byte  0xAE0003FF                  /* sound command: course select music */
.L_fn_sound_dispatch:
    .4byte  sound_cmd_dispatch         /* sound command dispatcher */
.L_render_flags:
    .4byte  sym_0605B6D8               /* render mode flags (32-bit) */
.L_fp_min:
    .4byte  0x80000000                  /* min negative / sign bit */
.L_fn_camera_finalize:
    .4byte  sym_06026CE0               /* camera state finalization */
.L_fn_course_name_render:
    .4byte  sym_0601A73E               /* course name rendering */
.L_tile_data_a:
    .4byte  0x00014000                  /* tile set A source address */
.L_vdp2_vram_0x76174:
    .4byte  0x25E76174                  /* VDP2 VRAM +0x76174 */
.L_fn_vram_tile_copy:
    .4byte  sym_0600511E               /* VRAM tile data copy */
.L_tile_data_b:
    .4byte  0x00017700                  /* tile set B source address */
.L_vdp2_vram_0x761FC:
    .4byte  0x25E761FC                  /* VDP2 VRAM +0x761FC */
.L_fn_display_channel:
    .4byte  display_channel_b          /* display channel B enable */
.L_fn_layer_config:
    .4byte  sym_0602853E               /* display layer configuration */
.L_fn_render_commit:
    .4byte  sym_06028560               /* render state commit */
.L_layer_data:
    .4byte  sym_06063AF8               /* display layer parameters */
.L_tile_vram_offset:
    .4byte  0x0000A000                  /* tile VRAM offset (+0xA000) */
.L_fn_layer_setup:
    .4byte  sym_06028400               /* display layer setup */
