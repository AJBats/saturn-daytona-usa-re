/* cd_texture_loader -- L3 assembly (SH-2 mnemonics)
 * Translation unit: 0x06012DB4 - 0x06012E08
 * Auto-generated by tools/generate_l3_tu.py
 *
 * Course data CD loader: loads line data and course model files from disc.
 *
 * Dispatches on course ID to select the correct pair of CSx_LINE.BIN and
 * COURSEx.BIN files, then performs two sequential CD DMA transfers:
 *   1. BSR cd_dma_setup(CSx_LINE.BIN, 0x00200000)  -- line data to WRAM-Low
 *   2. BRA cd_dma_setup(COURSEx.BIN,  0x00240000)  -- course model to WRAM-Low+0x40000
 *
 * Arguments:
 *   r4 = course ID (1, 2, or default/0)
 *
 * Register allocation:
 *   r13 = 0x00200000 (WRAM-Low base, DMA dest for line data)
 *   r14 = 0x00240000 (WRAM-Low + 0x40000, DMA dest for course model)
 *
 * sym_06012E00: Player texture loader entry point.
 *   Loads TEX_PL.BIN to 0x002A0000 via tail-call to cd_dma_setup.
 *   Called from disc_load_mgr, game_init_master, car_physics_init.
 *
 * Pool entries are cross-section (in neighboring sound_init_sequence,
 * 0x06012E1C..0x06012E40).
 */

    .section .text.FUN_06012DB4


    .global cd_texture_loader
    .type cd_texture_loader, @function
cd_texture_loader:
    mov.l r14, @-r15                        ! save r14 (callee-saved)
    mov r4, r0                              ! r0 = course ID
    mov.l r13, @-r15                        ! save r13 (callee-saved)
    sts.l pr, @-r15                         ! save return address
    .byte   0xDD, 0x17    /* mov.l .L_wram_low_base, r13 -- 0x00200000 (WRAM-Low, line data dest) */
    .byte   0xDE, 0x18    /* mov.l .L_wram_low_course, r14 -- 0x00240000 (WRAM-Low+0x40000, course model dest) */
    cmp/eq #0x1, r0                         ! is course ID == 1?
    bf      .L_06012DD6                     ! if not, check course 2
    .byte   0xD4, 0x17    /* mov.l .L_fn_cs1_line, r4 -- -> "CS1_LINE.BIN" */
    .byte   0xBF, 0x39    /* bsr cd_dma_setup */
    mov r13, r5                             ! (delay slot) r5 = 0x00200000 (line data dest)
    mov r14, r5                             ! r5 = 0x00240000 (course model dest)
    .byte   0xD4, 0x16    /* mov.l .L_fn_course1, r4 -- -> "COURSE1.BIN" */
    lds.l @r15+, pr                         ! restore return address
    mov.l @r15+, r13                        ! restore r13
    .byte   0xAF, 0x33    /* bra cd_dma_setup -- tail-call: load COURSE1.BIN */
    mov.l @r15+, r14                        ! (delay slot) restore r14
.L_06012DD6:
    mov r4, r0                              ! r0 = course ID (reload for compare)
    cmp/eq #0x2, r0                         ! is course ID == 2?
    bf      .L_06012DEE                     ! if not, fall through to default (course 0)
    .byte   0xD4, 0x13    /* mov.l .L_fn_cs2_line, r4 -- -> "CS2_LINE.BIN" */
    .byte   0xBF, 0x2D    /* bsr cd_dma_setup */
    mov r13, r5                             ! (delay slot) r5 = 0x00200000 (line data dest)
    mov r14, r5                             ! r5 = 0x00240000 (course model dest)
    .byte   0xD4, 0x12    /* mov.l .L_fn_course2, r4 -- -> "COURSE2.BIN" */
    lds.l @r15+, pr                         ! restore return address
    mov.l @r15+, r13                        ! restore r13
    .byte   0xAF, 0x27    /* bra cd_dma_setup -- tail-call: load COURSE2.BIN */
    mov.l @r15+, r14                        ! (delay slot) restore r14
.L_06012DEE:
    .byte   0xD4, 0x11    /* mov.l .L_fn_cs0_line, r4 -- -> "CS0_LINE.BIN" */
    .byte   0xBF, 0x24    /* bsr cd_dma_setup */
    mov r13, r5                             ! (delay slot) r5 = 0x00200000 (line data dest)
    mov r14, r5                             ! r5 = 0x00240000 (course model dest)
    .byte   0xD4, 0x10    /* mov.l .L_fn_course0, r4 -- -> "COURSE0.BIN" */
    lds.l @r15+, pr                         ! restore return address
    mov.l @r15+, r13                        ! restore r13
    .byte   0xAF, 0x1E    /* bra cd_dma_setup -- tail-call: load COURSE0.BIN */
    mov.l @r15+, r14                        ! (delay slot) restore r14

    .global sym_06012E00
sym_06012E00:
    .byte   0xD5, 0x0E    /* mov.l .L_player_tex_dest, r5 -- 0x002A0000 (player texture DMA dest) */
    .byte   0xD4, 0x0F    /* mov.l .L_fn_tex_pl, r4 -- -> "TEX_PL.BIN" */
    .byte   0xAF, 0x1A    /* bra cd_dma_setup -- tail-call: load TEX_PL.BIN */
    nop                                     ! (delay slot)
